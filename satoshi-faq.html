<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Satoshi Archive — BC2 / Bitcoin II</title>
    <meta name="description" content="Complete Satoshi Nakamoto email correspondence, Bitcoin Whitepaper, and BC2 Whitepaper in a retro CRT terminal.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&family=IBM+Plex+Mono:wght@400;500;600&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --phosphor: #33ff33;
            --phosphor-dim: #1a9e1a;
            --phosphor-bright: #66ff66;
            --phosphor-glow: rgba(51,255,51,0.15);
            --phosphor-faint: rgba(51,255,51,0.06);
            --amber: #F7931A;
            --amber-dim: rgba(247,147,26,0.5);
            --amber-glow: rgba(247,147,26,0.3);
            --crt-bg: #0a0f0a;
            --crt-dark: #060906;
            --crt-bezel: #1a1a18;
            --crt-frame: #111110;
            --cyan: #00ddff;
            --cyan-dim: rgba(0,221,255,0.5);
        }

        html { height: 100%; }

        body {
            font-family: 'VT323', monospace;
            background: #050505;
            color: var(--phosphor);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ════ Desk surface ════ */
        .desk {
            min-height: 100vh;
            background:
                radial-gradient(ellipse 70% 40% at 50% 30%, rgba(51,255,51,0.03), transparent 60%),
                repeating-linear-gradient(90deg, transparent, transparent 3px, rgba(255,255,255,0.003) 3px, rgba(255,255,255,0.003) 4px),
                linear-gradient(180deg, #0c0b09 0%, #080706 40%, #050404 100%);
            display: flex; flex-direction: column; align-items: center;
            padding: 1.5rem;
        }

        /* ════ Monitor frame — 90s pre-rendered 3D ════ */
        .monitor {
            width: 100%; max-width: 960px;
            background:
                linear-gradient(170deg, #2a2824 0%, #1e1c18 8%, #17150f 25%, #121010 50%, #0d0c0a 75%, #0a0908 100%);
            border-radius: 18px;
            padding: 24px 24px 32px;
            position: relative;
            /* Heavy 3D bevel — thick lit top/left edge, dark bottom/right */
            border-top: 3px solid #3d3a32;
            border-left: 3px solid #33302a;
            border-right: 3px solid #0a0908;
            border-bottom: 4px solid #060504;
            box-shadow:
                /* Outer drop shadow */
                0 40px 100px rgba(0,0,0,0.9), 0 15px 35px rgba(0,0,0,0.7),
                /* Phosphor ambient glow */
                0 0 80px rgba(51,255,51,0.02), 0 0 200px rgba(51,255,51,0.008),
                /* Chunky 3D bevels — the Fallout look */
                inset 0 2px 0 #4a4639,
                inset 0 4px 0 #3d3a32,
                inset 0 6px 0 rgba(255,255,255,0.04),
                inset 2px 0 0 #33302a,
                inset 4px 0 0 rgba(255,255,255,0.02),
                inset 0 -2px 0 #080706,
                inset 0 -4px 0 #0a0908,
                inset -2px 0 0 #0a0908,
                inset -4px 0 0 #060504,
                /* Inner shadow depth */
                inset 0 8px 16px rgba(0,0,0,0.3),
                inset 0 -4px 12px rgba(0,0,0,0.5);
        }
        .monitor::before {
            content: ''; position: absolute; inset: 10px; border-radius: 12px;
            pointer-events: none; z-index: 0;
            /* Specular highlight band across the top — that CGI plastic sheen */
            background:
                linear-gradient(175deg,
                    rgba(255,255,240,0.06) 0%,
                    rgba(255,255,240,0.03) 3%,
                    rgba(255,255,240,0.008) 8%,
                    transparent 15%,
                    transparent 85%,
                    rgba(0,0,0,0.1) 100%
                ),
                linear-gradient(90deg,
                    rgba(255,255,240,0.02) 0%,
                    transparent 10%,
                    transparent 90%,
                    rgba(0,0,0,0.05) 100%
                );
        }
        .monitor::after {
            content: ''; position: absolute; inset: 18px 18px 26px; border-radius: 10px;
            pointer-events: none; z-index: 0;
            /* Inner recess shadow ring */
            border-top: 1px solid rgba(0,0,0,0.6);
            border-left: 1px solid rgba(0,0,0,0.4);
            border-right: 1px solid rgba(255,255,255,0.02);
            border-bottom: 1px solid rgba(255,255,255,0.03);
            box-shadow: inset 0 3px 8px rgba(0,0,0,0.4), inset 0 -1px 4px rgba(0,0,0,0.2),
                0 1px 0 rgba(255,255,255,0.02);
        }

        /* Chunky industrial screws with cross slots */
        .monitor-screw {
            position: absolute; width: 12px; height: 12px; border-radius: 50%;
            z-index: 5;
            background: radial-gradient(circle at 35% 35%, #3a3830, #252320 50%, #151412 80%, #0a0908);
            border-top: 1px solid rgba(255,255,255,0.12);
            border-left: 1px solid rgba(255,255,255,0.06);
            border-right: 1px solid rgba(0,0,0,0.4);
            border-bottom: 1px solid rgba(0,0,0,0.6);
            box-shadow: 0 1px 3px rgba(0,0,0,0.6), inset 0 1px 2px rgba(255,255,255,0.08);
        }
        .monitor-screw::before {
            content: ''; position: absolute; top: 50%; left: 50%;
            transform: translate(-50%,-50%); width: 7px; height: 1.5px;
            background: rgba(0,0,0,0.7); border-radius: 0.5px;
            box-shadow: 0 1px 0 rgba(255,255,255,0.04);
        }
        .monitor-screw::after { content: ''; position: absolute; top: 50%; left: 50%;
            transform: translate(-50%,-50%) rotate(90deg); width: 7px; height: 1.5px;
            background: rgba(0,0,0,0.7); border-radius: 0.5px;
            box-shadow: 0 1px 0 rgba(255,255,255,0.04); }
        .monitor-screw.tl { top: 10px; left: 10px; }
        .monitor-screw.tr { top: 10px; right: 10px; }
        .monitor-screw.bl { bottom: 16px; left: 10px; }
        .monitor-screw.br { bottom: 16px; right: 10px; }

        .bezel {
            background:
                linear-gradient(180deg, #181614, #131110, #0e0d0b, #0a0908);
            border-radius: 10px; padding: 5px; position: relative; z-index: 1;
            /* Deep inset recess for the screen */
            border-top: 2px solid #080706;
            border-left: 2px solid #0a0908;
            border-right: 2px solid #22201c;
            border-bottom: 2px solid #2a2824;
            box-shadow:
                inset 0 4px 16px rgba(0,0,0,0.9),
                inset 0 -2px 8px rgba(0,0,0,0.4),
                inset 4px 0 12px rgba(0,0,0,0.5),
                inset -4px 0 12px rgba(0,0,0,0.5),
                inset 0 0 30px rgba(51,255,51,0.01),
                /* Outer lit edge where bezel meets frame */
                0 2px 0 rgba(255,255,255,0.02),
                0 -1px 0 rgba(0,0,0,0.4);
        }

        /* ════ CRT Screen ════ */
        .crt {
            position: relative;
            background: radial-gradient(ellipse 100% 100% at 50% 50%, #0c120c, #080c08 50%, #050805 100%);
            border-radius: 8px; overflow: hidden;
            height: min(82vh, 720px);
            /* Inset glass bevel */
            border-top: 2px solid #030303;
            border-left: 2px solid #050505;
            border-right: 1px solid rgba(255,255,255,0.03);
            border-bottom: 1px solid rgba(255,255,255,0.04);
            box-shadow: inset 0 0 60px rgba(0,0,0,0.5);
        }
        .crt::before {
            content: ''; position: absolute; inset: 0; z-index: 50;
            pointer-events: none; border-radius: 12px;
            background: repeating-linear-gradient(0deg, transparent, transparent 1px, rgba(0,0,0,0.15) 1px, rgba(0,0,0,0.15) 3px);
            animation: scanlineShimmer 8s linear infinite;
            will-change: opacity;
        }
        @keyframes scanlineShimmer { 0%, 100% { opacity: 0.7; } 50% { opacity: 0.85; } }
        .crt::after {
            content: ''; position: absolute; inset: 0; z-index: 51;
            pointer-events: none; border-radius: 12px;
            background: radial-gradient(ellipse 120% 120% at 50% 50%, transparent 50%, rgba(0,0,0,0.2) 70%, rgba(0,0,0,0.55) 100%);
            box-shadow: inset 0 0 120px rgba(51,255,51,0.015), inset 0 0 300px rgba(0,0,0,0.4);
        }
        .scan-bar {
            position: absolute; left: 0; right: 0; height: 4px; z-index: 53;
            pointer-events: none; border-radius: 12px;
            background: linear-gradient(180deg, transparent, rgba(51,255,51,0.04) 30%, rgba(51,255,51,0.07) 50%, rgba(51,255,51,0.04) 70%, transparent);
            box-shadow: 0 0 30px 10px rgba(51,255,51,0.015);
            animation: scanBar 6s linear infinite;
            will-change: top;
        }
        @keyframes scanBar { 0% { top: -4px; } 100% { top: 100%; } }
        .crt-noise { position: absolute; inset: 0; z-index: 49; pointer-events: none; border-radius: 12px; opacity: 0.01; mix-blend-mode: screen; will-change: opacity; }
        .crt-noise canvas { width: 100%; height: 100%; border-radius: 12px; }
        .crt-flicker { position: absolute; inset: 0; z-index: 52; pointer-events: none; border-radius: 12px; animation: crtFlicker 4s steps(2) infinite; opacity: 0; will-change: opacity; }
        @keyframes crtFlicker { 0% { opacity: 0; } 48% { opacity: 0; } 49% { opacity: 0.02; background: rgba(51,255,51,0.015); } 51% { opacity: 0; } 97% { opacity: 0; } 98% { opacity: 0.015; background: rgba(255,255,255,0.008); } 100%{ opacity: 0; } }

        .screen {
            position: relative; z-index: 10;
            padding: 1.2rem 1.5rem;
            height: 100%;
            display: flex; flex-direction: column;
            overflow: hidden;
            text-shadow: 0.3px 0 0 rgba(255,80,80,0.07), -0.3px 0 0 rgba(80,80,255,0.07);
        }

        /* ════ Tab Navigation ════ */
        .tab-bar {
            display: flex; gap: 2px; margin-bottom: 0.75rem; flex-shrink: 0;
            border-bottom: 1px solid rgba(51,255,51,0.15);
            padding-bottom: 0;
        }
        .tab-btn {
            font-family: 'VT323', monospace;
            font-size: 1rem; padding: 0.4rem 1rem;
            background: rgba(51,255,51,0.02);
            border: 1px solid rgba(51,255,51,0.1);
            border-bottom: none;
            border-radius: 4px 4px 0 0;
            color: var(--phosphor-dim);
            cursor: pointer; transition: all 0.2s;
            letter-spacing: 0.03em;
            text-shadow: 0 0 4px rgba(51,255,51,0.1);
            position: relative; bottom: -1px;
        }
        .tab-btn:hover {
            background: rgba(51,255,51,0.05);
            color: var(--phosphor);
            text-shadow: 0 0 6px rgba(51,255,51,0.3);
        }
        .tab-btn.active {
            background: rgba(51,255,51,0.06);
            border-color: rgba(51,255,51,0.25);
            border-bottom: 1px solid var(--crt-bg);
            color: var(--phosphor-bright);
            text-shadow: 0 0 8px rgba(51,255,51,0.5);
            box-shadow: 0 0 10px rgba(51,255,51,0.08);
        }
        .tab-btn.tab-amber.active {
            color: var(--amber);
            border-color: rgba(247,147,26,0.3);
            text-shadow: 0 0 8px var(--amber-glow);
            box-shadow: 0 0 10px rgba(247,147,26,0.08);
            background: rgba(247,147,26,0.04);
        }
        .tab-btn.tab-cyan.active {
            color: var(--cyan);
            border-color: rgba(0,221,255,0.3);
            text-shadow: 0 0 8px rgba(0,221,255,0.4);
            box-shadow: 0 0 10px rgba(0,221,255,0.08);
            background: rgba(0,221,255,0.04);
        }

        /* ════ Tab Content Areas ════ */
        .tab-content { display: none; flex: 1; min-height: 0; overflow: hidden; flex-direction: column; }
        .tab-content.active { display: flex; }

        /* ════ Scrollable content area ════ */
        .scroll-area {
            flex: 1; min-height: 0; overflow-y: auto; padding-right: 0.5rem;
            scrollbar-width: thin; scrollbar-color: rgba(51,255,51,0.15) transparent;
            font-size: 1.05rem; line-height: 1.55;
        }
        .scroll-area::-webkit-scrollbar { width: 3px; }
        .scroll-area::-webkit-scrollbar-track { background: transparent; }
        .scroll-area::-webkit-scrollbar-thumb { background: rgba(51,255,51,0.15); border-radius: 2px; }

        /* ════ Email Tab Styles ════ */
        .email-header-bar {
            display: flex; justify-content: space-between; align-items: center;
            padding: 0.4rem 0; margin-bottom: 0.75rem; flex-shrink: 0;
            border-bottom: 1px solid rgba(51,255,51,0.08);
            font-size: 0.9rem; color: var(--phosphor-dim);
        }
        .email-counter { color: var(--amber); text-shadow: 0 0 6px var(--amber-glow); }
        .email-controls { display: flex; gap: 0.5rem; align-items: center; }
        .email-controls button {
            font-family: 'VT323', monospace; font-size: 0.9rem;
            padding: 0.2rem 0.7rem;
            background: rgba(51,255,51,0.03);
            border: 1px solid rgba(51,255,51,0.15);
            border-radius: 3px; color: var(--phosphor-dim);
            cursor: pointer; transition: all 0.2s;
        }
        .email-controls button:hover {
            background: rgba(51,255,51,0.08);
            color: var(--phosphor);
            border-color: rgba(51,255,51,0.35);
            text-shadow: 0 0 6px rgba(51,255,51,0.3);
        }
        .email-controls button:disabled {
            opacity: 0.3; cursor: default;
        }
        .email-controls button.skip-btn {
            border-color: rgba(247,147,26,0.25);
            color: var(--amber-dim);
        }
        .email-controls button.skip-btn:hover {
            border-color: rgba(247,147,26,0.5);
            color: var(--amber);
            background: rgba(247,147,26,0.05);
        }

        /* Individual email display */
        .email-display { padding-bottom: 2rem; }
        .email-hdr {
            display: grid; grid-template-columns: 5rem 1fr;
            gap: 0.15rem 0.5rem;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(51,255,51,0.08);
        }
        .email-hdr-label {
            text-align: right; color: var(--phosphor-dim);
            font-size: 0.9rem; text-shadow: 0 0 4px rgba(51,255,51,0.1);
        }
        .email-hdr-value {
            color: var(--phosphor); font-size: 0.95rem;
            text-shadow: 0 0 5px rgba(51,255,51,0.2);
            word-break: break-word;
        }
        .email-hdr-value.from-satoshi {
            color: var(--amber);
            text-shadow: 0 0 6px var(--amber-glow);
        }
        .email-hdr-value.subject-line {
            color: var(--phosphor-bright);
            text-shadow: 0 0 8px rgba(51,255,51,0.4);
        }
        .email-body {
            white-space: pre-wrap; word-break: break-word;
            font-size: 1rem; line-height: 1.6;
            color: var(--phosphor);
            text-shadow: 0 0 5px rgba(51,255,51,0.2);
            min-height: 3rem;
        }
        .email-milestone-badge {
            display: inline-block; padding: 0.1rem 0.5rem;
            background: rgba(247,147,26,0.08);
            border: 1px solid rgba(247,147,26,0.25);
            border-radius: 2px; font-size: 0.75rem;
            color: var(--amber); margin-left: 0.5rem;
            text-shadow: 0 0 4px var(--amber-glow);
        }
        .email-star-slot { display: flex; justify-content: flex-end; padding: 2px 0 4px; }
        .email-context {
            margin-top: 1rem; padding: 0.5rem 0.75rem;
            background: rgba(51,255,51,0.02);
            border-left: 2px solid rgba(51,255,51,0.15);
            color: var(--phosphor-dim); font-size: 0.85rem;
            font-style: italic;
        }
        .email-bc2-note {
            margin-top: 0.5rem; padding: 0.5rem 0.75rem;
            background: rgba(247,147,26,0.04);
            border-left: 2px solid rgba(247,147,26,0.3);
            color: var(--amber); font-size: 0.85rem;
        }
        .email-bc2-note::before { content: '⟐ BC2: '; font-weight: bold; }

        /* Typing cursor */
        .typing-cursor {
            display: inline-block; width: 0.55em; height: 1.1em;
            background: var(--phosphor); vertical-align: text-bottom;
            animation: cursorBlink 0.6s step-end infinite;
            margin-left: 1px;
            box-shadow: 0 0 4px var(--phosphor), 0 0 10px rgba(51,255,51,0.3);
        }
        @keyframes cursorBlink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        /* Progress bar */
        .email-progress {
            flex-shrink: 0; height: 2px;
            background: rgba(51,255,51,0.06);
            border-radius: 1px; margin-top: 0.5rem;
            overflow: hidden;
        }
        .email-progress-fill {
            height: 100%; background: var(--amber);
            box-shadow: 0 0 6px var(--amber-glow);
            transition: width 0.3s ease;
            width: 0%;
        }

        /* ════ Whitepaper Styles ════ */
        .wp-title {
            font-size: 1.4rem; text-align: center;
            margin-bottom: 0.2rem;
            text-shadow: 0 0 10px rgba(51,255,51,0.4), 0 0 25px rgba(51,255,51,0.12);
        }
        .wp-title.amber { color: var(--amber); text-shadow: 0 0 10px var(--amber-glow), 0 0 25px rgba(247,147,26,0.12); }
        .wp-title.cyan { color: var(--cyan); text-shadow: 0 0 10px rgba(0,221,255,0.4), 0 0 25px rgba(0,221,255,0.12); }
        .wp-author {
            text-align: center; font-size: 0.95rem;
            color: var(--phosphor-dim); margin-bottom: 1.5rem;
        }
        .wp-section-title {
            color: var(--phosphor-bright); font-size: 1.15rem;
            margin: 1.5rem 0 0.5rem;
            text-shadow: 0 0 8px rgba(51,255,51,0.35);
            border-bottom: 1px solid rgba(51,255,51,0.08);
            padding-bottom: 0.25rem;
        }
        .wp-section-title.amber { color: var(--amber); text-shadow: 0 0 8px var(--amber-glow); border-color: rgba(247,147,26,0.15); }
        .wp-section-title.cyan { color: var(--cyan); text-shadow: 0 0 8px rgba(0,221,255,0.35); border-color: rgba(0,221,255,0.15); }
        .wp-text {
            margin-bottom: 0.75rem; line-height: 1.65;
            text-shadow: 0 0 4px rgba(51,255,51,0.15);
        }
        .wp-ref {
            font-size: 0.8rem; color: var(--phosphor-dim);
            margin-top: 0.25rem;
        }
        .wp-separator {
            text-align: center; color: rgba(51,255,51,0.15);
            margin: 1rem 0; letter-spacing: 0.5em;
        }

        /* ════ Monitor Details ════ */
        .monitor-brand {
            text-align: center; padding: 1rem 0 0;
            font-family: 'IBM Plex Mono', monospace; font-size: 0.55rem;
            letter-spacing: 0.35em; text-transform: uppercase;
            color: rgba(255,255,240,0.06);
            text-shadow: 0 1px 0 rgba(255,255,255,0.03), 0 -1px 0 rgba(0,0,0,0.6);
            position: relative;
        }
        .monitor-brand::before {
            content: ''; position: absolute; top: 6px; left: 50%; transform: translateX(-50%);
            width: 220px; height: 18px; border-radius: 2px;
            /* Embossed nameplate recess */
            background: linear-gradient(180deg, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0.08) 50%, rgba(255,255,255,0.01) 100%);
            border-top: 1px solid rgba(0,0,0,0.4);
            border-left: 1px solid rgba(0,0,0,0.3);
            border-right: 1px solid rgba(255,255,255,0.02);
            border-bottom: 1px solid rgba(255,255,255,0.03);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.4), 0 1px 0 rgba(255,255,255,0.015);
            z-index: -1;
        }
        .monitor-led {
            position: absolute; bottom: 16px; right: 30px;
            width: 8px; height: 8px; border-radius: 50%;
            background: radial-gradient(circle at 35% 35%, #88ff88, #33ff33 40%, #1a9e1a 80%, #0a5a0a);
            box-shadow: 0 0 4px var(--phosphor), 0 0 10px var(--phosphor), 0 0 20px rgba(51,255,51,0.4);
            animation: ledPulse 3s ease-in-out infinite;
        }
        .monitor-led::before {
            content: ''; position: absolute; inset: -4px; border-radius: 50%;
            /* LED housing — recessed chrome ring */
            border: 2px solid #1a1816;
            border-top-color: #0a0908; border-left-color: #0d0c0a;
            border-right-color: #2a2824; border-bottom-color: #33302a;
            background: radial-gradient(circle, transparent 40%, rgba(0,0,0,0.4));
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.5), 0 1px 0 rgba(255,255,255,0.03);
        }
        .monitor-led::after { content: 'PWR'; position: absolute; top: 0px; right: 18px;
            font-family: 'IBM Plex Mono', monospace; font-size: 0.42rem;
            letter-spacing: 0.15em; color: rgba(255,255,240,0.06);
            text-shadow: 0 1px 0 rgba(255,255,255,0.02); white-space: nowrap; }
        @keyframes ledPulse { 0%, 100% { opacity: 0.8; } 50% { opacity: 1; box-shadow: 0 0 4px var(--phosphor), 0 0 12px var(--phosphor), 0 0 24px rgba(51,255,51,0.5); } }

        /* Industrial vent slots — milled into the case */
        .monitor-vents { position: absolute; top: 12px; right: 26px; display: flex; gap: 4px; }
        .monitor-vents span {
            display: block; width: 16px; height: 3px; border-radius: 0.5px;
            background: linear-gradient(180deg, #050504, #0a0908);
            border-top: 1px solid rgba(0,0,0,0.6);
            border-bottom: 1px solid rgba(255,255,255,0.025);
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.6);
        }
        .monitor-vents-l { position: absolute; top: 12px; left: 26px; display: flex; gap: 4px; }
        .monitor-vents-l span {
            display: block; width: 16px; height: 3px; border-radius: 0.5px;
            background: linear-gradient(180deg, #050504, #0a0908);
            border-top: 1px solid rgba(0,0,0,0.6);
            border-bottom: 1px solid rgba(255,255,255,0.025);
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.6);
        }

        /* Raised panel ridges — stamped into the case */
        .monitor-ridge {
            position: absolute; left: 30px; right: 30px; height: 2px;
            z-index: 1; pointer-events: none;
            background: linear-gradient(180deg, rgba(0,0,0,0.3), rgba(255,255,255,0.015));
            border-top: 1px solid rgba(0,0,0,0.4);
            border-bottom: 1px solid rgba(255,255,255,0.02);
        }
        .monitor-ridge.top { top: 28px; }
        .monitor-ridge.bottom { bottom: 38px; }

        /* Embossed port labels */
        .monitor-port-label {
            position: absolute; bottom: 20px;
            font-family: 'IBM Plex Mono', monospace; font-size: 0.38rem;
            letter-spacing: 0.12em; text-transform: uppercase;
            color: rgba(255,255,240,0.04);
            text-shadow: 0 1px 0 rgba(255,255,255,0.015), 0 -1px 0 rgba(0,0,0,0.5);
            z-index: 2;
        }
        .monitor-port-label.left { left: 30px; }
        .monitor-port-label.right { right: 30px; }

        .back-bar {
            width: 100%; max-width: 960px;
            padding: 0.75rem 0 0;
            display: flex; justify-content: space-between; align-items: center;
        }
        .back-link {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.7rem; color: rgba(255,255,240,0.1);
            text-decoration: none; letter-spacing: 0.05em;
            transition: color 0.3s, text-shadow 0.3s;
        }
        .back-link:hover { color: var(--phosphor-dim); text-shadow: 0 0 6px rgba(51,255,51,0.2); }

        @keyframes phosphorFadeIn {
            0%   { opacity: 0; filter: brightness(2) blur(1px); }
            30%  { opacity: 1; filter: brightness(1.6) blur(0.3px); }
            100% { opacity: 1; filter: brightness(1) blur(0); }
        }

        /* ════ Speed selector ════ */
        .speed-selector { display: flex; gap: 0.3rem; align-items: center; }
        .speed-selector label { font-size: 0.8rem; color: var(--phosphor-dim); margin-right: 0.2rem; }
        .speed-btn {
            font-family: 'VT323', monospace; font-size: 0.8rem;
            padding: 0.1rem 0.4rem;
            background: transparent; border: 1px solid rgba(51,255,51,0.1);
            border-radius: 2px; color: var(--phosphor-dim);
            cursor: pointer; transition: all 0.15s;
        }
        .speed-btn:hover { border-color: rgba(51,255,51,0.3); color: var(--phosphor); }
        .speed-btn.active { border-color: var(--amber); color: var(--amber); background: rgba(247,147,26,0.06); }

        /* ════ Boot Sequence ════ */
        .boot-screen {
            position: absolute; inset: 0; z-index: 100;
            background: var(--crt-bg);
            padding: 1.2rem 1.5rem; overflow: hidden;
            font-family: 'VT323', monospace; font-size: 0.88rem;
            line-height: 1.45; color: var(--phosphor);
            display: flex; flex-direction: column;
        }
        .boot-screen.fade-out {
            animation: bootFade 0.8s ease-out forwards;
        }
        @keyframes bootFade {
            0% { opacity: 1; }
            15% { opacity: 1; filter: brightness(2.5); }
            100% { opacity: 0; pointer-events: none; }
        }
        .boot-text { white-space: pre-wrap; flex: 1; }
        .boot-text .boot-ok { color: var(--phosphor-bright); }
        .boot-text .boot-val { color: var(--amber); }
        .boot-text .boot-head { color: var(--amber); font-size: 1rem; text-shadow: 0 0 12px var(--amber-glow); }
        .boot-text .boot-dim { color: var(--phosphor-dim); }
        .boot-text .boot-warn { color: #ffcc00; }
        .boot-text .boot-bar { color: var(--phosphor-dim); }
        .boot-text .boot-hash { color: rgba(51,255,51,0.3); font-size: 0.72rem; letter-spacing: 0.05em; }
        .boot-cursor {
            color: var(--phosphor-bright); font-size: 1rem;
            animation: blink 0.6s step-end infinite;
        }

        /* ════ Login Screen ════ */
        .login-screen {
            position: absolute; inset: 0; z-index: 99;
            background: var(--crt-bg, #080c08);
            display: flex; align-items: center; justify-content: center;
            font-family: 'VT323', monospace;
        }
        .login-screen.fade-out {
            animation: bootFade 0.6s ease-out forwards;
        }
        .login-box {
            width: 90%; max-width: 420px;
            border: 1px solid rgba(51,255,51,0.12);
            background: rgba(5,10,5,0.6);
            padding: 2rem 2rem 1.5rem;
            position: relative;
        }
        .login-box::before {
            content: ''; position: absolute; inset: -1px;
            border: 1px solid rgba(51,255,51,0.04);
            pointer-events: none;
        }
        .login-header { text-align: center; margin-bottom: 1rem; }
        .login-logo {
            font-size: 2rem; margin-bottom: 0.3rem;
            color: var(--phosphor);
            text-shadow: 0 0 20px var(--phosphor-glow), 0 0 40px rgba(51,255,51,0.1);
        }
        .login-title {
            font-size: 1.3rem; letter-spacing: 0.25em;
            color: var(--phosphor-bright);
            text-shadow: 0 0 10px var(--phosphor-glow);
        }
        .login-subtitle {
            font-size: 0.78rem; letter-spacing: 0.15em;
            color: var(--phosphor-dim); margin-top: 0.2rem;
        }
        .login-divider {
            height: 1px; margin: 1rem 0;
            background: linear-gradient(90deg, transparent, rgba(51,255,51,0.15), transparent);
        }
        .login-hash-section { text-align: center; margin-bottom: 1.2rem; }
        .login-label {
            font-size: 0.7rem; letter-spacing: 0.2em;
            color: var(--phosphor-dim); margin-bottom: 0.5rem;
        }
        .login-hash {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.68rem; letter-spacing: 0.04em;
            color: rgba(51,255,51,0.4);
            word-break: break-all; line-height: 1.6;
            padding: 0.6rem 0.8rem;
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(51,255,51,0.06);
            margin-bottom: 0.8rem;
        }
        .login-hash .login-hash-tail {
            color: var(--phosphor-bright);
            text-shadow: 0 0 6px var(--phosphor-glow);
            border-bottom: 1px dashed rgba(51,255,51,0.3);
        }
        .login-instruction {
            font-size: 0.82rem; color: var(--phosphor-dim);
        }
        .login-highlight {
            color: var(--amber); text-shadow: 0 0 6px var(--amber-glow, rgba(247,147,26,0.2));
        }
        .login-input-row {
            display: flex; align-items: center; gap: 0.5rem;
            border: 1px solid rgba(51,255,51,0.1);
            background: rgba(0,0,0,0.3);
            padding: 0.5rem 0.8rem;
            margin-bottom: 0.5rem;
        }
        .login-prompt {
            color: var(--phosphor-dim); font-size: 0.9rem;
            white-space: nowrap;
        }
        .login-input {
            flex: 1; background: transparent; border: none; outline: none;
            font-family: 'VT323', monospace; font-size: 1.1rem;
            color: var(--phosphor-bright); letter-spacing: 0.3em;
            caret-color: var(--phosphor);
            text-transform: lowercase;
        }
        .login-input::placeholder {
            color: rgba(51,255,51,0.12); letter-spacing: 0.4em;
        }
        .login-error {
            font-size: 0.8rem; color: #ff4444;
            text-shadow: 0 0 6px rgba(255,50,50,0.3);
            min-height: 1.2em; text-align: center;
            margin-bottom: 0.5rem;
        }
        .login-error.shake {
            animation: loginShake 0.35s ease;
        }
        @keyframes loginShake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-6px); }
            40% { transform: translateX(6px); }
            60% { transform: translateX(-4px); }
            80% { transform: translateX(4px); }
        }
        .login-success {
            color: var(--phosphor-bright) !important;
            text-shadow: 0 0 8px var(--phosphor-glow) !important;
        }
        .login-footer { text-align: center; margin-top: 0.5rem; }
        .login-footer-dim {
            font-size: 0.65rem; color: rgba(51,255,51,0.15);
            letter-spacing: 0.05em;
        }
        /* Theme overrides */
        [data-theme="amber"] .login-box { border-color: rgba(255,170,51,0.12); background: rgba(10,5,2,0.6); }
        [data-theme="amber"] .login-box::before { border-color: rgba(255,170,51,0.04); }
        [data-theme="amber"] .login-hash { border-color: rgba(255,170,51,0.06); color: rgba(255,170,51,0.4); }
        [data-theme="amber"] .login-hash .login-hash-tail { color: var(--phosphor-bright); border-color: rgba(255,170,51,0.3); }
        [data-theme="amber"] .login-input-row { border-color: rgba(255,170,51,0.1); }
        [data-theme="amber"] .login-divider { background: linear-gradient(90deg, transparent, rgba(255,170,51,0.15), transparent); }
        [data-theme="amber"] .login-footer-dim { color: rgba(255,170,51,0.15); }
        [data-theme="dark"] .login-box { border-color: rgba(136,170,204,0.1); background: rgba(3,4,6,0.6); }
        [data-theme="dark"] .login-box::before { border-color: rgba(136,170,204,0.03); }
        [data-theme="dark"] .login-hash { border-color: rgba(136,170,204,0.06); color: rgba(136,170,204,0.35); }
        [data-theme="dark"] .login-hash .login-hash-tail { color: var(--phosphor-bright); border-color: rgba(136,170,204,0.25); }
        [data-theme="dark"] .login-input-row { border-color: rgba(136,170,204,0.08); }
        [data-theme="dark"] .login-divider { background: linear-gradient(90deg, transparent, rgba(136,170,204,0.12), transparent); }
        [data-theme="dark"] .login-footer-dim { color: rgba(136,170,204,0.12); }

        /* ════ Phosphor Burn-in ════ */
        .burn-layer {
            position: absolute; inset: 0; z-index: 5;
            pointer-events: none; overflow: hidden;
            border-radius: 12px;
        }
        .burn-ghost {
            position: absolute; inset: 0;
            pointer-events: none; overflow: hidden;
            padding: 1.2rem 1.5rem;
            color: var(--phosphor);
            font-family: 'VT323', monospace;
            font-size: inherit;
            filter: blur(0.7px);
            opacity: 0;
            animation: burnFade 3s ease-out forwards;
            white-space: pre-wrap;
            word-break: break-word;
        }
        .burn-ghost * { pointer-events: none !important; cursor: default !important; }
        .burn-ghost .tab-bar,
        .burn-ghost .faq-input-bar,
        .burn-ghost .email-controls,
        .burn-ghost .email-progress,
        .burn-ghost .faq-topics,
        .burn-ghost .boot-screen { display: none !important; }
        .burn-ghost .faq-cursor { display: none; }
        .burn-ghost input,
        .burn-ghost button { visibility: hidden; }
        /* Flatten all burn text to one ghostly green */
        .burn-ghost, .burn-ghost * {
            color: var(--phosphor) !important;
            text-shadow: none !important;
            border-color: transparent !important;
            background: transparent !important;
        }
        @keyframes burnFade {
            0%   { opacity: 0.07; }
            8%   { opacity: 0.04; }
            30%  { opacity: 0.015; }
            100% { opacity: 0; }
        }
        @keyframes burnFadeStrong {
            0%   { opacity: 0.09; }
            10%  { opacity: 0.05; }
            35%  { opacity: 0.015; }
            100% { opacity: 0; }
        }
        /* Stronger burn variant for persistent content */
        .burn-ghost.burn-strong {
            filter: blur(0.5px);
            animation: burnFadeStrong 4.5s ease-out forwards;
        }

        /* ════ FAQ Tab ════ */
        .faq-topics {
            display: flex; flex-wrap: wrap; gap: 0.3rem; padding: 0.5rem 0;
            border-bottom: 1px solid rgba(51,255,51,0.08); margin-bottom: 0;
        }
        .faq-topic-btn {
            font-family: 'VT323', monospace; font-size: 0.9rem;
            background: rgba(51,255,51,0.03); color: var(--phosphor-dim);
            border: 1px solid rgba(51,255,51,0.08); border-radius: 3px;
            padding: 0.15rem 0.5rem; cursor: pointer; transition: all 0.15s;
        }
        .faq-topic-btn:hover { background: rgba(51,255,51,0.06); color: var(--phosphor); border-color: rgba(51,255,51,0.2); }
        .faq-topic-btn.active { background: rgba(51,255,51,0.08); color: var(--phosphor-bright); border-color: rgba(51,255,51,0.3); text-shadow: 0 0 8px var(--phosphor-glow); }
        .faq-scroll { flex: 1; overflow-y: auto; padding: 0.5rem 0; }
        .faq-input-bar {
            display: flex; align-items: center; gap: 0.5rem;
            border-top: 1px solid rgba(51,255,51,0.1); padding-top: 0.5rem; margin-top: auto;
        }
        .faq-prompt { color: var(--amber); font-size: 0.95rem; white-space: nowrap; }
        .faq-input {
            flex: 1; background: transparent; border: none; outline: none;
            color: var(--phosphor-bright); font-family: 'VT323', monospace; font-size: 1.05rem;
            caret-color: var(--phosphor-bright);
        }
        .faq-input::placeholder { color: rgba(51,255,51,0.15); }
        .faq-welcome { margin-bottom: 0.5rem; line-height: 1.5; }
        .faq-welcome .title-art {
            color: var(--amber); font-size: 1.15rem; margin-bottom: 0.3rem;
            text-shadow: 0 0 12px var(--amber-glow);
        }
        .faq-welcome .hint { color: rgba(51,255,51,0.3); font-size: 0.85rem; }
        .faq-entry { margin-bottom: 0.8rem; padding-bottom: 0.5rem; border-bottom: 1px solid rgba(51,255,51,0.04); }
        .faq-entry-q {
            color: var(--amber); font-size: 1rem; margin-bottom: 0.2rem; cursor: default;
            text-shadow: 0 0 6px var(--amber-glow);
        }
        .faq-entry-a { color: var(--phosphor); font-size: 0.92rem; line-height: 1.5; white-space: pre-wrap; }
        .faq-entry-source { color: rgba(51,255,51,0.25); font-size: 0.78rem; margin-top: 0.2rem; }
        .faq-entry-bc2 {
            margin-top: 0.3rem; padding: 0.3rem 0.5rem; font-size: 0.82rem;
            border-left: 2px solid var(--amber-dim); color: rgba(247,147,26,0.7);
            background: rgba(247,147,26,0.03);
        }
        .faq-system { color: var(--phosphor-dim); margin-bottom: 0.4rem; font-size: 0.9rem; }
        .faq-system .cmd { color: var(--phosphor-bright); }
        .faq-cursor { display: inline-block; width: 0.55em; height: 1.1em; background: var(--phosphor); vertical-align: text-bottom; animation: blink 0.7s step-end infinite; }
        @keyframes blink { 50% { opacity: 0; } }
        .faq-topic-item {
            padding: 0.25rem 0.4rem; cursor: pointer; color: var(--phosphor);
            transition: all 0.1s; font-size: 0.9rem;
        }
        .faq-topic-item:hover { color: var(--phosphor-bright); background: rgba(51,255,51,0.04); text-shadow: 0 0 8px var(--phosphor-glow); }
        .faq-topic-item::before { content: '▸ '; color: var(--phosphor-dim); }
        .faq-search-match { color: var(--amber); margin: 0.2rem 0; padding: 0.2rem 0.4rem; cursor: pointer; transition: all 0.1s; font-size: 0.88rem; }
        .faq-search-match:hover { background: rgba(247,147,26,0.06); }
        .faq-search-match::before { content: '◈ '; }

        /* ════ Bezel Controls ════ */
        .bezel-controls {
            display: flex; align-items: center; justify-content: center; gap: 1rem;
            padding: 3px 0 0; position: relative; z-index: 5;
        }
        .theme-toggle { display: flex; gap: 8px; align-items: center; }
        .theme-btn {
            width: 18px; height: 18px; border-radius: 50%; cursor: pointer;
            position: relative; padding: 0;
            /* Chunky inset socket */
            background: linear-gradient(145deg, #1a1816, #0a0908);
            border-top: 2px solid #080706;
            border-left: 2px solid #0a0908;
            border-right: 2px solid #2a2824;
            border-bottom: 2px solid #33302a;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.7), 0 1px 0 rgba(255,255,255,0.025);
            transition: all 0.2s;
        }
        .theme-btn span {
            display: block; width: 8px; height: 8px; border-radius: 50%;
            position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%);
        }
        .theme-btn.active {
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.7), 0 1px 0 rgba(255,255,255,0.025),
                0 0 8px var(--glow-color, rgba(51,255,51,0.3)), 0 0 16px var(--glow-color, rgba(51,255,51,0.15));
        }
        .theme-green { --glow-color: rgba(51,255,51,0.4); }
        .theme-green span { background: radial-gradient(circle at 35% 35%, #66ff66, #33ff33 60%, #1a8a1a); box-shadow: 0 0 4px rgba(51,255,51,0.5); }
        .theme-amber-btn { --glow-color: rgba(247,147,26,0.4); }
        .theme-amber-btn span { background: radial-gradient(circle at 35% 35%, #ffcc66, #F7931A 60%, #aa6600); box-shadow: 0 0 4px rgba(247,147,26,0.5); }
        .theme-dark { --glow-color: rgba(100,200,255,0.3); }
        .theme-dark span { background: radial-gradient(circle at 35% 35%, #88ccee, #5588aa 60%, #335566); box-shadow: 0 0 4px rgba(100,180,255,0.4); }
        .star-view-btn {
            font-family: 'VT323', monospace; font-size: 0.8rem;
            /* Recessed industrial button */
            background: linear-gradient(180deg, #0e0d0b, #0a0908);
            border-top: 1px solid rgba(0,0,0,0.5);
            border-left: 1px solid rgba(0,0,0,0.3);
            border-right: 1px solid rgba(255,255,255,0.03);
            border-bottom: 1px solid rgba(255,255,255,0.04);
            color: rgba(255,200,50,0.35); border-radius: 3px; padding: 2px 10px;
            cursor: pointer; transition: all 0.2s;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.4), 0 1px 0 rgba(255,255,255,0.02);
        }
        .star-view-btn:hover { color: rgba(255,200,50,0.6); box-shadow: inset 0 1px 3px rgba(0,0,0,0.4), 0 0 6px rgba(255,200,50,0.1); }

        /* ════ Favorites Drawer ════ */
        .fav-drawer {
            position: absolute; top: 0; right: 0; bottom: 0;
            width: 55%; max-width: 340px; min-width: 220px;
            z-index: 90; pointer-events: auto;
            background: rgba(5,8,5,0.97);
            border-left: 1px solid rgba(51,255,51,0.12);
            box-shadow: -4px 0 20px rgba(0,0,0,0.6), -1px 0 0 rgba(51,255,51,0.06);
            display: flex; flex-direction: column;
            transform: translateX(100%);
            transition: transform 0.25s ease;
            font-family: 'VT323', monospace;
        }
        .fav-drawer.open { transform: translateX(0); }
        .fav-drawer-header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 0.8rem 1rem 0.6rem;
            border-bottom: 1px solid rgba(51,255,51,0.1);
        }
        .fav-drawer-title {
            color: #ffd700; font-size: 0.95rem;
            text-shadow: 0 0 8px rgba(255,215,0,0.3);
            letter-spacing: 0.05em;
        }
        .fav-drawer-close {
            background: none; border: 1px solid rgba(51,255,51,0.1);
            color: var(--phosphor-dim); font-size: 0.9rem;
            cursor: pointer; padding: 1px 7px; border-radius: 2px;
            font-family: inherit; transition: all 0.15s;
        }
        .fav-drawer-close:hover { color: var(--phosphor); border-color: rgba(51,255,51,0.25); }
        .fav-drawer-empty {
            padding: 1.5rem 1rem; color: var(--phosphor-dim);
            font-size: 0.85rem; line-height: 1.5; text-align: center;
            display: none;
        }
        .fav-drawer-empty.visible { display: block; }
        .fav-drawer-list {
            flex: 1; overflow-y: auto; padding: 0.5rem 0;
        }
        .fav-drawer-list::-webkit-scrollbar { width: 4px; }
        .fav-drawer-list::-webkit-scrollbar-thumb { background: rgba(51,255,51,0.1); border-radius: 2px; }
        .fav-drawer-section {
            padding: 0.3rem 1rem 0.1rem;
            color: var(--phosphor-dim); font-size: 0.75rem;
            letter-spacing: 0.08em; text-transform: uppercase;
        }
        .fav-drawer-item {
            display: flex; align-items: flex-start; gap: 0.4rem;
            padding: 0.35rem 1rem; cursor: pointer;
            transition: background 0.1s;
            color: var(--phosphor); font-size: 0.85rem;
            line-height: 1.35;
        }
        .fav-drawer-item:hover { background: rgba(51,255,51,0.04); }
        .fav-drawer-item .star-btn { font-size: 0.85rem; flex-shrink: 0; padding: 0 2px; }
        .fav-drawer-item-text { flex: 1; }
        .fav-drawer-item-sub {
            font-size: 0.72rem; color: var(--phosphor-dim);
            margin-top: 1px;
        }
        .fav-drawer-divider {
            height: 1px; margin: 0.3rem 1rem;
            background: rgba(51,255,51,0.06);
        }
        /* Theme overrides */
        [data-theme="amber"] .fav-drawer { background: rgba(8,5,2,0.97); border-color: rgba(255,170,51,0.12); box-shadow: -4px 0 20px rgba(0,0,0,0.6), -1px 0 0 rgba(255,170,51,0.06); }
        [data-theme="amber"] .fav-drawer-close { border-color: rgba(255,170,51,0.1); color: var(--phosphor-dim); }
        [data-theme="amber"] .fav-drawer-close:hover { color: var(--phosphor); border-color: rgba(255,170,51,0.25); }
        [data-theme="amber"] .fav-drawer-item:hover { background: rgba(255,170,51,0.04); }
        [data-theme="amber"] .fav-drawer-section { color: var(--phosphor-dim); }
        [data-theme="amber"] .fav-drawer-divider { background: rgba(255,170,51,0.06); }
        [data-theme="amber"] .fav-drawer-list::-webkit-scrollbar-thumb { background: rgba(255,170,51,0.1); }
        [data-theme="dark"] .fav-drawer { background: rgba(3,4,6,0.97); border-color: rgba(136,170,204,0.1); box-shadow: -4px 0 20px rgba(0,0,0,0.6), -1px 0 0 rgba(136,170,204,0.05); }
        [data-theme="dark"] .fav-drawer-close { border-color: rgba(136,170,204,0.1); }
        [data-theme="dark"] .fav-drawer-close:hover { color: var(--phosphor); border-color: rgba(136,170,204,0.2); }
        [data-theme="dark"] .fav-drawer-item:hover { background: rgba(136,170,204,0.04); }
        [data-theme="dark"] .fav-drawer-divider { background: rgba(136,170,204,0.05); }
        [data-theme="dark"] .fav-drawer-list::-webkit-scrollbar-thumb { background: rgba(136,170,204,0.1); }

        /* ════ Favorites ════ */
        .star-btn {
            background: none; border: none; cursor: pointer; font-size: 1rem;
            color: rgba(255,200,50,0.15); transition: all 0.15s; padding: 0 4px;
            vertical-align: middle; line-height: 1;
        }
        .star-btn:hover { color: rgba(255,200,50,0.5); }
        .star-btn.starred { color: #ffd700; text-shadow: 0 0 6px rgba(255,215,0,0.4); }

        /* ════ Theme: Amber ════ */
        [data-theme="amber"] { --phosphor: #ffaa33; --phosphor-dim: #aa7722; --phosphor-bright: #ffcc66;
            --phosphor-glow: rgba(255,170,51,0.15); --phosphor-faint: rgba(255,170,51,0.06); }
        [data-theme="amber"] .crt { box-shadow: inset 0 0 80px rgba(255,170,51,0.015), inset 0 0 20px rgba(255,170,51,0.01); }
        [data-theme="amber"] .scan-bar { background: linear-gradient(180deg, transparent, rgba(255,170,51,0.012), transparent); }
        [data-theme="amber"] .boot-text .boot-ok { color: var(--phosphor-bright); }
        [data-theme="amber"] .faq-entry-q { color: #ffcc66; text-shadow: 0 0 6px rgba(255,200,80,0.3); }
        [data-theme="amber"] .faq-prompt { color: #ffdd88; }
        [data-theme="amber"] .faq-topic-btn.active { border-color: rgba(255,170,51,0.3); color: var(--phosphor-bright); }
        [data-theme="amber"] .email-hdr-val.from-satoshi { color: #ffcc66; }
        [data-theme="amber"] .faq-entry-bc2 { border-color: rgba(255,170,51,0.3); color: rgba(255,200,80,0.7); }
        [data-theme="amber"] .burn-ghost, [data-theme="amber"] .burn-ghost * { color: #ffaa33 !important; }
        [data-theme="amber"] .monitor-led { background: radial-gradient(circle at 35% 35%, #ffdd88, #F7931A 40%, #aa6600 80%, #553300); }
        [data-theme="amber"] .monitor-led::before { box-shadow: inset 0 1px 2px rgba(0,0,0,0.5), 0 1px 0 rgba(255,255,255,0.03); }

        /* ════ Theme: Dark ════ */
        [data-theme="dark"] { --phosphor: #88aacc; --phosphor-dim: #445566; --phosphor-bright: #aaccee;
            --phosphor-glow: rgba(136,170,204,0.12); --phosphor-faint: rgba(136,170,204,0.04); }
        [data-theme="dark"] .crt-bg, [data-theme="dark"] .crt { background: #040506; }
        [data-theme="dark"] .screen { text-shadow: 0.3px 0 0 rgba(80,120,180,0.05), -0.3px 0 0 rgba(80,80,120,0.05); }
        [data-theme="dark"] .crt { box-shadow: inset 0 0 80px rgba(100,150,200,0.01), inset 0 0 20px rgba(100,150,200,0.008); }
        [data-theme="dark"] .scan-bar { background: linear-gradient(180deg, transparent, rgba(100,150,200,0.008), transparent); }
        [data-theme="dark"] .boot-text .boot-ok { color: var(--phosphor-bright); }
        [data-theme="dark"] .boot-text .boot-val { color: #88bbdd; }
        [data-theme="dark"] .boot-text .boot-head { color: #aaccee; text-shadow: 0 0 10px rgba(136,170,204,0.3); }
        [data-theme="dark"] .faq-entry-q { color: #aaccee; text-shadow: 0 0 6px rgba(136,170,204,0.2); }
        [data-theme="dark"] .faq-prompt { color: #99bbdd; }
        [data-theme="dark"] .faq-topic-btn.active { border-color: rgba(136,170,204,0.3); color: var(--phosphor-bright); }
        [data-theme="dark"] .faq-entry-bc2 { border-color: rgba(136,170,204,0.25); color: rgba(150,190,220,0.65); }
        [data-theme="dark"] .email-hdr-val.from-satoshi { color: #aaccee; }
        [data-theme="dark"] .burn-ghost, [data-theme="dark"] .burn-ghost * { color: #88aacc !important; }
        [data-theme="dark"] .tab-btn.tab-amber.active { background: rgba(136,170,204,0.08); border-color: rgba(136,170,204,0.3); color: #aaccee; }
        [data-theme="dark"] .tab-btn.tab-cyan.active { background: rgba(100,200,255,0.06); border-color: rgba(100,200,255,0.25); color: #88ddff; }
        [data-theme="dark"] .monitor-led { background: radial-gradient(circle at 35% 35%, #bbddff, #5588aa 40%, #335566 80%, #223344); }
        [data-theme="dark"] .monitor-led::before { box-shadow: inset 0 1px 2px rgba(0,0,0,0.5), 0 1px 0 rgba(255,255,255,0.03); }
        [data-theme="dark"] .wp-title.amber { color: #bbddff; text-shadow: 0 0 10px rgba(136,170,204,0.3); }
        [data-theme="dark"] .wp-section-title.amber { color: #bbddff; text-shadow: 0 0 8px rgba(136,170,204,0.25); border-color: rgba(136,170,204,0.12); }

        /* ════ Resources Tab ════ */
        .resources-page {
            padding: 0.5rem 0.5rem 2rem; color: var(--phosphor);
            font-family: 'VT323', monospace; line-height: 1.5;
        }
        .res-header { text-align: center; margin-bottom: 1.5rem; padding-bottom: 1rem;
            border-bottom: 1px solid rgba(51,255,51,0.08); }
        .res-title { font-size: 1.2rem; color: var(--phosphor-bright);
            text-shadow: 0 0 10px var(--phosphor-glow); letter-spacing: 0.08em; margin-bottom: 0.3rem; }
        .res-subtitle { font-size: 0.82rem; color: var(--phosphor-dim); }
        .res-section { margin-bottom: 1.3rem; }
        .res-section-title { font-size: 0.95rem; color: var(--phosphor-bright);
            text-shadow: 0 0 6px var(--phosphor-glow); margin-bottom: 0.5rem;
            padding-bottom: 0.3rem; border-bottom: 1px solid rgba(51,255,51,0.06); }
        .res-text { font-size: 0.85rem; color: var(--phosphor); margin-bottom: 0.4rem; line-height: 1.55; }
        .res-steps { margin: 0.5rem 0 0 0.3rem; }
        .res-step { display: flex; align-items: flex-start; gap: 0.5rem;
            font-size: 0.82rem; color: var(--phosphor); margin-bottom: 0.35rem; }
        .res-num { display: inline-flex; align-items: center; justify-content: center;
            width: 18px; height: 18px; flex-shrink: 0;
            border: 1px solid rgba(51,255,51,0.2); border-radius: 2px;
            font-size: 0.7rem; color: var(--phosphor-bright); }
        .res-detail { font-size: 0.82rem; color: var(--phosphor-dim);
            padding-left: 0.8rem; margin-bottom: 0.25rem; line-height: 1.45; }
        .res-quote { color: var(--amber); font-style: italic;
            text-shadow: 0 0 4px var(--amber-glow, rgba(247,147,26,0.15)); }
        .res-link { color: var(--phosphor-bright); text-decoration: none;
            border-bottom: 1px dashed rgba(51,255,51,0.3); transition: all 0.15s; }
        .res-link:hover { color: #fff; text-shadow: 0 0 6px var(--phosphor-glow);
            border-color: var(--phosphor); }
        .res-link-list { display: flex; flex-direction: column; gap: 0.4rem; margin-top: 0.3rem; }
        .res-link-item { display: flex; align-items: center; gap: 0.6rem;
            padding: 0.5rem 0.7rem; border: 1px solid rgba(51,255,51,0.06);
            background: rgba(51,255,51,0.015); text-decoration: none; transition: all 0.15s; cursor: pointer; }
        .res-link-item:hover { border-color: rgba(51,255,51,0.15); background: rgba(51,255,51,0.03); }
        .res-link-icon { font-size: 1.1rem; flex-shrink: 0; width: 1.5rem; text-align: center; }
        .res-link-text { display: flex; flex-direction: column; font-size: 0.85rem; color: var(--phosphor-bright); }
        .res-link-desc { font-size: 0.7rem; color: var(--phosphor-dim); margin-top: 1px; }
        .res-quote-block { display: flex; flex-direction: column; gap: 0.8rem; margin-top: 0.5rem; }
        .res-quote-item { font-size: 0.82rem; color: var(--phosphor); padding: 0.6rem 0.8rem;
            border-left: 2px solid rgba(51,255,51,0.15); background: rgba(51,255,51,0.01);
            line-height: 1.5; font-style: italic; }
        .res-quote-src { display: block; font-style: normal; font-size: 0.7rem;
            color: var(--phosphor-dim); margin-top: 0.3rem; }
        .res-footer { text-align: center; margin-top: 2rem; padding-top: 1rem;
            border-top: 1px solid rgba(51,255,51,0.06); }
        .res-footer-text { font-size: 0.72rem; color: rgba(51,255,51,0.2); letter-spacing: 0.1em; }
        [data-theme="amber"] .res-num { border-color: rgba(255,170,51,0.2); }
        [data-theme="amber"] .res-link-item { border-color: rgba(255,170,51,0.06); background: rgba(255,170,51,0.015); }
        [data-theme="amber"] .res-link-item:hover { border-color: rgba(255,170,51,0.15); background: rgba(255,170,51,0.03); }
        [data-theme="amber"] .res-quote-item { border-color: rgba(255,170,51,0.15); background: rgba(255,170,51,0.01); }
        [data-theme="amber"] .res-quote { color: #ffcc66; }
        [data-theme="dark"] .res-num { border-color: rgba(136,170,204,0.2); }
        [data-theme="dark"] .res-link-item { border-color: rgba(136,170,204,0.06); background: rgba(136,170,204,0.015); }
        [data-theme="dark"] .res-link-item:hover { border-color: rgba(136,170,204,0.12); background: rgba(136,170,204,0.025); }
        [data-theme="dark"] .res-quote-item { border-color: rgba(136,170,204,0.12); background: rgba(136,170,204,0.01); }
        [data-theme="dark"] .res-quote { color: #bbddff; }

        /* ════ Desktop Environment ════ */
        .desktop-env {
            display: flex; flex-direction: column; flex: 1; min-height: 0;
            font-family: 'VT323', monospace; position: relative; overflow: hidden;
        }
        .desktop-grid {
            flex: 1; display: grid;
            grid-template-columns: repeat(auto-fill, 80px);
            grid-auto-rows: 90px;
            gap: 4px; padding: 12px; align-content: start;
        }
        .desk-icon {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            gap: 4px; cursor: pointer; padding: 6px 4px; border-radius: 4px;
            border: 1px solid transparent; transition: all 0.12s; user-select: none;
        }
        .desk-icon:hover { border-color: rgba(51,255,51,0.15); background: rgba(51,255,51,0.04); }
        .desk-icon:active { background: rgba(51,255,51,0.08); }
        .desk-icon-glyph {
            font-size: 1.6rem; color: var(--phosphor-bright);
            text-shadow: 0 0 8px var(--phosphor-glow);
            width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;
            border: 1px solid rgba(51,255,51,0.1); background: rgba(51,255,51,0.02);
        }
        .desk-icon-label {
            font-size: 0.7rem; color: var(--phosphor); text-align: center;
            max-width: 72px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
        }

        /* Window system */
        .desktop-windows {
            position: absolute; top: 0; left: 0; right: 0; bottom: 24px;
            pointer-events: none; z-index: 60;
        }
        .app-window {
            position: absolute; min-width: 260px; min-height: 180px;
            pointer-events: auto;
            border: 1px solid rgba(51,255,51,0.2);
            background: rgba(2,6,2,0.97);
            box-shadow: 0 4px 20px rgba(0,0,0,0.7), 0 0 30px rgba(51,255,51,0.02);
            display: flex; flex-direction: column; z-index: 60;
            animation: winPhosphorIn 0.35s ease-out;
        }
        @keyframes winPhosphorIn {
            0%   { opacity: 0; filter: brightness(2.5) blur(2px); transform: scale(0.96); }
            40%  { opacity: 1; filter: brightness(1.5) blur(0.5px); transform: scale(1.01); }
            100% { opacity: 1; filter: brightness(1) blur(0); transform: scale(1); }
        }
        .app-window.win-closing {
            animation: winPhosphorOut 0.3s ease-in forwards;
            pointer-events: none;
        }
        @keyframes winPhosphorOut {
            0%   { opacity: 1; filter: brightness(1); }
            30%  { opacity: 0.7; filter: brightness(2) blur(0.5px); }
            100% { opacity: 0; filter: brightness(3) blur(3px); transform: scale(0.97); }
        }
        .win-burn-ghost {
            position: absolute; pointer-events: none; overflow: hidden;
            border: 1px solid transparent;
            opacity: 0; animation: winBurnFade 2.5s ease-out forwards;
        }
        @keyframes winBurnFade {
            0%   { opacity: 0.12; filter: blur(1px) brightness(1.5); }
            15%  { opacity: 0.05; filter: blur(1.5px) brightness(1.2); }
            40%  { opacity: 0.02; filter: blur(2px); }
            100% { opacity: 0; filter: blur(3px); }
        }
        .app-window.focused { border-color: rgba(51,255,51,0.35);
            box-shadow: 0 4px 20px rgba(0,0,0,0.7), 0 0 40px rgba(51,255,51,0.04); }
        .win-titlebar {
            display: flex; align-items: center; justify-content: space-between;
            padding: 3px 8px; background: rgba(51,255,51,0.06);
            border-bottom: 1px solid rgba(51,255,51,0.1);
            cursor: grab; user-select: none; flex-shrink: 0;
        }
        .app-window.focused .win-titlebar { background: rgba(51,255,51,0.1); }
        .win-title { font-size: 0.78rem; color: var(--phosphor-bright); letter-spacing: 0.05em; }
        .win-close {
            width: 18px; height: 18px; display: flex; align-items: center; justify-content: center;
            font-size: 0.8rem; color: var(--phosphor-dim); cursor: pointer;
            border: 1px solid rgba(51,255,51,0.1); background: transparent;
            font-family: 'VT323', monospace; transition: all 0.1s;
        }
        .win-close:hover { color: #ff4444; border-color: rgba(255,68,68,0.3); background: rgba(255,0,0,0.06); }
        .win-body { flex: 1; overflow: hidden; position: relative; }
        .win-body > * { animation: phosphorFadeIn 0.4s ease-out; }

        /* Taskbar */
        .desktop-taskbar {
            height: 24px; flex-shrink: 0;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 10px;
            background: rgba(51,255,51,0.04);
            border-top: 1px solid rgba(51,255,51,0.08);
            font-size: 0.68rem; color: var(--phosphor-dim);
        }
        .taskbar-clock { font-family: 'Share Tech Mono', monospace; letter-spacing: 0.05em; }


        /* ═══ Minesweeper ═══ */
        .mines-wrap { display: flex; flex-direction: column; align-items: center; height: 100%; padding: 8px; }
        .mines-hud { display: flex; justify-content: space-between; width: 100%; padding: 2px 4px; margin-bottom: 4px;
            font-size: 0.78rem; color: var(--phosphor); }
        .mines-grid { display: inline-grid; gap: 1px; }
        .mines-cell {
            width: 22px; height: 22px; display: flex; align-items: center; justify-content: center;
            font-size: 0.7rem; cursor: pointer; font-family: 'VT323', monospace;
            background: rgba(51,255,51,0.06); border: 1px solid rgba(51,255,51,0.1);
            color: var(--phosphor); transition: background 0.08s; user-select: none;
        }
        .mines-cell:hover:not(.revealed):not(.flagged) { background: rgba(51,255,51,0.12); }
        .mines-cell.revealed { background: rgba(0,0,0,0.3); border-color: rgba(51,255,51,0.04); cursor: default; }
        .mines-cell.flagged { color: #ff4444; }
        .mines-cell.boom { background: rgba(255,0,0,0.15); color: #ff4444; }
        .mines-cell.n1 { color: #33ff33; } .mines-cell.n2 { color: #33ccff; }
        .mines-cell.n3 { color: #ff6633; } .mines-cell.n4 { color: #cc33ff; }
        .mines-cell.n5 { color: #ff3333; } .mines-cell.n6 { color: #33ffcc; }
        .mines-msg { font-size: 0.82rem; color: var(--phosphor-bright); text-align: center; margin-top: 6px; }

        /* ═══ Breakout ═══ */
        .breakout-wrap { display: flex; flex-direction: column; align-items: center; height: 100%; padding: 8px; }
        .breakout-hud { display: flex; justify-content: space-between; width: 100%; padding: 2px 4px; margin-bottom: 4px;
            font-size: 0.78rem; color: var(--phosphor); }
        .breakout-canvas { border: 1px solid rgba(51,255,51,0.15); background: rgba(0,0,0,0.3); }
        .breakout-msg { font-size: 0.82rem; color: var(--phosphor-bright); text-align: center; margin-top: 6px; }



        /* Theme overrides for desktop */
        [data-theme="amber"] .desk-icon:hover { border-color: rgba(255,170,51,0.15); background: rgba(255,170,51,0.04); }
        [data-theme="amber"] .desk-icon-glyph { border-color: rgba(255,170,51,0.1); background: rgba(255,170,51,0.02); }
        [data-theme="amber"] .app-window { border-color: rgba(255,170,51,0.2); background: rgba(6,3,1,0.97); }
        [data-theme="amber"] .app-window.focused { border-color: rgba(255,170,51,0.35); }
        [data-theme="amber"] .win-titlebar { background: rgba(255,170,51,0.06); border-color: rgba(255,170,51,0.1); }
        [data-theme="amber"] .app-window.focused .win-titlebar { background: rgba(255,170,51,0.1); }
        [data-theme="amber"] .win-close { border-color: rgba(255,170,51,0.1); }
        [data-theme="amber"] .desktop-taskbar { background: rgba(255,170,51,0.04); border-color: rgba(255,170,51,0.08); }
        [data-theme="amber"] .breakout-canvas { border-color: rgba(255,170,51,0.15); }
        [data-theme="amber"] .mines-cell { background: rgba(255,170,51,0.06); border-color: rgba(255,170,51,0.1); }
        [data-theme="amber"] .mines-cell:hover:not(.revealed) { background: rgba(255,170,51,0.12); }
        [data-theme="amber"] .mines-cell.revealed { border-color: rgba(255,170,51,0.04); }
        [data-theme="dark"] .desk-icon:hover { border-color: rgba(136,170,204,0.12); background: rgba(136,170,204,0.04); }
        [data-theme="dark"] .desk-icon-glyph { border-color: rgba(136,170,204,0.1); background: rgba(136,170,204,0.02); }
        [data-theme="dark"] .app-window { border-color: rgba(136,170,204,0.15); background: rgba(2,3,6,0.97); }
        [data-theme="dark"] .app-window.focused { border-color: rgba(136,170,204,0.3); }
        [data-theme="dark"] .win-titlebar { background: rgba(136,170,204,0.05); border-color: rgba(136,170,204,0.08); }
        [data-theme="dark"] .app-window.focused .win-titlebar { background: rgba(136,170,204,0.08); }
        [data-theme="dark"] .desktop-taskbar { background: rgba(136,170,204,0.03); border-color: rgba(136,170,204,0.06); }
        [data-theme="dark"] .mines-cell { background: rgba(136,170,204,0.06); border-color: rgba(136,170,204,0.08); }

        /* ════ Responsive ════ */
        @media (max-width: 700px) {
            .desk { padding: 0.5rem; }
            .monitor { padding: 12px 12px 20px; border-radius: 16px; }
            .monitor-screw, .monitor-vents-l, .monitor-ridge, .monitor-port-label { display: none; }
            .screen { padding: 0.8rem; }
            .tab-btn { font-size: 0.85rem; padding: 0.3rem 0.6rem; }
            .faq-topic-btn { font-size: 0.78rem; padding: 0.12rem 0.35rem; }
            .faq-prompt { font-size: 0.8rem; }
            .email-hdr { grid-template-columns: 4rem 1fr; }
            .crt { height: min(85vh, 700px); }
        }
    </style>
</head>
<body>
    <div class="desk">
        <div class="monitor">
            <div class="monitor-screw tl"></div>
            <div class="monitor-screw tr"></div>
            <div class="monitor-screw bl"></div>
            <div class="monitor-screw br"></div>
            <div class="monitor-ridge top"></div>
            <div class="monitor-ridge bottom"></div>
            <div class="monitor-vents"><span></span><span></span><span></span><span></span><span></span><span></span></div>
            <div class="monitor-vents-l"><span></span><span></span><span></span><span></span><span></span><span></span></div>
            <div class="monitor-port-label left">SER-A</div>
            <div class="monitor-port-label right">COAX</div>
            <div class="bezel">
                <div class="crt">
                    <div class="scan-bar"></div>
                    <div class="crt-noise"><canvas id="noiseCanvas"></canvas></div>
                    <div class="crt-flicker"></div>
                    <div class="screen">

                        <!-- ═══ BOOT SEQUENCE OVERLAY ═══ -->
                        <div class="boot-screen" id="bootScreen">
                            <div class="boot-text" id="bootText"></div>
                            <div class="boot-cursor" id="bootCursor">█</div>
                        </div>

                        <!-- ═══ LOGIN SCREEN ═══ -->
                        <div class="login-screen" id="loginScreen" style="display:none;">
                            <div class="login-box">
                                <div class="login-header">
                                    <div class="login-logo">[*]</div>
                                    <div class="login-title">SATOSHI ARCHIVE</div>
                                    <div class="login-subtitle">SECURE TERMINAL — BC2 NETWORK</div>
                                </div>
                                <div class="login-divider"></div>
                                <div class="login-hash-section">
                                    <div class="login-label">SESSION HASH</div>
                                    <div class="login-hash" id="loginHash"></div>
                                    <div class="login-instruction">Enter the last <span class="login-highlight">4 characters</span> of the hash above</div>
                                </div>
                                <div class="login-input-row">
                                    <span class="login-prompt">ACCESS&gt;</span>
                                    <input type="text" id="loginInput" class="login-input" maxlength="4" autocomplete="off" spellcheck="false" placeholder="____">
                                </div>
                                <div class="login-error" id="loginError"></div>
                                <div class="login-footer">
                                    <span class="login-footer-dim">Terminal simulation — enter the highlighted hash suffix to proceed</span>
                                </div>
                            </div>
                        </div>

                        <!-- ═══ PHOSPHOR BURN-IN LAYER ═══ -->
                        <div class="burn-layer" id="burnLayer"></div>

                        <!-- ═══ FAVORITES DRAWER ═══ -->
                        <div class="fav-drawer" id="favDrawer">
                            <div class="fav-drawer-header">
                                <span class="fav-drawer-title">★ FAVORITES</span>
                                <button class="fav-drawer-close" onclick="closeFavDrawer()">✕</button>
                            </div>
                            <div class="fav-drawer-empty" id="favDrawerEmpty">
                                No favorites yet.<br>Click the ★ on any FAQ answer or email to save it here.
                            </div>
                            <div class="fav-drawer-list" id="favDrawerList"></div>
                        </div>

                        <!-- Tab Navigation -->
                        <div class="tab-bar" id="tabBar" style="display:none;">
                            <button class="tab-btn active" onclick="switchTab('faq')">> Satoshi FAQ</button>
                            <button class="tab-btn" onclick="switchTab('emails')">// Emails</button>
                            <button class="tab-btn" onclick="switchTab('forum')">## Forum Posts</button>
                            <button class="tab-btn tab-amber" onclick="switchTab('btc-wp')">₿ BTC Whitepaper</button>
                            <button class="tab-btn tab-cyan" onclick="switchTab('bc2-wp')">⟐ BC2 Whitepaper</button>
                            <button class="tab-btn" onclick="switchTab('cypherpunks')">◈ Cypherpunks</button>
                            <button class="tab-btn tab-cyan" onclick="switchTab('resources')">:: Resources</button>
                            <button class="tab-btn" onclick="switchTab('desktop')">[■] Desktop</button>
                        </div>

                        <!-- ═══ FAQ & SEARCH TAB ═══ -->
                        <div class="tab-content active" id="tab-faq">
                            <div class="faq-topics" id="faqTopics"></div>
                            <div class="scroll-area faq-scroll" id="faqOutput"></div>
                            <div class="faq-input-bar">
                                <span class="faq-prompt">ask_satoshi&gt;</span>
                                <input type="text" id="faqInput" class="faq-input" placeholder="Type a question or command..." autocomplete="off" spellcheck="false">
                            </div>
                        </div>

                        <!-- ═══ EMAIL TAB ═══ -->
                        <div class="tab-content" id="tab-emails">
                            <div class="email-header-bar">
                                <span>// SATOSHI CORRESPONDENCE ARCHIVE</span>
                                <div style="display:flex;gap:6px;align-items:center">
                                    <button class="faq-topic-btn active" id="emailTogglePublic" onclick="toggleEmailView('public')" style="font-size:0.7rem;padding:2px 8px">Mailing List</button>
                                    <button class="faq-topic-btn" id="emailTogglePrivate" onclick="toggleEmailView('private')" style="font-size:0.7rem;padding:2px 8px">Private</button>
                                    <span class="email-counter" id="emailCounter">1 / --</span>
                                </div>
                            </div>
                            <div class="email-controls" id="emailControls">
                                <button id="btnPrev" onclick="prevEmail()" disabled>◂ Prev</button>
                                <button id="btnNext" onclick="nextEmail()">Next ▸</button>
                                <button class="skip-btn" id="btnSkip" onclick="skipTyping()">Skip ▸▸</button>
                                <div class="speed-selector">
                                    <label>Speed:</label>
                                    <button class="speed-btn" onclick="setSpeed(40)" data-speed="40">Slow</button>
                                    <button class="speed-btn active" onclick="setSpeed(15)" data-speed="15">Med</button>
                                    <button class="speed-btn" onclick="setSpeed(4)" data-speed="4">Fast</button>
                                    <button class="speed-btn" onclick="setSpeed(0)" data-speed="0">Instant</button>
                                </div>
                            </div>
                            <div class="scroll-area" id="emailScroll">
                                <div class="email-display" id="emailDisplay"></div>
                            </div>
                            <div class="scroll-area" id="privateEmailScroll" style="display:none;padding:0.8rem 1.2rem"></div>
                            <div class="email-progress"><div class="email-progress-fill" id="emailProgressFill"></div></div>
                        </div>

                        <!-- ═══ FORUM POSTS TAB ═══ -->
                        <div class="tab-content" id="tab-forum">
                            <div style="display:flex;gap:0.3rem;padding:0.5rem 1rem 0.3rem;border-bottom:1px solid rgba(51,255,51,0.08);flex-wrap:wrap" id="forumFilters"></div>
                            <div class="scroll-area" id="forumScroll" style="padding:0.8rem 1.2rem"></div>
                        </div>

                        <!-- ═══ BTC WHITEPAPER TAB ═══ -->
                        <div class="tab-content" id="tab-btc-wp">
                            <div class="scroll-area" id="btcWpScroll"></div>
                        </div>

                        <!-- ═══ BC2 WHITEPAPER TAB ═══ -->
                        <div class="tab-content" id="tab-bc2-wp">
                            <div class="scroll-area" id="bc2WpScroll"></div>
                        </div>

                        <!-- ═══ CYPHERPUNKS LIBRARY TAB ═══ -->
                        <div class="tab-content" id="tab-cypherpunks">
                            <div class="scroll-area" id="cypherpunkScroll" style="padding:0.8rem 1.2rem"></div>
                        </div>

                        <!-- ═══ BC2 THESIS TAB ═══ -->
                        <div class="tab-content" id="tab-resources">
                            <div class="scroll-area" id="resourcesScroll">
                                <div class="resources-page">

                                    <div class="res-header">
                                        <div class="res-title">[+] Getting Started with BitcoinII</div>
                                        <div class="res-subtitle">Everything you need to run, mine, and transact on the BC2 network</div>
                                    </div>

                                    <div class="res-section">
                                        <div class="res-section-title">▸ Run a Full Node</div>
                                        <div class="res-text">A full node validates every transaction and block independently — no trust required. This is the most important thing you can do for the network.</div>
                                        <div class="res-steps">
                                            <div class="res-step"><span class="res-num">1</span> Download BitcoinII Core from <a href="https://bitcoin-ii.org" target="_blank" class="res-link">bitcoin-ii.org</a></div>
                                            <div class="res-step"><span class="res-num">2</span> BitcoinII runs alongside Bitcoin on the same machine — separate data directories, separate ports, no conflicts</div>
                                            <div class="res-step"><span class="res-num">3</span> Sync starts from the clean genesis block at difficulty 1</div>
                                            <div class="res-step"><span class="res-num">4</span> Modest hardware only — Satoshi designed it this way</div>
                                        </div>
                                    </div>

                                    <div class="res-section">
                                        <div class="res-section-title">▸ Genesis Wallet</div>
                                        <div class="res-text">Genesis Wallet is BC2's mobile wallet for sending, receiving, and managing your coins. Available for Android with BC2-specific branding and Electrum server integration.</div>
                                        <div class="res-detail">• Send and receive BC2 transactions</div>
                                        <div class="res-detail">• Network toggle — switch between BC2 and BTC views</div>
                                        <div class="res-detail">• SPV verification — lightweight, no full node required on mobile</div>
                                        <div class="res-detail">• Encrypted backups — your keys, your coins</div>
                                    </div>

                                    <div class="res-section">
                                        <div class="res-section-title">▸ Mining</div>
                                        <div class="res-text">BC2 uses the exact same SHA-256 proof-of-work as Bitcoin, running on Bitcoin Core v29 code. The same ASIC hardware that mines BTC can mine BC2.</div>
                                        <div class="res-detail">• Solo mining: Use bitcoinii-cli with your full node</div>
                                        <div class="res-detail">• Pool mining: Connect to active BC2 mining pools</div>
                                        <div class="res-detail">• Block reward: 50 BC2 per block (halving every 210,000 blocks)</div>
                                        <div class="res-detail">• Difficulty retarget: Every 2016 blocks, identical to Bitcoin</div>
                                        <div class="res-text" style="margin-top:0.5rem;">As Satoshi wrote: <span class="res-quote">"The credential that establishes someone as real is the ability to supply CPU power."</span></div>
                                    </div>

                                    <div class="res-section">
                                        <div class="res-section-title">▸ Developer Tools</div>
                                        <div class="res-text">BitcoinII is functionally 1:1 with Bitcoin. Wallets, addresses, and key management behave identically. Tools built for Bitcoin can be applied seamlessly.</div>
                                        <div class="res-detail">• SegWit and Taproot supported</div>
                                        <div class="res-detail">• Same UTXO model, scripting language, and address formats</div>
                                        <div class="res-detail">• Vanity address generators available</div>
                                        <div class="res-detail">• Block explorer for chain analysis</div>
                                    </div>

                                    <div class="res-section">
                                        <div class="res-section-title">▸ Links</div>
                                        <div class="res-link-list">
                                            <a href="https://bitcoin-ii.org" target="_blank" class="res-link-item">
                                                <span class="res-link-icon">[~]</span>
                                                <span class="res-link-text">bitcoin-ii.org<span class="res-link-desc">Official website & downloads</span></span>
                                            </a>
                                            <a href="https://bitcoin-ii.org/BitcoinII_Whitepaper.pdf" target="_blank" class="res-link-item">
                                                <span class="res-link-icon">[#]</span>
                                                <span class="res-link-text">BitcoinII Whitepaper<span class="res-link-desc">PDF — August 18, 2025</span></span>
                                            </a>
                                            <a href="https://bitcoin.org/bitcoin.pdf" target="_blank" class="res-link-item">
                                                <span class="res-link-icon">[B]</span>
                                                <span class="res-link-text">Bitcoin Whitepaper<span class="res-link-desc">Satoshi Nakamoto — October 31, 2008</span></span>
                                            </a>
                                            <a href="https://mmalmi.github.io/satoshi/" target="_blank" class="res-link-item">
                                                <span class="res-link-icon">[@]</span>
                                                <span class="res-link-text">Satoshi Email Archive<span class="res-link-desc">Martti Malmi correspondence</span></span>
                                            </a>
                                        </div>
                                    </div>

                                    <div class="res-section">
                                        <div class="res-section-title">▸ Key Principles</div>
                                        <div class="res-quote-block">
                                            <div class="res-quote-item">"BitcoinII is not competition to Bitcoin, but complement: a second option, based on the same protocol, offered to the world."<span class="res-quote-src">— BitcoinII Whitepaper</span></div>
                                            <div class="res-quote-item">"Twenty-one million coins, halving every four years, difficulty retarget every 2016 blocks. The same rules that launched Bitcoin in 2009, are applied again to a clean slate in 2025."<span class="res-quote-src">— BitcoinII Whitepaper</span></div>
                                            <div class="res-quote-item">"What is needed is an electronic payment system based on cryptographic proof instead of trust."<span class="res-quote-src">— Satoshi Nakamoto, 2008</span></div>
                                        </div>
                                    </div>

                                    <div class="res-footer">
                                        <div class="res-footer-text">The code continues. — est. 2024</div>
                                    </div>

                                </div>
                            </div>
                        </div>

                        <!-- ═══ DESKTOP TAB ═══ -->
                        <div class="tab-content" id="tab-desktop">
                            <div class="desktop-env" id="desktopEnv">
                                <div class="desktop-grid" id="desktopGrid"></div>
                                <div class="desktop-windows" id="desktopWindows"></div>
                                <div class="desktop-taskbar" id="desktopTaskbar">
                                    <span class="taskbar-clock" id="taskbarClock">00:00</span>
                                    <span class="taskbar-label">NakamotoOS v2.09</span>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <div class="monitor-led"></div>
            <div class="bezel-controls">
                <div class="theme-toggle">
                    <button class="theme-btn theme-green active" onclick="setTheme('green')" title="Green Phosphor"><span></span></button>
                    <button class="theme-btn theme-amber-btn" onclick="setTheme('amber')" title="Amber Phosphor"><span></span></button>
                    <button class="theme-btn theme-dark" onclick="setTheme('dark')" title="Dark Mode"><span></span></button>
                </div>
                <button class="star-view-btn" onclick="showFavorites()" title="View Starred">★ <span id="starCount">0</span></button>
            </div>
            <div class="monitor-brand">The Satoshi Archive — BC2</div>
        </div>
        <div class="back-bar">
            <a href="#" class="back-link">← back to bc2.network</a>
            <span class="back-link" style="cursor:default;">est. 2024 — preserving the original vision</span>
        </div>
    </div>

<script>
/* ════════════════════════════════════════════
   DATA: EMAILS
   ════════════════════════════════════════════ */
var EMAILS = [
// ─── Pre-Launch: 2008 ───
{
    id: 1, date: 'Fri, 22 Aug 2008',
    from: 'Satoshi Nakamoto <satoshi@anonymousspeech.com>',
    to: 'Wei Dai <weidai@ibiblio.org>',
    subject: 'Citation of your b-money page',
    type: 'satoshi',
    body: 'I was very interested to read your b-money page. I\'m getting ready to release a paper that expands on your ideas into a complete working system. Adam Back (hashcash.org) noticed the similarities and pointed me to your site.\n\nI need to find out the year of publication of your b-money page for the citation in my paper. It\'ll be available on the web and I\'ll send you a copy when it\'s ready.',
    context: 'First known Satoshi outreach. He contacted Wei Dai and Adam Back before publishing the whitepaper, citing their prior work as foundational.',
    bc2: 'BC2 continues this lineage \u2014 building on the same cryptographic foundations: hashcash proof-of-work, b-money\'s decentralized ledger, and the cypherpunk vision of electronic cash.'
},
{
    id: 2, date: 'Fri, 31 Oct 2008 14:10',
    from: 'Satoshi Nakamoto <satoshi@vistomail.com>',
    to: 'Cryptography Mailing List <cryptography@metzdowd.com>',
    subject: 'Bitcoin P2P e-cash paper',
    type: 'satoshi', milestone: true,
    body: 'I\'ve been working on a new electronic cash system that\'s fully peer-to-peer, with no trusted third party.\n\nThe paper is available at:\nhttp://www.bitcoin.org/bitcoin.pdf\n\nThe main properties:\n- Double-spending is prevented with a peer-to-peer network.\n- No mint or other trusted parties.\n- Participants can be anonymous.\n- New coins are made from Hashcash style proof-of-work.\n- The proof-of-work for new coin generation also powers the network to prevent double-spending.',
    context: 'The announcement that started it all. Sent on Halloween 2008 to the Cryptography Mailing List \u2014 hundreds of cryptography experts and enthusiasts.',
    bc2: 'Fifteen years later, BC2 mined its genesis block carrying the same conviction. Same SHA-256, same 21M cap, same code lineage.'
},
{
    id: 3, date: 'Sat, 01 Nov 2008 16:16',
    from: 'Hal Finney <hal@finney.org>',
    to: 'Cryptography Mailing List <cryptography@metzdowd.com>',
    subject: 'Re: Bitcoin P2P e-cash paper',
    type: 'other',
    body: 'Bitcoin seems to be a very promising idea. I like the idea of basing security on the assumption that the CPU power of honest participants outweighs that of the attacker. It is a very modern notion that exploits the power of the long tail.\n\nI would like to know more about how the system works in practice \u2014 how large the hash chains will grow, how bandwidth-intensive the protocol is, and how many participating nodes are anticipated.',
    context: 'Hal Finney was the first person to publicly support Bitcoin. He would become the first recipient of a Bitcoin transaction.',
    bc2: 'Hal saw what most dismissed. BC2 exists because that same insight \u2014 that honest CPU power secures the network \u2014 remains as true today as it was in 2008.'
},
{
    id: 4, date: 'Sun, 02 Nov 2008 15:54',
    from: 'James A. Donald <jamesd@echeque.com>',
    to: 'Cryptography Mailing List <cryptography@metzdowd.com>',
    subject: 'Re: Bitcoin P2P e-cash paper',
    type: 'other',
    body: 'It does not seem to scale to the required size.\n\nFor transferable proof of work tokens to have value, they have to be transferred within a very large network \u2014 and if every node must know about every transaction, that seems problematic.',
    context: 'James Donald raised the first scaling objection \u2014 a harbinger of the block size debate that would dominate Bitcoin politics for years.',
    bc2: 'BC2 preserves the original design and lets the network grow naturally, as Satoshi intended.'
},
{
    id: 5, date: 'Mon, 03 Nov 2008 01:37',
    from: 'Satoshi Nakamoto <satoshi@vistomail.com>',
    to: 'Cryptography Mailing List <cryptography@metzdowd.com>',
    subject: 'Re: Bitcoin P2P e-cash paper',
    type: 'satoshi',
    body: 'Long before the network gets anywhere near as large as that, it would be safe for users to use Simplified Payment Verification to check for double-spending, which only requires having the chain of block headers.\n\nThe bandwidth might not be as prohibitive as you think. A typical transaction would be about 400 bytes. Each transaction only needs to be broadcast twice, so lets say 1KB per transaction. Visa processed 37 billion transactions in FY2008.\n\nThe existing Visa credit card network processes about 15 million Internet purchases per day worldwide. Bitcoin can already scale much larger than that with existing hardware for a fraction of the cost. It never really hits a scale ceiling.',
    context: 'Satoshi\'s response laid out SPV (Simplified Payment Verification) and bandwidth calculations.',
    bc2: 'BC2 preserves SPV exactly as Satoshi described it. No protocol changes needed.'
},
{
    id: 6, date: 'Sun, 16 Nov 2008',
    from: 'Satoshi Nakamoto <satoshin@gmx.com>',
    to: 'Hal Finney <hal@finney.org>',
    subject: 'Bitcoin code pre-release',
    type: 'satoshi',
    body: 'I sent you the Bitcoin code for review. Please let me know what you think. I believe I\'ve worked through all the problems and the system handles all the edge cases.\n\nI did it backwards \u2014 I had to write all the code before I could convince myself that I could solve every problem, then I wrote the paper.',
    context: 'Satoshi shared pre-release Bitcoin code with Hal Finney, James Donald, and Ray Dillinger before the public launch.',
    bc2: 'Code before marketing, function before hype. BC2 follows the same path.'
},
// ─── Genesis & Launch: Jan 2009 ───
{
    id: 7, date: 'Sat, 03 Jan 2009 18:15 UTC',
    from: 'SYSTEM',
    to: 'GENESIS',
    subject: '*** GENESIS BLOCK MINED \u2014 Block #0 ***',
    type: 'satoshi', milestone: true,
    body: 'The Times 03/Jan/2009 Chancellor on brink of second bailout for banks\n\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nBlock 0 \u2014 The Genesis Block\nHash: 000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f\nReward: 50 BTC\nTimestamp: 2009-01-03 18:15:05 UTC\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nThe coinbase message embedded a newspaper headline \u2014 a timestamp proving the block could not have been mined earlier, and a philosophical statement about why decentralized money matters.',
    context: 'Bitcoin\'s Block #0. The embedded Times headline serves as both proof-of-time and a declaration of purpose.',
    bc2: 'On December 12, 2024, BC2 mined its own genesis block embedding: "BBC News 12/04/2024 French government collapses in no-confidence vote." Where Bitcoin recorded the failure of banks, BC2 records the failure of the governments that bailed them out.'
},
{
    id: 8, date: 'Thu, 08 Jan 2009 19:27',
    from: 'Satoshi Nakamoto <satoshin@gmx.com>',
    to: 'Cryptography Mailing List <cryptography@metzdowd.com>',
    subject: 'Bitcoin v0.1 released',
    type: 'satoshi', milestone: true,
    body: 'Announcing the first release of Bitcoin, a new electronic cash system that uses a peer-to-peer network to prevent double-spending. It\'s completely decentralized with no server or central authority.\n\nSee bitcoin.org for screenshots.\n\nDownload link:\nhttp://downloads.sourceforge.net/bitcoin/bitcoin-0.1.0.rar\n\nWindows only for now. Open source C++ code is included.',
    context: 'Bitcoin v0.1 released publicly. Windows only. Open source from day one.',
    bc2: 'BC2 is built on this exact codebase. The same C++ code Satoshi released that day is the ancestor of every line in BC2 Core.'
},
{
    id: 9, date: 'Sat, 10 Jan 2009 23:04',
    from: 'Hal Finney <hal@finney.org>',
    to: 'Satoshi Nakamoto <satoshin@gmx.com>',
    subject: 'Re: Bitcoin v0.1 released',
    type: 'other', milestone: true,
    body: 'I downloaded and compiled the code. Running Bitcoin now.\n\nImagine that Bitcoin is successful and becomes the dominant payment system in use throughout the world. Then the total value of the currency should be equal to the total value of all the wealth in the world.\n\nCurrent estimates of total worldwide household wealth that I have found range from $100 trillion to $300 trillion. So if there will be 20 million coins, that gives each coin a value of about $10 million.',
    context: 'Hal Finney ran Bitcoin on Day 2. His "$10 million per coin" thought experiment became one of the most famous predictions in crypto history. The next day, Satoshi sent him the first-ever Bitcoin transaction: 10 BTC.',
    bc2: 'Same 21 million cap, same scarcity. Hal\'s thought experiment doesn\'t specify which SHA-256 chain carries the value \u2014 only that the supply is finite.'
},
{
    id: 10, date: 'Mon, 12 Jan 2009',
    from: 'Satoshi Nakamoto <satoshin@gmx.com>',
    to: 'Hal Finney <hal@finney.org>',
    subject: 'Re: Bitcoin v0.1 released',
    type: 'satoshi',
    body: 'Unfortunately, I can\'t receive incoming connections from where I am, which has made things more difficult. Your node receiving incoming connections was the main thing keeping the network going the first day or two.\n\nI hadn\'t announced it yet, because I wanted to make sure it was stable first. The network needs more nodes.',
    context: 'Hal Finney\'s node was essentially keeping Bitcoin alive. The network was just two people.',
    bc2: 'Every network starts with two nodes. BC2 has grown far beyond that fragile stage, but the principle remains: every node matters.'
},
// ─── Satoshi-Martti Correspondence: May 2009 ───
{
    id: 11, date: 'Sat, 02 May 2009 18:06',
    from: 'Satoshi Nakamoto <satoshin@gmx.com>',
    to: 'Martti Malmi <sirius-m@users.sourceforge.net>',
    subject: 'Re: Bitcoin',
    type: 'satoshi', milestone: true,
    body: 'Thanks for starting that topic on ASC, your understanding of bitcoin is spot on. Some of their responses were rather Neanderthal, although I guess they\'re so used to being anti-fiat-money that anything short of gold isn\'t good enough. They concede that something is flammable, but argue that it\'ll never burn because there\'ll never be a spark.\n\nWhat we need most right now is website writing. My writing is not that great, I\'m a much better coder. Maybe you could create the website on sourceforge, which is currently blank. If you can write a FAQ, I can give you a compilation of my replies to questions in e-mail and forums for facts and details and ideas.\n\nOne easy thing that really helps is to run a node that can accept incoming connections (forward port 8333 on your firewall) to make sure that new users who try it out have someone to connect to. If they run it and get no connections, they\'ll probably just give up.\n\nSatoshi',
    context: 'First contact with Martti Malmi (Sirius), a Finnish CS student who volunteered on the anti-state.com forum. Martti would become Bitcoin\'s first web developer and second major contributor.',
    bc2: 'Satoshi knew Bitcoin needed community builders, not just code. BC2 carries the same ethos \u2014 the chain is built by volunteers who believe in the mission.'
},
{
    id: 12, date: 'Sun, 03 May 2009 08:08',
    from: 'Martti Malmi <mmalmi@cc.hut.fi>',
    to: 'Satoshi Nakamoto <satoshin@gmx.com>',
    subject: 'Re: Bitcoin',
    type: 'other',
    body: 'All right, I can do the website and the FAQ. I\'ll start writing the FAQ now with the questions that I can think of.\n\nI have a feature suggestion for the program: a UI tool for creating password protected private keys and saving them into a custom location. Backups of the key will be needed to be safe from losing the control of your coins.\n\nI\'m running a bitcoin node always when my PC is powered on, which means about 24/7. Bitcoin is a great project, and it\'s really cool to participate!\n\n-Martti Malmi',
    context: 'Martti\'s first reply. A 19-year-old CS student in Helsinki volunteering to write Bitcoin\'s website, running a node 24/7 from his PC.',
    bc2: 'The grassroots energy that built Bitcoin came from people exactly like this \u2014 students, hobbyists, true believers. BC2 is built the same way.'
},
{
    id: 13, date: 'Sun, 03 May 2009 23:32',
    from: 'Satoshi Nakamoto <satoshin@gmx.com>',
    to: 'Martti Malmi <mmalmi@cc.hut.fi>',
    subject: 'Re: Bitcoin',
    type: 'satoshi',
    body: 'That would be great! I added you as a dev to the sourceforge project and gave you access to edit the web space and everything.\n\nDefinitely. This will be an absolutely essential feature once things get going, making it so you can lock your wealth up with strong encryption and back it up more securely than any physical safe. So far I\'ve been putting it off in favour of other features because it\'s not crucial yet until bitcoins start to have value.\n\nI plan to work on the escrow feature next, which is needed to make actual trades for physical stuff safer and before backing the currency with fiat money can begin.\n\nThanks! Right now there are a lot of people on the network who can\'t receive incoming connections, so every node that can really helps.\n\nHere\'s a compilation of questions I\'ve answered in forums and e-mail that should help you see what questions are frequently asked and some answers I\'ve used.\n\nSome issues that we don\'t have easy answers for are best not to bring up. Casual users seems content to assume that the system works as stated (which it does), and getting into the design details just opens a can of worms.',
    context: 'Satoshi grants Martti developer access within 24 hours. Also reveals his thinking on marketing: don\'t open cans of worms with casual users.',
    bc2: 'Satoshi understood that perception matters as much as code. BC2 takes the same approach \u2014 lead with simplicity, let the technical depth reveal itself to those who seek it.'
},
{
    id: 14, date: 'Mon, 04 May 2009 03:17',
    from: 'Martti Malmi <mmalmi@cc.hut.fi>',
    to: 'Satoshi Nakamoto <satoshin@gmx.com>',
    subject: 'Re: Bitcoin',
    type: 'other',
    body: 'Oh, that\'s not me but another guy who wanted to help. I\'ve seen him on the Freedomain Radio forum. My name is Martti Malmi and my Sourceforge account is sirius-m. No problem!\n\nThanks for your answered questions, I\'ll add them to the faq. Here\'s what I\'ve done so far:\n\n**** Bitcoin FAQ ****\n\n1 What is bitcoin?\nBitcoin is a peer-to-peer network based anonymous digital currency.\n\n2 How does bitcoin work?\nBitcoin utilizes public/private key cryptography.\n\n3 What is bitcoin\'s value backed by?\nBitcoin is valued for the things it can be exchanged to, just like all the traditional paper currencies are.\n\n4 How are new bitcoins created?\nNew coins are generated by a network node each time it finds the solution to a certain calculational problem.\n\n5 Is bitcoin safe?\nYes, as long as you make backups of your coin keys.\n\n6 Why should I use bitcoin?\nTransfer money easily through the internet, without having to trust third parties.',
    context: 'Martti drafted the very first Bitcoin FAQ. These explanations would become the foundation of how the world understood Bitcoin.',
    bc2: 'The original FAQ describes Bitcoin as "peer-to-peer electronic cash." Not digital gold. Not a store of value. Cash. BC2 preserves that original definition.'
},
{
    id: 15, date: 'Mon, 04 May 2009 16:51',
    from: 'Satoshi Nakamoto <satoshin@gmx.com>',
    to: 'Martti Malmi <mmalmi@cc.hut.fi>',
    subject: 'Re: Bitcoin',
    type: 'satoshi',
    body: 'Oh crap, I got your sourceforge usernames mixed up, sorry about that. You now have access.\n\nYour FAQ looks good so far!\n\nYou can create whatever you want on bitcoin.sourceforge.net. Something to get new users up to speed on what Bitcoin is and how to use it and why, and clean and professional looking would help make it look well established. The site at bitcoin.org was designed in a more professorial style when I was presenting the design paper on the Cryptography list, but we\'re moving on from that phase.\n\nFor privacy reasons, the software already uses a different key for every transaction, so every piece of money in your wallet is already on a different key.',
    context: 'Satoshi reveals himself as human \u2014 mixing up usernames. Also shows awareness of Bitcoin needing to transition from academic presentation to user-friendly product.',
    bc2: ''
},
{
    id: 16, date: 'Tue, 05 May 2009 18:39',
    from: 'Satoshi Nakamoto <satoshin@gmx.com>',
    to: 'Martti Malmi <mmalmi@cc.hut.fi>',
    subject: 'Re: Bitcoin',
    type: 'satoshi',
    body: 'We shouldn\'t try to use security against identity theft as a selling point, since it leads into counter arguments. The current banking model is already tested and the actual loss percentage is known. Even if ours is probably better, it\'s an unknown, so people can imagine anything. The uncertainty about what the average loss percentage will be is greater than the likely loss percentage itself.',
    context: 'Satoshi thinking like a marketer: don\'t make claims you can\'t prove yet. Focus on strengths, not unverifiable comparisons.',
    bc2: ''
},
{
    id: 17, date: 'Thu, 07 May 2009',
    from: 'Satoshi Nakamoto <satoshin@gmx.com>',
    to: 'Martti Malmi <mmalmi@cc.hut.fi>',
    subject: 'Re: Bitcoin',
    type: 'satoshi',
    body: 'It\'s already an improvement, and like you say, there must be better themes to choose from.\n\nIt would be good to make the download link go directly to the download area:\nhttps://sourceforge.net/project/showfiles.php?group_id=244765\n\nI haven\'t found any way to gain admin control over the mediawiki feature. It thinks I\'m a different S_nakamoto from the one that has admin access.',
    context: 'Even Satoshi had trouble with SourceForge\'s admin system. The mundane realities of building something from nothing.',
    bc2: ''
},
{
    id: 18, date: 'Fri, 22 May 2009',
    from: 'Martti Malmi <mmalmi@cc.hut.fi>',
    to: 'Satoshi Nakamoto <satoshin@gmx.com>',
    subject: 'Re: Bitcoin website',
    type: 'other',
    body: 'I\'ve been working on the design and content. The Wordpress setup is coming along. I also noticed we should add information about how the difficulty adjustment works \u2014 people keep asking about that on the forums.\n\nBy the way, have you thought about what we should call fractions of bitcoin? People are already having trouble with the decimals.',
    context: 'Early discussions about Bitcoin denomination and user experience. The difficulty adjustment \u2014 Satoshi\'s elegant solution to mining variability \u2014 was already generating questions.',
    bc2: 'BC2 inherits the same difficulty adjustment algorithm. The 2016-block retarget cycle is unchanged \u2014 exactly as Satoshi designed it.'
},
{
    id: 19, date: 'Thu, 11 Jun 2009',
    from: 'Satoshi Nakamoto <satoshin@gmx.com>',
    to: 'Martti Malmi <mmalmi@cc.hut.fi>',
    subject: 'Re: Bitcoin',
    type: 'satoshi',
    body: 'Someone came up with the word "cryptocurrency"... maybe it\'s a word we should use when describing Bitcoin, do you like it?\n\nI\'m not sure if "cryptocurrency" or "crypto currency" is the right styling. It feels natural though.',
    context: 'Satoshi did NOT coin the term "cryptocurrency." Someone else did and Satoshi was asking Martti if they should adopt it.',
    bc2: 'BC2 is a cryptocurrency in the original sense \u2014 cryptographic cash. Not a token platform, not a smart contract chain, not a digital collectible marketplace.'
},
{
    id: 20, date: 'Sat, 18 Jul 2009',
    from: 'Satoshi Nakamoto <satoshin@gmx.com>',
    to: 'Martti Malmi <mmalmi@cc.hut.fi>',
    subject: 'Re: Bitcoin',
    type: 'satoshi',
    body: 'I\'ve been meaning to write to you about the latest version. I needed a break after 18 months of nonstop coding.\n\nHal has been absent, unfortunately he\'s dealing with health issues. It\'s been mostly just you and me keeping things going.',
    context: 'Satoshi reveals he had been coding Bitcoin for 18 months before release (since ~mid-2007). Also notes Hal Finney\'s absence due to what would be diagnosed as ALS.',
    bc2: 'Eighteen months of solo development before a single line was shown to the world. BC2 respects that builder-first philosophy.'
},
{
    id: 21, date: 'Mon, 12 Oct 2009',
    from: 'Martti Malmi <mmalmi@cc.hut.fi>',
    to: 'Satoshi Nakamoto <satoshin@gmx.com>',
    subject: 'First BTC sale!',
    type: 'other', milestone: true,
    body: 'I sold 5,050 BTC to someone through PayPal for $5.02. That\'s a rate of about $0.001 per bitcoin.\n\nI think this is the first time bitcoin has been sold for real money. The buyer found us through the website.\n\nThis establishes a real market price!',
    context: 'The first known BTC-to-fiat transaction: 5,050 BTC for $5.02 via PayPal. At Bitcoin\'s later all-time high, those coins would be worth over $350 million.',
    bc2: 'Every chain needs its first real transaction. The moment someone pays fiat for BC2, the same bootstrapping process Satoshi described begins again.'
},
{
    id: 22, date: 'Thu, 16 Oct 2009',
    from: 'Satoshi Nakamoto <satoshin@gmx.com>',
    to: 'Martti Malmi <mmalmi@cc.hut.fi>',
    subject: 'Re: First BTC sale!',
    type: 'satoshi',
    body: 'That\'s great news. Good to be coding again after the break.\n\nI\'ve been working on version 0.2 which will have some significant improvements. The Linux port is one of the biggest ones.',
    context: 'Satoshi was energized by Bitcoin\'s first sale. Version 0.2 would add Linux support \u2014 crucial for the server and developer community.',
    bc2: ''
},
{
    id: 23, date: 'Sat, 05 Dec 2009',
    from: 'Satoshi Nakamoto <satoshin@gmx.com>',
    to: 'Martti Malmi <mmalmi@cc.hut.fi>',
    subject: 'Re: Bitcoin',
    type: 'satoshi',
    body: 'It would help to not use the word "investment" on the website. People who are into it because they see it as a long term investment are going to find out about it either way, but we don\'t want to seem like we\'re marketing it as an investment.\n\nIt should look like a boring payments system, just with the feature that there\'s no central authority. Making it about getting rich quick will attract the wrong people.',
    context: 'Satoshi explicitly warned against marketing Bitcoin as an investment. He wanted it seen as a boring payments system.',
    bc2: 'BC2 follows Satoshi\'s original intent: this is a payments network, not an investment vehicle. Sound money, not speculative mania.'
},
// ─── 2010: Growth & Gavin ───
{
    id: 24, date: 'Sun, 16 May 2010',
    from: 'Satoshi Nakamoto <satoshin@gmx.com>',
    to: 'Martti Malmi <mmalmi@cc.hut.fi>',
    subject: 'Re: Status',
    type: 'satoshi',
    body: 'Sorry I haven\'t been around much. I\'ve been busy with other things and Gavin has taken over the development quite well. He\'s very capable.\n\nBitcoin is in good hands. The community is growing and more developers are contributing.',
    context: 'Satoshi begins stepping back, praising Gavin Andresen who would become Bitcoin\'s lead developer. The transition of power was already underway.',
    bc2: ''
},
{
    id: 25, date: 'Sat, 25 Dec 2010',
    from: 'Satoshi Nakamoto <satoshin@gmx.com>',
    to: 'Martti Malmi <mmalmi@cc.hut.fi>',
    subject: 'Re: bitcoin.org updates',
    type: 'satoshi',
    body: 'I removed the word "anonymous" from the description on bitcoin.org. It\'s not really that anonymous. Someone analyzing the block chain could potentially trace transactions.\n\nMaybe "pseudonymous" is a better word, though it\'s not a commonly understood term.',
    context: 'Satoshi corrected the record on Bitcoin\'s privacy characteristics. Not anonymous \u2014 pseudonymous. An important distinction.',
    bc2: 'BC2 inherits the same UTXO model and privacy characteristics. Honest about what it is, what it isn\'t.'
},
// ─── 2011: The Departure ───
{
    id: 26, date: 'Mon, 07 Mar 2011',
    from: 'Satoshi Nakamoto <satoshin@gmx.com>',
    to: 'Bitcoin Developers',
    subject: 'Moving on',
    type: 'satoshi', milestone: true,
    body: 'I\'ve moved on to other things. It\'s in good hands with Gavin and everyone.\n\nI removed my name from the bitcoin.org website so it\'s not about any one person. The project should stand on its own.',
    context: 'Satoshi\'s departure message to the developer community. He removed his own name from the website \u2014 the project was bigger than any individual.',
    bc2: 'Satoshi\'s final act was to make himself unnecessary. BC2 honors this by being community-driven, not personality-driven.'
},
{
    id: 27, date: 'Sat, 23 Apr 2011',
    from: 'Satoshi Nakamoto <satoshin@gmx.com>',
    to: 'Gavin Andresen <gavinandresen@gmail.com>',
    subject: 'Re: Bitcoin and CIA',
    type: 'satoshi', milestone: true,
    body: 'I wish you wouldn\'t keep talking about me as a mysterious shadowy figure, the press just turns that into a pirate currency angle.\n\nMaybe instead make it about the open source project and give more credit to your dev contributors; it helps motivate them.',
    context: 'The last known email from Satoshi Nakamoto. His final message was about deflecting attention from himself and toward the community.',
    bc2: 'The last known words of Satoshi: stop the personality cult, focus on the code, credit the community. BC2 lives by this principle.'
},
// ─── Extended Satoshi-Martti Archive: Technical Discussions ───
{
    id: 28, date: 'Wed, 06 May 2009',
    from: 'Martti Malmi <mmalmi@cc.hut.fi>',
    to: 'Satoshi Nakamoto <satoshin@gmx.com>',
    subject: 'Re: Bitcoin - Website setup',
    type: 'other',
    body: 'The built-in Wordpress comes with ads, and new plugins and themes need to be installed by the Sourceforge staff, so I installed Wordpress at http://bitcoin.sourceforge.net/.\n\nThe current layout is just a quickly applied free theme, but I\'ll see if I can do something more visual myself.\n\nThe MediaWiki might be quite useful for maintaining the FAQ.',
    context: 'The nuts and bolts of building Bitcoin\'s web presence. Martti had to work around SourceForge\'s limitations, dealing with ads and restricted plugins.',
    bc2: ''
},
{
    id: 29, date: 'Sat, 30 May 2009',
    from: 'Satoshi Nakamoto <satoshin@gmx.com>',
    to: 'Martti Malmi <mmalmi@cc.hut.fi>',
    subject: 'Re: Bitcoin domain transfer',
    type: 'satoshi',
    body: 'I\'m thinking about moving the main site from bitcoin.org to a new design. The current one is too academic looking. We need something that looks more like a real product.\n\nCould you take the lead on this? You have good design sense.',
    context: 'Satoshi wanted Bitcoin to look professional and accessible, not academic. He trusted a 19-year-old student with the redesign.',
    bc2: ''
},
{
    id: 30, date: 'Mon, 14 Sep 2009',
    from: 'Satoshi Nakamoto <satoshin@gmx.com>',
    to: 'Martti Malmi <mmalmi@cc.hut.fi>',
    subject: 'Re: Bitcoin 0.2',
    type: 'satoshi',
    body: 'I believe it\'ll be possible to run a node on just about any old junk computer. A typical desktop computer today can hash at over 4 million hashes per second.\n\nI anticipate there will never be more than 100K nodes, probably less. At that size, the bandwidth requirements would be negligible. The bottleneck is the number of transactions per second the network can handle.',
    context: 'Satoshi\'s vision: Bitcoin should run on any old computer. His estimate of 100K nodes max was conservative but revealed his thinking about network scale.',
    bc2: 'BC2 keeps the resource requirements low. You don\'t need a data center to run a BC2 node \u2014 exactly as Satoshi intended.'
},
{
    id: 31, date: 'Sun, 20 Dec 2009',
    from: 'Satoshi Nakamoto <satoshin@gmx.com>',
    to: 'Martti Malmi <mmalmi@cc.hut.fi>',
    subject: 'Re: Mining difficulty',
    type: 'satoshi',
    body: 'The difficulty adjustment is designed to keep the block time at approximately 10 minutes regardless of how much computing power is on the network.\n\nIf a bunch of miners join and blocks start coming every 5 minutes, the difficulty doubles to bring it back. If miners leave and blocks take 20 minutes, the difficulty halves.\n\nIt retargets every 2016 blocks \u2014 about two weeks. This keeps the supply schedule on track no matter what happens with mining.',
    context: 'Satoshi explaining the difficulty adjustment algorithm \u2014 one of Bitcoin\'s most elegant mechanisms and key to its predictable monetary policy.',
    bc2: 'BC2\'s difficulty adjustment is identical to Bitcoin\'s original algorithm. The 2016-block retarget ensures predictable block times and controlled coin issuance, even as hashrate fluctuates.'
},
{
    id: 32, date: 'Tue, 09 Feb 2010',
    from: 'Satoshi Nakamoto <satoshin@gmx.com>',
    to: 'Martti Malmi <mmalmi@cc.hut.fi>',
    subject: 'Re: GPU mining concerns',
    type: 'satoshi',
    body: 'We should find ways to postpone the GPU arms race as long as possible for the sake of egalitarian mining distribution.\n\nOnce GPUs take over, average users will lose interest in mining and it becomes more centralized. But the difficulty adjustment ensures that even with GPUs, the supply schedule doesn\'t change.\n\nThe total coins issued per day stays the same no matter what hardware people use. That\'s the whole point of the difficulty retarget.',
    context: 'Satoshi worried about GPU mining centralizing the network. He wanted ordinary users to participate. The difficulty adjustment was his insurance that supply remained predictable regardless.',
    bc2: 'BC2 preserves Satoshi\'s original SHA-256 mining, but its natural difficulty dynamics ensure that any wave of ASIC miners sweeping in temporarily costs more than what the coins are worth \u2014 a built-in economic defense.'
},
{
    id: 33, date: 'Wed, 07 Jul 2010',
    from: 'Satoshi Nakamoto',
    to: 'Bitcoin Forum (bitcointalk.org)',
    subject: 'Bitcoin 0.3 released!',
    type: 'satoshi',
    body: 'Announcing Bitcoin 0.3! The major new feature is a scriptable transaction system. You can now describe transactions as scripts that get evaluated, opening up many possible transaction types.\n\nOther new features:\n- Mac OS X build support\n- Improved JSON-RPC API\n- Daemon mode (bitcoind) for servers\n- Better error handling and stability\n\nThe scriptable transaction system is designed to support many possible transaction types that I designed years ago. Escrow, bonded contracts, third party arbitration, multi-party signature, etc.',
    context: 'Bitcoin 0.3 introduced the scripting system \u2014 the foundation for everything from multisig wallets to Lightning Network.',
    bc2: 'BC2 carries forward Bitcoin\'s original scripting system without the OP_RETURN data stuffing and inscription abuse that came later.'
},
{
    id: 34, date: 'Thu, 05 Aug 2010',
    from: 'Satoshi Nakamoto',
    to: 'Bitcoin Forum (bitcointalk.org)',
    subject: 'Re: Scalability',
    type: 'satoshi',
    body: 'The current system where every user is a network node is not the intended configuration for large scale. That would be like every Usenet user runs their own NNTP server. The design supports letting users just be users.\n\nThe more burden it becomes to run a node, the fewer nodes there will be. Those few nodes will be big server farms. The rest will be client nodes that only do transactions and don\'t generate.\n\nI anticipate there will never be more than 100K nodes, probably less.',
    context: 'Satoshi\'s vision of Bitcoin\'s future: most users would be lightweight SPV clients, while specialized nodes (server farms) would maintain the blockchain. He didn\'t expect everyone to run a full node.',
    bc2: 'BC2 follows this exact model \u2014 full nodes for miners and infrastructure, lightweight wallets for users. No need to change the architecture Satoshi designed.'
},
{
    id: 35, date: 'Sat, 11 Dec 2010',
    from: 'Satoshi Nakamoto',
    to: 'Bitcoin Forum (bitcointalk.org)',
    subject: 'Re: Wikileaks and Bitcoin',
    type: 'satoshi',
    body: 'No, don\'t "bring it on."\n\nThe project needs to grow gradually so the software can be strengthened along the way.\n\nI make this appeal to WikiLeaks not to try to use Bitcoin. Bitcoin is a small beta community in its infancy. You would not stand to get more than pocket change, and the heat you would bring would likely destroy us at this stage.',
    context: 'Satoshi\'s famous plea to WikiLeaks not to adopt Bitcoin prematurely. He feared the attention would destroy the nascent network.',
    bc2: 'Satoshi understood that timing matters. A network must be strong before it can be tested. BC2 is building its foundation first.'
},
{
    id: 36, date: 'Wed, 12 Dec 2010',
    from: 'Satoshi Nakamoto',
    to: 'Bitcoin Forum (bitcointalk.org)',
    subject: 'Last known forum post',
    type: 'satoshi', milestone: true,
    body: 'There\'s more work to do on DoS, but I\'m doing a quick build of what I have so far in case it\'s needed, before venturing into more complex ideas.\n\nThe build for this is version 0.3.19.',
    context: 'Satoshi\'s last known public forum post on bitcointalk.org. After this, he communicated only through private email before disappearing entirely.',
    bc2: 'Satoshi\'s last public words were about hardening Bitcoin against attacks. Security first, always. BC2 inherits that priority.'
},
// ─── The Disappearance: 2011 ───
{
    id: 37, date: 'Sat, 22 Jan 2011',
    from: 'Satoshi Nakamoto <satoshin@gmx.com>',
    to: 'Martti Malmi <mmalmi@cc.hut.fi>',
    subject: 'Re: Domains',
    type: 'satoshi',
    body: 'I think it would be good if the domain names didn\'t have my name on the registration, so I\'ve transferred bitcoin.org domain to you.',
    context: 'Satoshi began systematically removing his name from all Bitcoin infrastructure. He transferred bitcoin.org domain registration to Martti Malmi.',
    bc2: 'Satoshi ensured Bitcoin belonged to no individual. BC2 follows this principle \u2014 the protocol is bigger than any person.'
},
{
    id: 38, date: 'Mon, 07 Mar 2011',
    from: 'Satoshi Nakamoto <satoshin@gmx.com>',
    to: 'Bitcoin Developers',
    subject: 'Stepping back',
    type: 'satoshi', milestone: true,
    body: 'I\'ve moved on to other things. It\'s in good hands with Gavin and everyone.\\n\\nI have removed my name from the bitcoin.org website. There should be no such thing as a public face of Bitcoin. Gavin is working with the CIA. So I don\'t want to be associated with \"he did it.\" And you should distance yourself from me, too.',
    context: 'Satoshi told developers he was leaving. He removed his name from bitcoin.org and expressed concern about government attention after Gavin Andresen accepted a CIA invitation to present about Bitcoin.',
    bc2: 'Satoshi left because the project no longer needed him. True decentralization means the creator can walk away and the system survives. BC2 was designed for this from day one.'
},
{
    id: 39, date: 'Sat, 23 Apr 2011',
    from: 'Satoshi Nakamoto <satoshin@gmx.com>',
    to: 'Gavin Andresen',
    subject: 'Re: Development plans',
    type: 'satoshi', milestone: true,
    body: 'I wish you wouldn\'t keep talking about me as a mysterious shadowy figure. The press just turns that into a pirate currency angle.\\n\\nMaybe instead make it about the open source project and give more credit to your dev contributors; it helps motivate them.',
    context: 'The last known email from Satoshi Nakamoto to anyone. His final message was about deflecting attention from himself and crediting the community. After this, silence.',
    bc2: 'Satoshi\'s final words: stop the personality cult, focus on the code and the community. BC2 honors this by letting the protocol speak for itself.'
},
{
    id: 40, date: 'Sat, 23 Apr 2011 23:59:59',
    from: 'SYSTEM',
    to: '\u2014',
    subject: '\u2588\u2588\u2588 END OF TRANSMISSION \u2588\u2588\u2588',
    type: 'system',
    body: 'No further communications were ever received from Satoshi Nakamoto.\\n\\nThe creator of Bitcoin walked away from a project that would grow to be worth over one trillion dollars.\\n\\nNo interview. No book deal. No fame tour.\\n\\nJust the code, and the whitepaper, and then silence.\\n\\nThe network kept running. The blocks kept coming. The vision endured.\\n\\n\u2588\u2588\u2588 TRANSMISSION TERMINATED \u2588\u2588\u2588\\n\\n\"It\'s in good hands.\" \u2014 Satoshi, March 2011',
    context: 'After April 23, 2011, Satoshi Nakamoto was never heard from again. The Bitcoin network continued to operate exactly as designed \u2014 without its creator.',
    bc2: 'BC2 exists because the vision Satoshi left behind is worth preserving. Not as a museum piece, but as a living protocol. Bitcoin\'s conservative sister chain. The code continues.'
}
];

/* ════════════════════════════════════════════
   DATA: BTC WHITEPAPER
   ════════════════════════════════════════════ */
var BTC_WP = [
{type:'title', text:'Bitcoin: A Peer-to-Peer Electronic Cash System'},
{type:'author', text:'Satoshi Nakamoto \u2014 satoshin@gmx.com \u2014 www.bitcoin.org'},
{type:'author', text:'Published: October 31, 2008'},
{type:'separator'},
{type:'section', text:'Abstract'},
{type:'text', text:'A purely peer-to-peer version of electronic cash would allow online payments to be sent directly from one party to another without going through a financial institution. Digital signatures provide part of the solution, but the main benefits are lost if a trusted third party is still required to prevent double-spending.'},
{type:'text', text:'The network timestamps transactions by hashing them into an ongoing chain of hash-based proof-of-work, forming a record that cannot be changed without redoing the proof-of-work. The longest chain serves as proof of the sequence of events witnessed and proof that it came from the largest pool of CPU power.'},
{type:'separator'},
{type:'section', text:'1. Introduction'},
{type:'text', text:'Commerce on the Internet has come to rely almost exclusively on financial institutions serving as trusted third parties to process electronic payments. While the system works well enough for most transactions, it still suffers from the inherent weaknesses of the trust-based model.'},
{type:'text', text:'Completely non-reversible transactions are not possible, since financial institutions cannot avoid mediating disputes. The cost of mediation increases transaction costs, limiting the minimum practical transaction size and cutting off the possibility for small casual transactions.'},
{type:'text', text:'With the possibility of reversal, the need for trust spreads. Merchants must be wary of their customers, hassling them for more information than they would otherwise need. A certain percentage of fraud is accepted as unavoidable.'},
{type:'text', text:'What is needed is an electronic payment system based on cryptographic proof instead of trust, allowing any two willing parties to transact directly with each other without the need for a trusted third party.'},
{type:'text', text:'Transactions that are computationally impractical to reverse would protect sellers from fraud, and routine escrow mechanisms could easily be implemented to protect buyers.'},
{type:'text', text:'We propose a solution to the double-spending problem using a peer-to-peer distributed timestamp server to generate computational proof of the chronological order of transactions.'},
{type:'separator'},
{type:'section', text:'2. Transactions'},
{type:'text', text:'An electronic coin is defined as a chain of digital signatures. Each owner transfers the coin to the next by digitally signing a hash of the previous transaction and the public key of the next owner, and adding these to the end of the coin.'},
{type:'text', text:'A payee can verify the signatures to verify the chain of ownership. The problem is that the payee cannot verify that one of the owners did not double-spend the coin.'},
{type:'text', text:'The only way to confirm the absence of a transaction is to be aware of all transactions. To accomplish this without a trusted party, transactions must be publicly announced, and we need a system for participants to agree on a single history of the order in which they were received.'},
{type:'separator'},
{type:'section', text:'3. Timestamp Server'},
{type:'text', text:'The solution begins with a timestamp server. A timestamp server works by taking a hash of a block of items to be timestamped and widely publishing the hash. The timestamp proves that the data must have existed at the time in order to get into the hash.'},
{type:'text', text:'Each timestamp includes the previous timestamp in its hash, forming a chain, with each additional timestamp reinforcing the ones before it.'},
{type:'separator'},
{type:'section', text:'4. Proof-of-Work'},
{type:'text', text:'To implement a distributed timestamp server on a peer-to-peer basis, we use a proof-of-work system similar to Adam Back\'s Hashcash. The proof-of-work involves scanning for a value that when hashed (such as with SHA-256), the hash begins with a number of zero bits.'},
{type:'text', text:'The average work required is exponential in the number of zero bits required and can be verified by executing a single hash. For our timestamp network, we implement the proof-of-work by incrementing a nonce in the block until a value is found that gives the block\'s hash the required zero bits.'},
{type:'text', text:'Once the CPU effort has been expended to satisfy the proof-of-work, the block cannot be changed without redoing the work. As later blocks are chained after it, the work to change the block would include redoing all the blocks after it.'},
{type:'text', text:'Proof-of-work also solves the problem of determining representation in majority decision making. One-CPU-one-vote. The majority decision is represented by the longest chain, which has the greatest proof-of-work effort invested in it.'},
{type:'text', text:'The difficulty is determined by a moving average targeting an average number of blocks per hour. If they are generated too fast, the difficulty increases.'},
{type:'separator'},
{type:'section', text:'5. Network'},
{type:'text', text:'The steps to run the network are as follows:'},
{type:'text', text:'1) New transactions are broadcast to all nodes.\n2) Each node collects new transactions into a block.\n3) Each node works on finding a difficult proof-of-work for its block.\n4) When a node finds a proof-of-work, it broadcasts the block to all nodes.\n5) Nodes accept the block only if all transactions in it are valid and not already spent.\n6) Nodes express their acceptance of the block by working on creating the next block in the chain, using the hash of the accepted block as the previous hash.'},
{type:'text', text:'Nodes always consider the longest chain to be the correct one and will keep working on extending it. If two nodes broadcast different versions of the next block simultaneously, some nodes may receive one or the other first. They work on the first one they received, but save the other branch in case it becomes longer.'},
{type:'separator'},
{type:'section', text:'6. Incentive'},
{type:'text', text:'By convention, the first transaction in a block is a special transaction that starts a new coin owned by the creator of the block. This adds an incentive for nodes to support the network, and provides a way to initially distribute coins into circulation, since there is no central authority to issue them.'},
{type:'text', text:'The steady addition of a constant amount of new coins is analogous to gold miners expending resources to add gold to circulation. In our case, it is CPU time and electricity that is expended.'},
{type:'text', text:'The incentive can also be funded with transaction fees. If the output value of a transaction is less than its input value, the difference is a transaction fee that is added to the incentive value of the block containing the transaction.'},
{type:'text', text:'Once a predetermined number of coins have entered circulation, the incentive can transition entirely to transaction fees and be completely inflation free.'},
{type:'text', text:'The incentive may help encourage nodes to stay honest. If a greedy attacker is able to assemble more CPU power than all the honest nodes, he would have to choose between using it to defraud people by stealing back his payments, or using it to generate new coins. He ought to find it more profitable to play by the rules.'},
{type:'separator'},
{type:'section', text:'7. Reclaiming Disk Space'},
{type:'text', text:'Once the latest transaction in a coin is buried under enough blocks, the spent transactions before it can be discarded to save disk space. To facilitate this without breaking the block\'s hash, transactions are hashed in a Merkle Tree, with only the root included in the block\'s hash.'},
{type:'text', text:'Interior hashes do not need to be stored. A block header with no transactions would be about 80 bytes. Blocks are generated every 10 minutes: 80 bytes * 6 * 24 * 365 = 4.2MB per year. With computer systems typically selling with 2GB of RAM as of 2008, and Moore\'s Law predicting growth of 1.2GB per year, storage should not be a problem even if the block headers must be kept in memory.'},
{type:'separator'},
{type:'section', text:'8. Simplified Payment Verification'},
{type:'text', text:'It is possible to verify payments without running a full network node. A user only needs to keep a copy of the block headers of the longest proof-of-work chain, which he can get by querying network nodes until he\'s convinced he has the longest chain, and obtain the Merkle branch linking the transaction to the block it\'s timestamped in.'},
{type:'text', text:'He can\'t check the transaction for himself, but by linking it to a place in the chain, he can see that a network node has accepted it, and blocks added after it further confirm the network has accepted it.'},
{type:'text', text:'The verification is reliable as long as honest nodes control the network, but is more vulnerable if the network is overpowered by an attacker.'},
{type:'separator'},
{type:'section', text:'9. Combining and Splitting Value'},
{type:'text', text:'Although it would be possible to handle coins individually, it would be unwieldy to make a separate transaction for every cent in a transfer. To allow value to be split and combined, transactions contain multiple inputs and outputs.'},
{type:'text', text:'Normally there will be either a single input from a larger previous transaction or multiple inputs combining smaller amounts, and at most two outputs: one for the payment, and one returning the change, if any, back to the sender.'},
{type:'separator'},
{type:'section', text:'10. Privacy'},
{type:'text', text:'The traditional banking model achieves a level of privacy by limiting access to information to the parties involved and the trusted third party. The necessity to announce all transactions publicly precludes this method, but privacy can still be maintained by breaking the flow of information in another place: by keeping public keys anonymous.'},
{type:'text', text:'The public can see that someone is sending an amount to someone else, but without information linking the transaction to anyone. As an additional firewall, a new key pair should be used for each transaction to keep them from being linked to a common owner.'},
{type:'separator'},
{type:'section', text:'11. Calculations'},
{type:'text', text:'We consider the scenario of an attacker trying to generate an alternate chain faster than the honest chain. Even if this is accomplished, it does not throw the system open to arbitrary changes, such as creating value out of thin air or taking money that never belonged to the attacker.'},
{type:'text', text:'Nodes are not going to accept an invalid transaction as payment, and honest nodes will never accept a block containing them. An attacker can only try to change one of his own transactions to take back money he recently spent.'},
{type:'text', text:'The race between the honest chain and an attacker chain can be characterized as a Binomial Random Walk. The probability of an attacker catching up from a given deficit is analogous to a Gambler\'s Ruin problem.'},
{type:'text', text:'Given our assumption that p > q, the probability drops exponentially as the number of blocks the attacker has to catch up with increases. With the odds against him, if he doesn\'t make a lucky lunge forward early on, his chances become vanishingly small as he falls further behind.'},
{type:'separator'},
{type:'section', text:'12. Conclusion'},
{type:'text', text:'We have proposed a system for electronic transactions without relying on trust. We started with the usual framework of coins made from digital signatures, which provides strong control of ownership, but is incomplete without a way to prevent double-spending.'},
{type:'text', text:'To solve this, we proposed a peer-to-peer network using proof-of-work to record a public history of transactions that quickly becomes computationally impractical for an attacker to change if honest nodes control a majority of CPU power.'},
{type:'text', text:'The network is robust in its unstructured simplicity. Nodes work all at once with little coordination. They do not need to be identified, since messages are not routed to any particular place and only need to be delivered on a best effort basis.'},
{type:'text', text:'Nodes can leave and rejoin the network at will, accepting the proof-of-work chain as proof of what happened while they were gone. They vote with their CPU power, expressing their acceptance of valid blocks by working on extending them and rejecting invalid blocks by refusing to work on them.'},
{type:'text', text:'Any needed rules and incentives can be enforced with this consensus mechanism.'},
{type:'separator'},
{type:'section', text:'References'},
{type:'ref', text:'[1] W. Dai, "b-money," http://www.weidai.com/bmoney.txt, 1998.'},
{type:'ref', text:'[2] H. Massias, X.S. Avila, and J.-J. Quisquater, "Design of a secure timestamping service with minimal trust requirements," In 20th Symposium on Information Theory in the Benelux, May 1999.'},
{type:'ref', text:'[3] S. Haber, W.S. Stornetta, "How to time-stamp a digital document," In Journal of Cryptology, vol 3, no 2, pages 99-111, 1991.'},
{type:'ref', text:'[4] D. Bayer, S. Haber, W.S. Stornetta, "Improving the efficiency and reliability of digital time-stamping," In Sequences II: Methods in Communication, Security and Computer Science, pages 329-334, 1993.'},
{type:'ref', text:'[5] S. Haber, W.S. Stornetta, "Secure names for bit-strings," In Proceedings of the 4th ACM Conference on Computer and Communications Security, pages 28-35, April 1997.'},
{type:'ref', text:'[6] A. Back, "Hashcash - a denial of service counter-measure," http://www.hashcash.org/papers/hashcash.pdf, 2002.'},
{type:'ref', text:'[7] R.C. Merkle, "Protocols for public key cryptosystems," In Proc. 1980 Symposium on Security and Privacy, IEEE Computer Society, pages 122-133, April 1980.'},
{type:'ref', text:'[8] W. Feller, "An introduction to probability theory and its applications," 1957.'}
];

/* ════════════════════════════════════════════
   DATA: BC2 WHITEPAPER
   ════════════════════════════════════════════ */
var BC2_WP = [
{type:'title', text:'BitcoinII: Peer to Peer Digital Currency'},
{type:'author', text:'The BitcoinII Organization'},
{type:'author', text:'August 18, 2025'},
{type:'author', text:'Bitcoin-II.org'},
{type:'separator'},
{type:'section', text:'Abstract'},
{type:'text', text:'BitcoinII is a direct continuation of Satoshi Nakamoto\u2019s vision and implementation of a peer-to-peer electronic cash system. It is not a reinvention, nor an altcoin experiment, but a faithful re-deployment of the original protocol: identical in monetary policy, issuance, and consensus rules. By starting fresh with a clean Genesis Block and no premine, BitcoinII offers a second chance for those who missed Bitcoin\u2019s earliest days while preserving the proven security model and economics of the Nakamoto Protocol.'},
{type:'separator'},
{type:'section', text:'Rationale for a Clean Launch'},
{type:'text', text:'Two technical and economic realities necessitated the creation of BitcoinII as a clean launch rather than a fork of the existing Bitcoin chain.'},
{type:'text', text:'1. Preservation of Protocol Integrity'},
{type:'text', text:'Recent developments in Bitcoin Core have demonstrated a departure from Satoshi Nakamoto\u2019s original design principles. Proposals such as PR #28130 (July 2023) sought to relax long-standing standardness rules around OP_RETURN usage, opening the door to embedding arbitrary and oversized data within the blockchain. Subsequent changes, including the 2025 \u201c4MB OP_RETURN\u201d relaxation, reinforced this trajectory, effectively repurposing Bitcoin\u2019s block space as a general-purpose data store rather than its intended role as a peer-to-peer electronic cash system. BitcoinII rejects this scope creep and preserves the chain\u2019s integrity as peer-to-peer cash, not as a vehicle for arbitrary data storage.'},
{type:'text', text:'2. Economic Infeasibility of Forking Bitcoin Mainnet'},
{type:'text', text:'Launching a fork of the current Bitcoin mainnet at today\u2019s global difficulty target would be economically untenable. With network difficulty measured at over 100 trillion, no independent fork could marshal sufficient hashrate to sustain chain security. Any such attempt would be immediately vulnerable to reorganization or outright abandonment. By contrast, BitcoinII\u2019s clean genesis begins at difficulty 1, enabling organic growth and security proportional to its actual network hashrate. This ensures a viable path to decentralization without the systemic fragility of a high-difficulty fork.'},
{type:'text', text:'BitcoinII exists to uphold the original vision of Bitcoin as a peer-to-peer cash system, free from protocol bloat and free from the economic impracticalities of forking a chain that has become prohibitively secured by incumbent miners. The clean launch was not merely a design choice, it was the only viable path forward.'},
{type:'separator'},
{type:'section', text:'Protocol Alignment'},
{type:'text', text:'As of today, BitcoinII is functionally 1:1 with Bitcoin in terms of protocol implementation. It supports SegWit, Taproot, and the same consensus rules and validation logic. Developers and users familiar with Bitcoin will find no surprises in BitcoinII. Wallets, addresses, and key management behave identically, ensuring that the knowledge and tools built for Bitcoin can be applied seamlessly to BitcoinII.'},
{type:'separator'},
{type:'section', text:'A Parallel Option'},
{type:'text', text:'BitcoinII does not ask users to abandon Bitcoin. Both networks can run side by side on the same machine, in separate data directories, on separate ports, under separate P.I.D.s, without conflict or cross-contamination. BitcoinII is designed to do this natively, without user intervention. This proves the design intention. BitcoinII is not competition to Bitcoin, but complement: a second option, based on the same protocol, offered to the world. Just as diversity strengthens ecosystems, two parallel monetary systems based on the same proven design create resilience against capture, stagnation, or systemic risk.'},
{type:'separator'},
{type:'section', text:'Governance and Future Direction'},
{type:'text', text:'Where BitcoinII diverges is in its governance philosophy: We remain committed to Bitcoin\u2019s original purpose as a borderless, censorship-resistant, inflation-proof, responsible monetary system, and resist protocol drift toward non-monetary use cases. For example, upcoming changes in Bitcoin Core v30 to expand OP_RETURN limits to 4MB per transaction are rejected. Such proposals distort the monetary focus of the chain, turning scarce block space into a playground for arbitrary data storage rather than settlement of monetary value. BitcoinII will adopt upstream improvements where they strengthen the system as money and improve network and user security, and decline those that compromise that focus.'},
{type:'separator'},
{type:'section', text:'Why Now?'},
{type:'text', text:'There are two main driving factors behind the BitcoinII Organization\u2019s launch of BitcoinII:'},
{type:'text', text:'Reason 1: We cannot stand idly by and do nothing while the decentralization of the Bitcoin mainnet is further compromised by actions taken by some Developers who would render the chain susceptible to an amount of unnecessary bloat that would make it financially prohibitive for solo node operators to maintain running a Bitcoin node. While we cannot stop them from producing Bitcoin Core v30 and releasing it, we can provide a sort of a contingency plan in the form of a brand new network founded on principles that \u201cBitcoin Maxis\u201d uphold.'},
{type:'text', text:'Reason 2: The world has seen what Bitcoin has become and what it is capable of: an asset class, a settlement network, a lifeline in failing economies, all while being highly resistant to malicious attacks on the network, global economic disruption due to politics, war, and widespread epidemics of diseases. The world needs a reliable form of currency that is not easy to manipulate, and that can be accessed and held by anyone on the planet willing to run a simple node of the network on modest hardware.'},
{type:'text', text:'Conversely, this entire situation brings about a new opportunity for many: Many missed the opportunity to participate meaningfully in Bitcoin\u2019s early distribution and adoption phase, some by virtue of simply not having been born yet, others by lack of knowledge of Bitcoin existing. BitcoinII reopens that door, without altering the mathematics or the monetary supply, and without causing interference to the original Bitcoin network. Twenty-one million coins, halving every four years, difficulty retarget every 2016 blocks. The same rules that launched Bitcoin in 2009, are applied again to a clean slate in 2025.'},
{type:'separator'},
{type:'section', text:'Conclusion'},
{type:'text', text:'BitcoinII is not a fork of the Bitcoin chain, not a sidechain, and not a derivative token. It is Bitcoin\u2019s design, on a new network. A parallel, uncorrupted ledger that offers both continuity and choice. Just as Bitcoin proved that money can be secured by math, BitcoinII proves that such a system can be launched again: not to replace, but to reinforce the laws of sound currency secured by Proof of Work expended to secure and validate transactions on the network, and to enforce a consensus of what is true and correct amongst a global network of peers who all adhere to the same set of rules.'},
{type:'separator'},
{type:'section', text:'References'},
{type:'ref', text:'[1] S. Nakamoto, \u201cBitcoin: A Peer-to-Peer Electronic Cash System\u201d, https://bitcoin.org/bitcoin.pdf, 2009.'},
{type:'ref', text:'[2] Bitcoin Core\u2019s Pull Requests #28130, #32359, #32406, https://github.com/bitcoin/bitcoin/pulls, 2023, 2024, 2025'}
];

/* ════════════════════════════════════════════
   TAB SWITCHING
   ════════════════════════════════════════════ */
function switchTab(tabId) {
    burnOnTabSwitch(tabId);
    document.querySelectorAll('.tab-btn').forEach(function(b) { b.classList.remove('active'); });
    document.querySelectorAll('.tab-content').forEach(function(c) { c.classList.remove('active'); });
    var map = { 'faq': 0, 'emails': 1, 'forum': 2, 'btc-wp': 3, 'bc2-wp': 4, 'cypherpunks': 5, 'resources': 6, 'desktop': 7 };
    document.querySelectorAll('.tab-btn')[map[tabId]].classList.add('active');
    document.getElementById('tab-' + tabId).classList.add('active');
    if (tabId === 'faq') { setTimeout(function(){ document.getElementById('faqInput').focus(); }, 100); }
}

/* ════════════════════════════════════════════
   EMAIL ENGINE
   ════════════════════════════════════════════ */
var currentEmailIdx = 0;
var typeSpeed = 15;
var typeTimer = null;
var isTyping = false;
var typingComplete = false;

function setSpeed(ms) {
    typeSpeed = ms;
    document.querySelectorAll('.speed-btn').forEach(function(b) {
        b.classList.toggle('active', parseInt(b.dataset.speed) === ms);
    });
}

function toggleEmailView(view) {
    var pub = document.getElementById('emailTogglePublic');
    var prv = document.getElementById('emailTogglePrivate');
    var emailScroll = document.getElementById('emailScroll');
    var privateScroll = document.getElementById('privateEmailScroll');
    var controls = document.getElementById('emailControls');
    var progress = document.querySelector('.email-progress');
    var counter = document.getElementById('emailCounter');
    if (view === 'private') {
        pub.classList.remove('active'); prv.classList.add('active');
        emailScroll.style.display = 'none'; privateScroll.style.display = '';
        controls.style.display = 'none'; if(progress)progress.style.display = 'none';
        counter.textContent = privateEmails.length + ' letters';
        renderPrivateEmails();
    } else {
        prv.classList.remove('active'); pub.classList.add('active');
        emailScroll.style.display = ''; privateScroll.style.display = 'none';
        controls.style.display = ''; if(progress)progress.style.display = '';
        updateCounter();
    }
}

function updateCounter() {
    document.getElementById('emailCounter').textContent = (currentEmailIdx + 1) + ' / ' + EMAILS.length;
    document.getElementById('emailProgressFill').style.width = ((currentEmailIdx + 1) / EMAILS.length * 100) + '%';
    document.getElementById('btnPrev').disabled = currentEmailIdx === 0;
    document.getElementById('btnNext').disabled = currentEmailIdx >= EMAILS.length - 1;
}

function showEmail(idx) {
    // Burn-in: stamp outgoing email content
    var scrollBurn = document.getElementById('emailScroll');
    if (scrollBurn && scrollBurn.textContent.trim().length > 30) {
        burnOnEmailChange(scrollBurn);
    }
    if (typeTimer) { clearTimeout(typeTimer); typeTimer = null; }
    currentEmailIdx = idx;
    isTyping = false;
    typingComplete = false;
    updateCounter();

    var email = EMAILS[idx];
    var display = document.getElementById('emailDisplay');
    var scroll = document.getElementById('emailScroll');

    // Build header
    var isSatoshi = email.type === 'satoshi';
    var html = '<div class="email-hdr">';
    html += '<span class="email-hdr-label">Date:</span><span class="email-hdr-value">' + email.date + '</span>';
    html += '<span class="email-hdr-label">From:</span><span class="email-hdr-value' + (isSatoshi ? ' from-satoshi' : '') + '">' + escHtml(email.from) + '</span>';
    html += '<span class="email-hdr-label">To:</span><span class="email-hdr-value">' + escHtml(email.to) + '</span>';
    html += '<span class="email-hdr-label">Subject:</span><span class="email-hdr-value subject-line">' + escHtml(email.subject);
    if (email.milestone) html += '<span class="email-milestone-badge">★ MILESTONE</span>';
    html += '</span>';
    html += '<span class="email-star-slot" id="emailStarSlot"></span>';
    html += '</div>';
    html += '<div class="email-body" id="emailBody"></div>';
    if (email.context) {
        html += '<div class="email-context" id="emailContext" style="display:none">' + escHtml(email.context) + '</div>';
    }
    if (email.bc2) {
        html += '<div class="email-bc2-note" id="emailBc2" style="display:none">' + escHtml(email.bc2) + '</div>';
    }

    display.innerHTML = html;
    // Insert star button
    var emailStarSlot = document.getElementById('emailStarSlot');
    if (emailStarSlot) { emailStarSlot.appendChild(createStarBtn('email', email.id)); }
    scroll.scrollTop = 0;

    // Start typing body
    if (typeSpeed === 0) {
        document.getElementById('emailBody').textContent = email.body;
        typingComplete = true;
        showPostContent();
    } else {
        typeEmailBody(email.body, 0);
    }
}

function typeEmailBody(text, charIdx) {
    isTyping = true;
    var bodyEl = document.getElementById('emailBody');
    if (!bodyEl) return;

    if (charIdx >= text.length) {
        isTyping = false;
        typingComplete = true;
        // Remove cursor if present
        var cursor = bodyEl.querySelector('.typing-cursor');
        if (cursor) cursor.remove();
        showPostContent();
        return;
    }

    // Add chars in small chunks for performance
    var chunk = Math.min(3, text.length - charIdx);
    var currentText = text.substring(0, charIdx + chunk);
    bodyEl.textContent = currentText;

    // Add cursor
    var cursor = document.createElement('span');
    cursor.className = 'typing-cursor';
    bodyEl.appendChild(cursor);

    // Auto-scroll
    var scroll = document.getElementById('emailScroll');
    scroll.scrollTop = scroll.scrollHeight;

    var delay = typeSpeed;
    // Slight pause at newlines
    if (text[charIdx] === '\n') delay = typeSpeed * 3;

    typeTimer = setTimeout(function() { typeEmailBody(text, charIdx + chunk); }, delay);
}

function showPostContent() {
    var ctx = document.getElementById('emailContext');
    var bc2 = document.getElementById('emailBc2');
    if (ctx) ctx.style.display = 'block';
    if (bc2) bc2.style.display = 'block';
    var scroll = document.getElementById('emailScroll');
    setTimeout(function() { scroll.scrollTop = scroll.scrollHeight; }, 50);
}

function skipTyping() {
    if (typeTimer) { clearTimeout(typeTimer); typeTimer = null; }
    var email = EMAILS[currentEmailIdx];
    var bodyEl = document.getElementById('emailBody');
    if (bodyEl) {
        bodyEl.textContent = email.body;
    }
    isTyping = false;
    typingComplete = true;
    showPostContent();
}

function nextEmail() {
    if (isTyping) { skipTyping(); return; }
    if (currentEmailIdx < EMAILS.length - 1) {
        showEmail(currentEmailIdx + 1);
    }
}

function prevEmail() {
    if (currentEmailIdx > 0) {
        showEmail(currentEmailIdx - 1);
    }
}

function escHtml(str) {
    return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

/* ════════════════════════════════════════════
   WHITEPAPER RENDERERS
   ════════════════════════════════════════════ */
function renderWhitepaper(sections, containerId, colorClass) {
    var container = document.getElementById(containerId);
    var html = '';
    sections.forEach(function(s) {
        if (s.type === 'title') {
            html += '<div class="wp-title ' + (colorClass || '') + '">' + escHtml(s.text) + '</div>';
        } else if (s.type === 'author') {
            html += '<div class="wp-author">' + escHtml(s.text) + '</div>';
        } else if (s.type === 'section') {
            html += '<div class="wp-section-title ' + (colorClass || '') + '">' + escHtml(s.text) + '</div>';
        } else if (s.type === 'text') {
            html += '<div class="wp-text">' + escHtml(s.text) + '</div>';
        } else if (s.type === 'separator') {
            html += '<div class="wp-separator">· · · · ·</div>';
        } else if (s.type === 'ref') {
            html += '<div class="wp-ref">' + escHtml(s.text) + '</div>';
        }
    });
    container.innerHTML = html;
}

/* ════════════════════════════════════════════
   CRT NOISE
   ════════════════════════════════════════════ */
function initNoise() {
    var canvas = document.getElementById('noiseCanvas');
    if (!canvas) return;
    var ctx = canvas.getContext('2d');
    canvas.width = 200; canvas.height = 200;
    var img = ctx.createImageData(200, 200);
    function drawNoise() {
        var d = img.data;
        for (var i = 0; i < d.length; i += 16) {
            var v = Math.random() * 255;
            d[i] = d[i+1] = d[i+2] = v; d[i+3] = 10;
            d[i+4] = d[i+5] = d[i+6] = v; d[i+7] = 10;
            d[i+8] = d[i+9] = d[i+10] = v; d[i+11] = 10;
            d[i+12] = d[i+13] = d[i+14] = v; d[i+15] = 10;
        }
        ctx.putImageData(img, 0, 0);
    }
    setInterval(drawNoise, 120);
}

/* ════════════════════════════════════════════
   KEYBOARD NAVIGATION
   ════════════════════════════════════════════ */
document.addEventListener('keydown', function(e) {
    // Only handle email navigation when emails tab is active
    var emailTab = document.getElementById('tab-emails');
    if (!emailTab || !emailTab.classList.contains('active')) return;
    if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextEmail(); }
    if (e.key === 'ArrowLeft') { e.preventDefault(); prevEmail(); }
    if (e.key === 'Escape') { skipTyping(); }
});

/* ════════════════════════════════════════════
   FAQ DATA: TOPICS
   ════════════════════════════════════════════ */
var FAQ_TOPICS = [
    { id: 'origins', label: 'Origins', icon: '◈' },
    { id: 'mining', label: 'Mining', icon: '⊞' },
    { id: 'supply', label: '21M Supply', icon: '◆' },
    { id: 'decentralization', label: 'Decentralization', icon: '⬡' },
    { id: 'transactions', label: 'Transactions', icon: '⇄' },
    { id: 'privacy', label: 'Privacy', icon: '◉' },
    { id: 'scaling', label: 'Scaling', icon: '▦' },
    { id: 'security', label: 'Security', icon: '⊕' },
    { id: 'bc2', label: 'BC2', icon: '₿' },
    { id: 'philosophy', label: 'Philosophy', icon: '✧' },
    { id: 'community', label: 'Community', icon: '◬' }
];

/* ════════════════════════════════════════════
   FAQ DATA: KNOWLEDGE BASE
   ════════════════════════════════════════════ */
var FAQ_DB = [
// ── ORIGINS ──
{
    topic: 'origins', q: 'Why was Bitcoin created?',
    a: '"The root problem with conventional currency is all the trust that\'s required to make it work. The central bank must be trusted not to debase the currency, but the history of fiat currencies is full of breaches of that trust. Banks must be trusted to hold our money and transfer it electronically, but they lend it out in waves of credit bubbles with barely a fraction in reserve."',
    source: 'Satoshi Nakamoto, P2P Foundation, Feb 11 2009',
    bc2: 'BC2 carries this same conviction forward. A parallel chain preserving the original Bitcoin code — because the need for trustless money hasn\'t changed.'
},
{
    topic: 'origins', q: 'What problem does proof-of-work solve?',
    a: '"What is needed is an electronic payment system based on cryptographic proof instead of trust, allowing any two willing parties to transact directly with each other without the need for a trusted third party."',
    source: 'Bitcoin Whitepaper, Abstract, Oct 31 2008',
    bc2: 'BC2 uses the same SHA-256 proof-of-work as Bitcoin — the most battle-tested consensus mechanism in history.'
},
{
    topic: 'origins', q: 'When did Satoshi start working on Bitcoin?',
    a: '"I\'ve been working on a new electronic cash system that\'s fully peer-to-peer, with no trusted third party." Satoshi explained that he did it backwards — writing all the code first before convincing himself every problem was solvable, then writing the whitepaper.',
    source: 'Cryptography mailing list, Nov 2008',
    bc2: 'BC2 follows the same builder-first philosophy. Code was running before the marketing started. Ship, then talk.'
},
{
    topic: 'origins', q: 'What is the genesis block?',
    a: 'The genesis block is the first block in the chain — block zero. Bitcoin\'s genesis block was mined on January 3, 2009 and embedded the message: "The Times 03/Jan/2009 Chancellor on brink of second bailout for banks." It serves as both a timestamp proof and a philosophical statement about why decentralized money matters.',
    source: 'Bitcoin blockchain, Block #0',
    bc2: 'BC2\'s genesis block (Dec 5, 2024) references the French government collapse — 15 years later, the same problem Satoshi identified remains unsolved. Sound money is still needed.'
},
{
    topic: 'origins', q: 'Who did Satoshi contact before publishing?',
    a: 'Satoshi reached out to Wei Dai (creator of b-money) and Adam Back (creator of Hashcash) before publishing the whitepaper. He wrote to Dai: "I was very interested to read your b-money page. I\'m getting ready to release a paper that expands on your ideas into a complete working system."',
    source: 'Satoshi to Wei Dai, Aug 22 2008',
    bc2: 'BC2 continues this lineage — building on the same cryptographic foundations: hashcash proof-of-work, b-money\'s decentralized ledger, and the cypherpunk vision of electronic cash.'
},
{
    topic: 'origins', q: 'What was the first public response to Bitcoin?',
    a: 'Hal Finney was the first to publicly respond to Satoshi\'s announcement on the cryptography mailing list. On November 1, 2008 he wrote: "Bitcoin seems to be a very promising idea... I like the idea of basing security on the assumption that the CPU power of honest participants outweighs that of the attacker."',
    source: 'Hal Finney, Cryptography Mailing List, Nov 1 2008',
    bc2: 'Hal Finney understood Bitcoin immediately. He later predicted each coin could reach $10 million if Bitcoin became the dominant payment system. BC2 carries forward the values he recognized.'
},
{
    topic: 'origins', q: 'What was the first objection to Bitcoin?',
    a: 'James A. Donald raised the first scaling objection on November 2, 2008: "The way I understand your proposal, it does not seem to scale to the required size." Satoshi responded with calculations showing Bitcoin could handle existing Visa transaction volumes and introduced SPV (Simplified Payment Verification).',
    source: 'Cryptography Mailing List, Nov 2-3 2008',
    bc2: 'BC2 inherits Satoshi\'s conservative scaling approach — handle monetary transactions efficiently rather than bloating blocks with non-monetary data.'
},
// ── MINING ──
{
    topic: 'mining', q: 'How does mining work?',
    a: '"The proof-of-work involves scanning for a value that when hashed, such as with SHA-256, the hash begins with a number of zero bits. The average work required is exponential in the number of zero bits required and can be verified by executing a single hash."',
    source: 'Bitcoin Whitepaper, Section 4',
    bc2: 'BC2 runs the exact same SHA-256 proof-of-work on Bitcoin Core v29 code, maintaining the same fundamental security model Satoshi designed.'
},
{
    topic: 'mining', q: 'Is mining a race?',
    a: '"It\'s not like a race where if one car is twice as fast, it\'ll always win. It\'s an SHA-256 that takes less than a microsecond, and each guess has an independent chance of success. Each computer\'s chance of finding a hash collision is linearly proportional to its CPU power. A computer that\'s half as fast would get half as many coins."',
    source: 'Satoshi, forum Q&A compiled for Martti Malmi',
    bc2: 'This proportional fairness is fundamental to BC2. Mining rewards are distributed proportional to contributed hashpower — no winner-take-all dynamics.'
},
{
    topic: 'mining', q: 'What is the mining incentive?',
    a: '"By convention, the first transaction in a block is a special transaction that starts a new coin owned by the creator of the block. This adds an incentive for nodes to support the network, and provides a way to initially distribute coins into circulation, since there is no central authority to issue them."',
    source: 'Bitcoin Whitepaper, Section 6',
    bc2: 'BC2 follows the same halving schedule as Bitcoin. Block rewards decrease every 210,000 blocks, transitioning to fee-based incentives as Satoshi designed.'
},
{
    topic: 'mining', q: 'Why does mining use so much energy?',
    a: '"Unfortunately, proof of work is the only solution I\'ve found to make p2p e-cash work without a trusted third party. Even if I wasn\'t using it secondarily as a way to allocate the initial distribution of currency, PoW is fundamental to coordinating the network and preventing double-spending. If it did grow to consume significant energy, I think it would still be less wasteful than the labour and resource intensive conventional banking activity it would replace."',
    source: 'Satoshi, Cryptography Mailing List',
    bc2: 'Proof-of-work is not a bug — it\'s the core innovation. BC2 will never move to proof-of-stake. The energy expenditure IS the security.'
},
{
    topic: 'mining', q: 'What was Satoshi\'s vision for CPU mining?',
    a: 'Satoshi originally envisioned one-CPU-one-vote, where anyone with a desktop computer could mine Bitcoin. He told Martti Malmi: "One easy thing that really helps is to run a node that can accept incoming connections — to make sure that new users who try it out have someone to connect to. If they run it and get no connections, they\'ll probably just give up."',
    source: 'Satoshi to Martti Malmi, May 2 2009',
    bc2: 'BC2 runs identical SHA-256 on Bitcoin Core v29 — the same ASICs that mine BTC can mine BC2. The difference is policy, not algorithm.'
},
{
    topic: 'mining', q: 'What about the value of mined coins vs electricity?',
    a: '"The value of bitcoins would be relative to the electricity consumed to produce them. All modern CPUs save power when they\'re idle. If you run a computational task 24/7, not letting it idle, it uses significantly more power. The extra wattage consumed goes straight to your power bill, and the value of the bitcoins you produce would be something less than that."',
    source: 'Satoshi, forum Q&A',
    bc2: 'This electricity-to-value relationship is the backbone of proof-of-work economics. BC2 miners face the same tradeoffs — real-world cost creates real-world value.'
},
// ── SUPPLY ──
{
    topic: 'supply', q: 'Why 21 million coins?',
    a: '"My choice for the number of coins and distribution schedule was an educated guess. It was a difficult choice, because once the network is going it\'s locked in and we\'re stuck with it. I wanted to pick something that would make prices similar to existing currencies, but without knowing the future, that\'s very hard. I ended up picking something in the middle."',
    source: 'Satoshi, forum Q&A compiled for Martti Malmi',
    bc2: 'BC2 inherits the same 21 million supply cap. It was difficult to choose, but once chosen it\'s immutable. That commitment is what makes it sound money.'
},
{
    topic: 'supply', q: 'What is the smallest unit of Bitcoin?',
    a: '"Values are 64-bit integers with 8 decimal places, so 1 coin is represented internally as 100000000. There\'s plenty of granularity if typical prices become small. For example, if 0.001 is worth 1 Euro, then it might be easier to change where the decimal point is displayed, so if you had 1 Bitcoin it\'s now displayed as 1000, and 0.001 is displayed as 1."',
    source: 'Satoshi, forum Q&A',
    bc2: 'BC2 has the same 8 decimal places. One BC2 = 100,000,000 satoshis. Plenty of granularity for micropayments and everyday commerce.'
},
{
    topic: 'supply', q: 'How does the halving schedule work?',
    a: 'The block reward starts at 50 coins and halves every 210,000 blocks (roughly every 4 years). So it goes: 50, 25, 12.5, 6.25, 3.125... This geometric series approaches but never reaches 21 million total coins. The last bitcoin will be mined around the year 2140.',
    source: 'Bitcoin source code, GetBlockSubsidy()',
    bc2: 'BC2 follows the identical halving schedule — the same monetary policy that makes Bitcoin deflationary by design.'
},
{
    topic: 'supply', q: 'Can lost coins be recovered?',
    a: 'Lost coins cannot be recovered. When private keys are lost, those coins are permanently removed from circulation. Satoshi acknowledged this was a feature, not a bug — lost coins make everyone else\'s coins slightly more valuable, effectively distributing their value to all remaining holders.',
    source: 'BitcoinTalk forum, Satoshi Nakamoto',
    bc2: 'Same applies to BC2. Lost coins are lost forever. This makes proper wallet backups critical — and makes surviving coins more valuable over time.'
},
// ── DECENTRALIZATION ──
{
    topic: 'decentralization', q: 'Why no trusted third party?',
    a: '"The root problem with conventional currency is all the trust that\'s required to make it work... We have to trust them with our privacy, trust them not to let identity thieves drain our accounts. Their massive overhead costs make micropayments impossible."',
    source: 'Satoshi, P2P Foundation, Feb 2009',
    bc2: 'BC2 eliminates trusted third parties at every level — no central servers, no gatekeepers, no single points of failure. Peer-to-peer electronic cash.'
},
{
    topic: 'decentralization', q: 'How does the network reach consensus?',
    a: '"The proof-of-work also solves the problem of determining representation in majority decision making. One-CPU-one-vote. The majority decision is represented by the longest chain, which has the greatest proof-of-work effort invested in it."',
    source: 'Bitcoin Whitepaper, Section 4',
    bc2: 'BC2 uses the same Nakamoto consensus — the chain with the most cumulative proof-of-work is the valid chain. No voting, no delegates, no committees.'
},
{
    topic: 'decentralization', q: 'What is the role of nodes?',
    a: '"Nodes can leave and rejoin the network at will, accepting the proof-of-work chain as proof of what happened while they were gone. They vote with their CPU power, expressing their acceptance of valid blocks by working on extending them and rejecting invalid blocks by refusing to work on them."',
    source: 'Bitcoin Whitepaper, Section 12',
    bc2: 'BC2 nodes enforce the same consensus rules. Every node independently validates every transaction. No node is special. No node is required.'
},
{
    topic: 'decentralization', q: 'What about node identity?',
    a: '"There is no reliance on identifying anyone. As you\'ve said, it\'s futile and can be trivially defeated with sock puppets. The credential that establishes someone as real is the ability to supply CPU power."',
    source: 'Satoshi, Cryptography Mailing List',
    bc2: 'BC2 doesn\'t care who you are. It cares about proof-of-work. Identity is irrelevant. Math is the only credential.'
},
// ── TRANSACTIONS ──
{
    topic: 'transactions', q: 'What is an electronic coin?',
    a: '"We define an electronic coin as a chain of digital signatures. Each owner transfers the coin to the next by digitally signing a hash of the previous transaction and the public key of the next owner and adding these to the end of the coin. A payee can verify the signatures to verify the chain of ownership."',
    source: 'Bitcoin Whitepaper, Section 2',
    bc2: 'BC2 uses the same UTXO transaction model. Coins are chains of signatures, verified by anyone, controlled by no one.'
},
{
    topic: 'transactions', q: 'Are transactions reversible?',
    a: '"With e-currency based on cryptographic proof, without the need to trust a third party middleman, money can be secure and transactions effortless. Transactions that are computationally impractical to reverse would protect sellers from fraud."',
    source: 'Bitcoin Whitepaper + P2P Foundation post',
    bc2: 'BC2 transactions are irreversible by design. No chargebacks, no disputes, no intermediaries. This is electronic cash, not electronic credit.'
},
{
    topic: 'transactions', q: 'How fast can you accept a payment?',
    a: '"For micropayments, you can safely accept the payment immediately. The size of the payment is too small for the effort to steal it. Currently, businesses accept a certain chargeoff rate. I believe the risk with 1 or even 0 confirming blocks will be much less than the rate of chargebacks on verified credit card transactions."',
    source: 'Satoshi, forum Q&A',
    bc2: 'BC2 merchant solutions embrace instant acceptance for small payments — just as Satoshi intended. The fraud risk is negligible compared to credit card chargebacks.'
},
{
    topic: 'transactions', q: 'Can you include messages with transactions?',
    a: '"I badly wanted to find some way to include a comment with indirect transfers, but there just wasn\'t a way to do it. Bitcoin uses EC-DSA, which was essential for making the block chain compact enough to be practical with today\'s technology because its signatures are an order of magnitude smaller than RSA. But EC-DSA can\'t encrypt messages like RSA."',
    source: 'Satoshi, Q&A dump for Martti Malmi',
    bc2: 'Satoshi prioritized compact blocks over message features. BC2 shares this priority — blocks are for monetary transactions, not arbitrary data storage.'
},
{
    topic: 'transactions', q: 'What are transaction fees?',
    a: '"I don\'t anticipate that fees will be needed anytime soon, but if it becomes too burdensome to run a node, it is possible to run a node that only processes transactions that include a transaction fee. The fee the market would settle on should be minimal."',
    source: 'Satoshi, forum Q&A',
    bc2: 'BC2\'s conservative block policy keeps fees minimal by preventing non-monetary data from consuming block space. Monetary transactions first.'
},
// ── PRIVACY ──
{
    topic: 'privacy', q: 'How does Bitcoin handle privacy?',
    a: '"The traditional banking model achieves a level of privacy by limiting access to information to the parties involved and the trusted third party. The necessity to announce all transactions publicly precludes this method, but privacy can still be maintained by breaking the flow of information in another place: by keeping public keys anonymous."',
    source: 'Bitcoin Whitepaper, Section 10',
    bc2: 'BC2 maintains this privacy model. New key pairs for every transaction. No KYC at the protocol level. The owner of a coin is just whoever has its private key.'
},
{
    topic: 'privacy', q: 'What did Satoshi say about anonymity?',
    a: '"To protect privacy, key pairs are used only once, with a new one for every transaction. The owner of a coin is just whoever has its private key. Of course, the biggest difference is the lack of a central server. That was the Achilles heel of Chaumian systems; when the central company shut down, so did the currency."',
    source: 'Satoshi, response to Martien van Steenbergen',
    bc2: 'Privacy through decentralization, not through a central authority. BC2 carries forward this fundamental design choice.'
},
{
    topic: 'privacy', q: 'Did Satoshi remove "anonymous" from bitcoin.org?',
    a: 'In late 2010, Satoshi told Martti Malmi: "I\'ve removed \'anonymous\' from the description of Bitcoin on the website. I think that term is being over-emphasized." He understood that Bitcoin was pseudonymous rather than truly anonymous, and wanted to avoid overpromising on privacy guarantees.',
    source: 'Satoshi to Martti Malmi, Dec 2010',
    bc2: 'BC2 is honest about its privacy model. Pseudonymous, not anonymous. Privacy best practices are encouraged but not marketed as guarantees.'
},
// ── SCALING ──
{
    topic: 'scaling', q: 'Can Bitcoin scale to global adoption?',
    a: '"The existing Visa credit card network processes about 15 million Internet purchases per day worldwide. Bitcoin can already scale much larger than that with existing hardware for a fraction of the cost. It never really hits a scale ceiling." Satoshi also noted: "By Moore\'s Law, we can expect hardware speed to be 10 times faster in 5 years and 100 times faster in 10."',
    source: 'Satoshi, forum Q&A compiled for Martti Malmi',
    bc2: 'BC2 follows Satoshi\'s scaling roadmap — the base layer handles monetary transactions efficiently, with SPV for lightweight clients.'
},
{
    topic: 'scaling', q: 'What is Simplified Payment Verification?',
    a: '"It is possible to verify payments without running a full network node. A user only needs to keep a copy of the block headers of the longest proof-of-work chain, which he can get by querying network nodes until he\'s convinced he has the longest chain, and obtain the Merkle branch linking the transaction to the block it\'s timestamped in."',
    source: 'Bitcoin Whitepaper, Section 8',
    bc2: 'Genesis Wallet uses SPV for lightweight mobile access to the BC2 network — exactly as Satoshi described.'
},
{
    topic: 'scaling', q: 'What about bandwidth requirements?',
    a: '"At 1KB per transaction, 15 million tx per day would be 15GB of bandwidth for each block generating node per day, or about two DVD movies worth. Seems do-able even with today\'s technology. Important to remember, even if Bitcoin caught on at dot-com rates of growth, it would still take years to become any substantial fraction of all transactions."',
    source: 'Satoshi, response to scaling questions',
    bc2: 'BC2\'s conservative block policy keeps bandwidth requirements manageable. Monetary transactions are small. Non-monetary bloat is filtered.'
},
// ── SECURITY ──
{
    topic: 'security', q: 'What protects the network from attack?',
    a: '"A key aspect of Bitcoin is that the security of the network grows as the size of the network and the amount of value that needs to be protected grows. The down side is that it\'s vulnerable at the beginning when it\'s small, although the value that could be stolen should always be smaller than the amount of effort required to steal it."',
    source: 'Satoshi, forum Q&A',
    bc2: 'BC2\'s difficulty adjustment makes attacks economically irrational. The cost of attacking always exceeds the potential reward. Security scales with value.'
},
{
    topic: 'security', q: 'How does difficulty adjustment protect the network?',
    a: '"The difficulty is controlled by a moving average that compensates for the total effort being expended to keep the total production constant. As computers get more powerful, the difficulty increases to compensate." This means attackers must sustain mining power through difficulty increases — making sustained attacks prohibitively expensive.',
    source: 'Satoshi, multiple sources',
    bc2: 'BC2\'s slow blocks during high difficulty periods are intentional supply throttling — preventing rapid inflation during hashrate surges and making 51% attacks economically irrational.'
},
{
    topic: 'security', q: 'What did Satoshi say about early vulnerabilities?',
    a: '"The project needs to grow gradually so the software can be strengthened along the way. I make this appeal to WikiLeaks not to try to use Bitcoin. Bitcoin is a small beta community in its infancy. You would not stand to get more than pocket change, and the heat you would bring would likely destroy us at this stage."',
    source: 'Satoshi, BitcoinTalk, Dec 2010',
    bc2: 'Satoshi understood timing matters. BC2 is building its foundation first — infrastructure before headlines, strength before stress testing.'
},
{
    topic: 'security', q: 'What about backup and wallet security?',
    a: '"The crucial file to backup is wallet.dat. This will be an absolutely essential feature once things get going, making it so you can lock your wealth up with strong encryption and back it up more securely than any physical safe."',
    source: 'Satoshi to Martti Malmi, May 2009',
    bc2: 'Genesis Wallet inherits this priority. Encrypted backups, strong passwords, and user-controlled keys. Not your keys, not your coins.'
},
// ── BC2 ──
{
    topic: 'bc2', q: 'What is BC2?',
    a: 'BitcoinII (BC2) is Bitcoin\'s conservative sister chain \u2014 a direct continuation of Satoshi Nakamoto\'s vision and a faithful re-deployment of the original protocol, identical in monetary policy, issuance, and consensus rules. It starts fresh with a clean Genesis Block and no premine, preserving the proven security model and economics of the Nakamoto Protocol.',
    source: 'BitcoinII Whitepaper, August 18, 2025',
    bc2: 'Not a fork, not a sidechain, not a derivative token. Bitcoin\'s conservative sister chain — preserving what Bitcoin was meant to be.'
},
{
    topic: 'bc2', q: 'Why does BC2 exist?',
    a: 'Two realities: First, Bitcoin Core departed from Satoshi\'s design \u2014 PR #28130 relaxed OP_RETURN rules, and the 2025 4MB OP_RETURN change repurposed block space as a general data store. Second, forking Bitcoin mainnet at 100+ trillion difficulty is economically untenable. BC2\'s clean genesis at difficulty 1 enables organic growth without systemic fragility.',
    source: 'BitcoinII Whitepaper, August 18, 2025',
    bc2: 'The clean launch was not merely a design choice, it was the only viable path forward.'
},
{
    topic: 'bc2', q: 'Does BC2 use a different mining algorithm than Bitcoin?',
    a: 'No. BC2 runs the exact same SHA-256 proof-of-work algorithm as Bitcoin, on code forked from Bitcoin Core v29. The same ASIC hardware that mines BTC can mine BC2. The difference between BC2 and Bitcoin is not the mining algorithm — it is the policy: BC2 preserves pre-v30 anti-spam transaction rules.',
    source: 'BitcoinII Technical Documentation',
    bc2: 'By running identical SHA-256, BC2 inherits all of Bitcoin\'s battle-tested security research and hardware infrastructure rather than introducing untested alternatives.'
},
{
    topic: 'bc2', q: 'How does BC2 relate to Bitcoin Knots vs Core?',
    a: 'Bitcoin Core relaxed OP_RETURN standardness rules (PR #28130, then the 2025 4MB expansion), opening blocks to arbitrary data. BitcoinII rejects this scope creep. It will adopt upstream improvements that strengthen the system as money, and decline those that compromise that focus.',
    source: 'BitcoinII Whitepaper, August 18, 2025',
    bc2: 'BC2 doesn\'t pick sides in the Knots vs Core debate. It simply preserves the original vision as Bitcoin\'s conservative sister chain.'
},
{
    topic: 'bc2', q: 'What infrastructure does BC2 have?',
    a: 'BC2\'s ecosystem includes: Genesis Wallet (mobile), mining pools, atomic swap services, vanity address generators, a full block explorer, and interactive community-built websites like the Mempool Aquarium and this Satoshi Archive terminal.',
    source: 'BitcoinII Ecosystem',
    bc2: 'Everything a Bitcoin ecosystem needs — built from scratch for the conservative sister chain, with a growing community creating its own tools and experiences.'
},
{
    topic: 'bc2', q: 'Is BC2 compatible with Bitcoin?',
    a: 'Yes. BC2 runs on Bitcoin Core v29 code with the same UTXO model, scripting language, and address formats. Tooling built for Bitcoin — wallets, explorers, payment processors — can be adapted for BC2 with minimal modification. Cross-chain interoperability between BTC and BC2 is a long-term goal.',
    source: 'BitcoinII Technical Documentation',
    bc2: 'Sister chains, not competitors. Protocol-level compatibility means users are never forced to choose.'
},
{
    topic: 'bc2', q: 'What is the BC2 genesis block message?',
    a: 'BC2\'s genesis block references the collapse of France\'s government on December 5, 2024 — the first no-confidence vote in decades, triggered by a \u20ac3.2 trillion debt crisis (112% of GDP). This echoes Bitcoin\'s genesis block referencing bank bailouts during the 2008 crisis.',
    source: 'BitcoinII Genesis Block',
    bc2: 'Two genesis blocks, fifteen years apart. Same message: governments fail, debt grows, trust erodes. Sound money endures.'
},
// ── PHILOSOPHY ──
{
    topic: 'philosophy', q: 'What is sound money?',
    a: '"Historically, people have taken up scarce commodities as money, if necessary taking up whatever is at hand, such as shells or stones. Each has a kernel of usefulness that helped bootstrap the process, but the monetary value ends up being much more than the functional value alone. Until now, no scarce commodity that can be traded over a communications channel without a trusted third party has been available."',
    source: 'Satoshi, forum Q&A',
    bc2: 'Bitcoin — and BC2 — are the first digitally scarce commodities tradeable without trust. Sound money for the internet age.'
},
{
    topic: 'philosophy', q: 'Why did Satoshi disappear?',
    a: 'Satoshi\'s last known email (April 23, 2011) to Gavin Andresen said: "I wish you wouldn\'t keep talking about me as a mysterious shadowy figure. The press just turns that into a pirate currency angle. Maybe instead make it about the open source project and give more credit to your dev contributors; it helps motivate them."',
    source: 'Satoshi to Gavin Andresen, Apr 23 2011',
    bc2: 'Satoshi\'s final words: stop the personality cult, focus on the code and the community. BC2 honors this by letting the protocol speak for itself.'
},
{
    topic: 'philosophy', q: 'What was Satoshi\'s view on Bitcoin as investment?',
    a: 'When Martti Malmi suggested marketing Bitcoin as an investment, Satoshi pushed back: "I\'m uncomfortable with explicitly saying \'consider it an investment.\' It\'s not a good idea to stir people up with \'get rich\' language. For now it\'s probably best to avoid that kind of promotion."',
    source: 'Satoshi to Martti Malmi, Dec 2009',
    bc2: 'BC2 prioritizes merchant adoption over speculation. It\'s electronic cash, not a financial instrument. Use it, don\'t just hold it.'
},
{
    topic: 'philosophy', q: 'What is the "trust problem" Satoshi identified?',
    a: '"A generation ago, multi-user time-sharing computer systems had a similar problem. Before strong encryption, users had to rely on password protection to secure their files, placing trust in the system administrator. Then strong encryption became available to the masses, and trust was no longer required. Data could be secured in a way that was physically impossible for others to access. It\'s time we had the same thing for money."',
    source: 'Satoshi, P2P Foundation, Feb 2009',
    bc2: 'Strong encryption replaced trust for data. Proof-of-work replaces trust for money. BC2 preserves this fundamental innovation.'
},
{
    topic: 'philosophy', q: 'What happened after Satoshi left?',
    a: 'Before disappearing, Satoshi transferred bitcoin.org domain to Martti Malmi, removed his name from the website, and told developers: "I\'ve moved on to other things. It\'s in good hands with Gavin and everyone." The network kept running. The blocks kept coming. The vision endured.',
    source: 'Satoshi to developers, Mar 2011',
    bc2: 'True decentralization means the creator can walk away and the system survives. BC2 was designed for this from day one.'
},
{
    topic: 'philosophy', q: 'What was Hal Finney\'s Bitcoin prediction?',
    a: 'On January 10, 2009 — one week after the genesis block — Hal Finney wrote to Satoshi: "Imagine that Bitcoin is successful and becomes the dominant payment system in use throughout the world. Then the total value of the currency should be equal to the total value of all the wealth in the world... each coin would be worth about $10 million."',
    source: 'Hal Finney to Satoshi, Jan 10 2009',
    bc2: 'Hal Finney ran the math one week into Bitcoin\'s existence and arrived at $10M per coin. He was thinking in decades while others thought in days.'
},
// ── COMMUNITY ──
{
    topic: 'community', q: 'Who was Bitcoin\'s first volunteer?',
    a: 'Martti Malmi (AKA Sirius) was Bitcoin\'s first significant volunteer. In May 2009, he emailed Satoshi offering to help with coding, testing, or documentation. Satoshi replied: "What we need most right now is website writing. My writing is not that great, I\'m a much better coder." Malmi wrote the original FAQ, set up the SourceForge site, and ran a 24/7 node.',
    source: 'Satoshi-Malmi correspondence, May 2009',
    bc2: 'Every project needs its first believer. Martti believed in Bitcoin when it had zero value. BC2 is building its community the same way — one contributor at a time.'
},
{
    topic: 'community', q: 'What was the first Bitcoin sale for USD?',
    a: 'On October 12, 2009, Martti Malmi sold 5,050 BTC to a buyer via PayPal for $5.02 — a price of roughly $0.001 per bitcoin. He told Satoshi about it, marking the first known exchange of bitcoin for fiat currency. Those 5,050 BTC would be worth hundreds of millions today.',
    source: 'Martti Malmi to Satoshi, Oct 2009',
    bc2: 'The first dollar exchanged for bitcoin established that digital scarcity has real-world value. BC2 follows the same bootstrapping path.'
},
{
    topic: 'community', q: 'Did Satoshi coin the term "cryptocurrency"?',
    a: 'No. Satoshi told Martti Malmi in June 2009: "Someone came up with the word cryptocurrency... maybe it\'s a word we should use when describing Bitcoin, do you like it?" The term was coined by others and adopted by Satoshi — he didn\'t create it.',
    source: 'Satoshi to Martti Malmi, Jun 2009',
    bc2: 'Even the terminology wasn\'t top-down. Bitcoin\'s language, like its protocol, emerged from the community.'
},
{
    topic: 'community', q: 'Did Satoshi take breaks from Bitcoin?',
    a: 'Yes. In July 2009, Satoshi told Malmi: "I needed a break after tokens of 18 months of uninterrupted coding. Hal is not around at the moment which is unfortunate." Even the creator of Bitcoin needed rest. He returned saying: "Good to be coding again."',
    source: 'Satoshi to Martti Malmi, Jul & Oct 2009',
    bc2: 'Open source projects need sustainable pace. Satoshi coded for 18 months straight before needing a break. The protocol survived his absence — as designed.'
},
{
    topic: 'community', q: 'What was Satoshi\'s relationship with Gavin Andresen?',
    a: 'As Satoshi prepared to leave, he increasingly praised Gavin Andresen\'s contributions. In May 2010, after a 6-week absence, he told Malmi: "Gavin is doing a fantastic job. His work on the test framework has been invaluable." He later handed lead development to Gavin — though he expressed concern when Gavin accepted a CIA presentation invitation.',
    source: 'Satoshi to Martti Malmi, May 2010 & Mar 2011',
    bc2: 'Satoshi planned his succession carefully. He didn\'t just disappear — he ensured capable hands would continue the work.'
}
];

/* ════════════════════════════════════════════
   FAQ ENGINE
   ════════════════════════════════════════════ */
var faqOutput, faqInput, faqIsTyping = false, faqActiveTopic = null;

function initFaq() {
    faqOutput = document.getElementById('faqOutput');
    faqInput = document.getElementById('faqInput');
    var topicsEl = document.getElementById('faqTopics');

    // Build topic buttons
    FAQ_TOPICS.forEach(function(t) {
        var btn = document.createElement('button');
        btn.className = 'faq-topic-btn';
        btn.setAttribute('data-topic', t.id);
        btn.textContent = t.icon + ' ' + t.label;
        btn.addEventListener('click', function() { faqSelectTopic(t.id); });
        topicsEl.appendChild(btn);
    });

    // Welcome message
    var w = document.createElement('div');
    w.className = 'faq-welcome';
    w.innerHTML =
        '<div class="title-art">SATOSHI\'S FAQ MACHINE  ·  BC2 v2.0\nWisdom from the whitepaper & beyond</div>' +
        'A curated knowledge base drawn from Satoshi Nakamoto\'s\n' +
        'writings — whitepaper, forum posts, emails, and mailing\n' +
        'list archives — applied to the BC2 network.\n\n' +
        '<span class="hint">' + FAQ_DB.length + ' entries across ' + FAQ_TOPICS.length + ' topics. Click a topic above or type a question.\n' +
        'Commands: help, topics, clear, about, random, all</span>';
    faqOutput.appendChild(w);

    // Input handler
    faqInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
            var val = faqInput.value.trim();
            if (!val) return;
            faqInput.value = '';
            faqHandleInput(val);
        }
    });
}

function faqSelectTopic(topicId) {
    if (faqIsTyping) return;
    // Light burn of current FAQ state
    var faqScroll = document.getElementById('faqOutput');
    if (faqScroll && faqScroll.children.length > 2) { burnOnFaqNav(faqScroll); }
    faqActiveTopic = topicId;
    document.querySelectorAll('.faq-topic-btn').forEach(function(btn) {
        btn.classList.toggle('active', btn.getAttribute('data-topic') === topicId);
    });
    var entries = FAQ_DB.filter(function(e) { return e.topic === topicId; });
    var meta = FAQ_TOPICS.find(function(t) { return t.id === topicId; });

    var div = document.createElement('div');
    div.className = 'faq-entry';
    var hdr = document.createElement('div');
    hdr.className = 'faq-system';
    hdr.innerHTML = '── <span class="cmd">' + meta.icon + ' ' + meta.label.toUpperCase() + '</span> ── ' + entries.length + ' entries ──';
    div.appendChild(hdr);

    entries.forEach(function(e) {
        var item = document.createElement('div');
        item.className = 'faq-topic-item';
        item.textContent = e.q;
        item.addEventListener('click', function() { faqShowAnswer(e); });
        div.appendChild(item);
    });

    faqOutput.appendChild(div);
    faqOutput.scrollTop = faqOutput.scrollHeight;
}

function faqShowAnswer(entry) {
    if (faqIsTyping) return;
    faqIsTyping = true;

    var div = document.createElement('div');
    div.className = 'faq-entry';

    var qEl = document.createElement('div');
    qEl.className = 'faq-entry-q';
    qEl.style.display = 'flex';
    qEl.style.alignItems = 'center';
    qEl.style.gap = '0.4rem';
    var qText = document.createElement('span');
    qText.textContent = 'Q: ' + entry.q;
    qText.style.flex = '1';
    var starBtn = createStarBtn('faq', entry.q);
    qEl.appendChild(qText);
    qEl.appendChild(starBtn);
    div.appendChild(qEl);

    var aEl = document.createElement('div');
    aEl.className = 'faq-entry-a';
    div.appendChild(aEl);

    var srcEl = document.createElement('div');
    srcEl.className = 'faq-entry-source';
    srcEl.textContent = '— ' + entry.source;
    srcEl.style.display = 'none';
    div.appendChild(srcEl);

    var bc2El = document.createElement('div');
    bc2El.className = 'faq-entry-bc2';
    bc2El.textContent = '\u27D0 BC2: ' + entry.bc2;
    bc2El.style.display = 'none';
    div.appendChild(bc2El);

    faqOutput.appendChild(div);
    faqOutput.scrollTop = faqOutput.scrollHeight;

    // Typewriter
    var text = entry.a;
    var i = 0;
    var cursor = document.createElement('span');
    cursor.className = 'faq-cursor';
    aEl.appendChild(cursor);

    function typeChar() {
        if (i < text.length) {
            cursor.remove();
            aEl.appendChild(document.createTextNode(text.charAt(i)));
            aEl.appendChild(cursor);
            i++;
            faqOutput.scrollTop = faqOutput.scrollHeight;
            setTimeout(typeChar, 12 + Math.random() * 8);
        } else {
            cursor.remove();
            srcEl.style.display = 'block';
            bc2El.style.display = 'block';
            faqIsTyping = false;
            faqOutput.scrollTop = faqOutput.scrollHeight;
        }
    }
    typeChar();
}

function faqSearch(query) {
    var q = query.toLowerCase();
    var words = q.split(/\s+/).filter(function(w) { return w.length > 2; });
    if (!words.length) return [];

    var scored = FAQ_DB.map(function(entry) {
        var score = 0;
        words.forEach(function(w) {
            if (entry.q.toLowerCase().indexOf(w) !== -1) score += 15;
            if (entry.a.toLowerCase().indexOf(w) !== -1) score += 5;
            if (entry.topic.toLowerCase().indexOf(w) !== -1) score += 10;
            if (entry.bc2 && entry.bc2.toLowerCase().indexOf(w) !== -1) score += 3;
        });
        return { entry: entry, score: score };
    }).filter(function(r) { return r.score > 0; });

    scored.sort(function(a, b) { return b.score - a.score; });
    return scored.slice(0, 8);
}

function faqHandleInput(val) {
    var cmd = val.toLowerCase().trim();

    // Echo input
    var echo = document.createElement('div');
    echo.className = 'faq-system';
    echo.innerHTML = '<span style="color:var(--amber);">ask_satoshi&gt;</span> ' + escHtml(val);
    faqOutput.appendChild(echo);

    if (cmd === 'help') {
        var h = document.createElement('div');
        h.className = 'faq-system';
        h.innerHTML = 'COMMANDS:\n  <span class="cmd">help</span>      — show this message\n  <span class="cmd">topics</span>    — list all topics\n  <span class="cmd">favorites</span> — view starred items\n  <span class="cmd">clear</span>     — clear screen\n  <span class="cmd">about</span>     — about this terminal\n  <span class="cmd">random</span>    — random entry\n  <span class="cmd">all</span>       — show all entries\n\nOr type any question to search ' + FAQ_DB.length + ' entries.';
        faqOutput.appendChild(h);
    } else if (cmd === 'favorites' || cmd === 'starred' || cmd === 'stars') {
        showFavorites(); return;
    } else if (cmd === 'clear') {
        faqOutput.innerHTML = '';
    } else if (cmd === 'topics') {
        var t = document.createElement('div');
        t.className = 'faq-system';
        var lines = 'AVAILABLE TOPICS:\n\n';
        FAQ_TOPICS.forEach(function(tp) {
            var count = FAQ_DB.filter(function(e) { return e.topic === tp.id; }).length;
            lines += '  ' + tp.icon + ' <span class="cmd">' + tp.label + '</span> — ' + count + ' entries\n';
        });
        t.innerHTML = lines;
        faqOutput.appendChild(t);
    } else if (cmd === 'about') {
        var a = document.createElement('div');
        a.className = 'faq-system';
        a.innerHTML = 'THE SATOSHI ARCHIVE  ·  BC2 v2.0\n\n' +
            '<span class="cmd">' + FAQ_DB.length + ' FAQ entries</span> across <span class="cmd">' + FAQ_TOPICS.length + ' topics</span>\n' +
            '<span class="cmd">' + EMAILS.length + ' emails</span> in the Satoshi correspondence archive\n' +
            'Full BTC Whitepaper + BC2 Whitepaper\n\n' +
            'Sources: Bitcoin Whitepaper, BitcoinTalk forum,\n' +
            'Cryptography Mailing List, Hal Finney correspondence,\n' +
            'Martti Malmi archive (mmalmi.github.io/satoshi)';
        faqOutput.appendChild(a);
    } else if (cmd === 'random') {
        var r = FAQ_DB[Math.floor(Math.random() * FAQ_DB.length)];
        faqShowAnswer(r);
    } else if (cmd === 'all') {
        FAQ_TOPICS.forEach(function(tp) {
            var entries = FAQ_DB.filter(function(e) { return e.topic === tp.id; });
            if (!entries.length) return;
            var hdr = document.createElement('div');
            hdr.className = 'faq-system';
            hdr.innerHTML = '\n── <span class="cmd">' + tp.icon + ' ' + tp.label.toUpperCase() + '</span> ──';
            faqOutput.appendChild(hdr);
            entries.forEach(function(e) {
                var item = document.createElement('div');
                item.className = 'faq-topic-item';
                item.textContent = e.q;
                item.addEventListener('click', function() { faqShowAnswer(e); });
                faqOutput.appendChild(item);
            });
        });
    } else {
        // Check if it matches a topic name
        var matchedTopic = FAQ_TOPICS.find(function(t) {
            return t.label.toLowerCase() === cmd || t.id === cmd;
        });
        if (matchedTopic) {
            faqSelectTopic(matchedTopic.id);
        } else {
            // Search
            var results = faqSearch(val);
            if (results.length) {
                var rd = document.createElement('div');
                rd.className = 'faq-entry';
                var rh = document.createElement('div');
                rh.className = 'faq-system';
                rh.innerHTML = '── SEARCH: ' + results.length + ' results for "<span class="cmd">' + escHtml(val) + '</span>" ──';
                rd.appendChild(rh);
                results.forEach(function(r) {
                    var item = document.createElement('div');
                    item.className = 'faq-search-match';
                    item.textContent = r.entry.q;
                    item.addEventListener('click', function() { faqShowAnswer(r.entry); });
                    rd.appendChild(item);
                });
                faqOutput.appendChild(rd);
            } else {
                var nf = document.createElement('div');
                nf.className = 'faq-system';
                nf.innerHTML = 'No results for "<span class="cmd">' + escHtml(val) + '</span>". Try different keywords or browse topics above.';
                faqOutput.appendChild(nf);
            }
        }
    }

    faqOutput.scrollTop = faqOutput.scrollHeight;
}

/* ════════════════════════════════════════════
   THEME SYSTEM
   ════════════════════════════════════════════ */
var _pc = '#66ff66'; // cached phosphor-bright color
function _updatePC() {
    _pc = getComputedStyle(document.documentElement).getPropertyValue('--phosphor-bright').trim() || '#66ff66';
}

function setTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    document.querySelectorAll('.theme-btn').forEach(function(b) { b.classList.remove('active'); });
    var map = { green: 0, amber: 1, dark: 2 };
    document.querySelectorAll('.theme-btn')[map[theme]].classList.add('active');
    try { localStorage.setItem('sat-archive-theme', theme); } catch(e) {}
    setTimeout(_updatePC, 20);
}

function loadTheme() {
    try {
        var t = localStorage.getItem('sat-archive-theme');
        if (t && (t === 'green' || t === 'amber' || t === 'dark')) { setTheme(t); }
    } catch(e) {}
}

/* ════════════════════════════════════════════
   FAVORITES / STAR SYSTEM
   ════════════════════════════════════════════ */
var favorites = { faq: [], email: [] };

function loadFavorites() {
    try {
        var raw = localStorage.getItem('sat-archive-favorites');
        if (raw) {
            var parsed = JSON.parse(raw);
            if (parsed.faq) favorites.faq = parsed.faq;
            if (parsed.email) favorites.email = parsed.email;
        }
    } catch(e) {}
    updateStarCount();
}

function saveFavorites() {
    try { localStorage.setItem('sat-archive-favorites', JSON.stringify(favorites)); } catch(e) {}
    updateStarCount();
}

function updateStarCount() {
    var el = document.getElementById('starCount');
    if (el) el.textContent = favorites.faq.length + favorites.email.length;
}

function isFaqStarred(q) { return favorites.faq.indexOf(q) !== -1; }
function isEmailStarred(id) { return favorites.email.indexOf(id) !== -1; }

function toggleFaqStar(q, btn) {
    var idx = favorites.faq.indexOf(q);
    if (idx === -1) { favorites.faq.push(q); } else { favorites.faq.splice(idx, 1); }
    saveFavorites();
    if (btn) btn.classList.toggle('starred', isFaqStarred(q));
}

function toggleEmailStar(id, btn) {
    var idx = favorites.email.indexOf(id);
    if (idx === -1) { favorites.email.push(id); } else { favorites.email.splice(idx, 1); }
    saveFavorites();
    if (btn) btn.classList.toggle('starred', isEmailStarred(id));
}

function createStarBtn(type, key) {
    var btn = document.createElement('button');
    btn.className = 'star-btn';
    var starred = (type === 'faq') ? isFaqStarred(key) : isEmailStarred(key);
    if (starred) btn.classList.add('starred');
    btn.textContent = '★';
    btn.title = starred ? 'Remove from favorites' : 'Add to favorites';
    btn.addEventListener('click', function(e) {
        e.stopPropagation();
        if (type === 'faq') { toggleFaqStar(key, btn); }
        else { toggleEmailStar(key, btn); }
        btn.title = btn.classList.contains('starred') ? 'Remove from favorites' : 'Add to favorites';
    });
    return btn;
}

function showFavorites() {
    var drawer = document.getElementById('favDrawer');
    if (drawer.classList.contains('open')) { closeFavDrawer(); return; }
    renderFavDrawer();
    drawer.classList.add('open');
}

function closeFavDrawer() {
    document.getElementById('favDrawer').classList.remove('open');
}

function renderFavDrawer() {
    var list = document.getElementById('favDrawerList');
    var empty = document.getElementById('favDrawerEmpty');
    var total = favorites.faq.length + favorites.email.length;
    list.innerHTML = '';

    if (total === 0) {
        empty.classList.add('visible');
        return;
    }
    empty.classList.remove('visible');

    // FAQ favorites
    if (favorites.faq.length) {
        var sec = document.createElement('div');
        sec.className = 'fav-drawer-section';
        sec.textContent = '> FAQ Entries (' + favorites.faq.length + ')';
        list.appendChild(sec);

        favorites.faq.forEach(function(q) {
            var entry = FAQ_DB.find(function(e) { return e.q === q; });
            if (!entry) return;
            var topic = FAQ_TOPICS.find(function(t) { return t.id === entry.topic; });
            var item = document.createElement('div');
            item.className = 'fav-drawer-item';

            var star = createStarBtn('faq', q);
            star.addEventListener('click', function() {
                setTimeout(renderFavDrawer, 50);
            });

            var textWrap = document.createElement('div');
            textWrap.className = 'fav-drawer-item-text';
            textWrap.innerHTML = escHtml(entry.q);
            var sub = document.createElement('div');
            sub.className = 'fav-drawer-item-sub';
            sub.textContent = topic ? topic.icon + ' ' + topic.label : entry.topic;
            textWrap.appendChild(sub);

            textWrap.addEventListener('click', function() {
                closeFavDrawer();
                switchTab('faq');
                faqShowAnswer(entry);
            });

            item.appendChild(star);
            item.appendChild(textWrap);
            list.appendChild(item);
        });
    }

    // Divider
    if (favorites.faq.length && favorites.email.length) {
        var div = document.createElement('div');
        div.className = 'fav-drawer-divider';
        list.appendChild(div);
    }

    // Email favorites
    if (favorites.email.length) {
        var sec2 = document.createElement('div');
        sec2.className = 'fav-drawer-section';
        sec2.textContent = '> Emails (' + favorites.email.length + ')';
        list.appendChild(sec2);

        favorites.email.forEach(function(id) {
            var email = EMAILS.find(function(e) { return e.id === id; });
            if (!email) return;
            var item = document.createElement('div');
            item.className = 'fav-drawer-item';

            var star = createStarBtn('email', id);
            star.addEventListener('click', function() {
                setTimeout(renderFavDrawer, 50);
            });

            var textWrap = document.createElement('div');
            textWrap.className = 'fav-drawer-item-text';
            textWrap.innerHTML = '#' + email.id + ' — ' + escHtml(email.subject);
            var sub = document.createElement('div');
            sub.className = 'fav-drawer-item-sub';
            sub.textContent = email.date + ' · ' + email.from.split('<')[0].trim();
            textWrap.appendChild(sub);

            textWrap.addEventListener('click', function() {
                closeFavDrawer();
                switchTab('emails');
                var idx = EMAILS.indexOf(email);
                if (idx !== -1) showEmail(idx);
            });

            item.appendChild(star);
            item.appendChild(textWrap);
            list.appendChild(item);
        });
    }
}

// Re-render drawer when stars are toggled (hook into save)
var _origSaveFavorites = saveFavorites;
saveFavorites = function() {
    _origSaveFavorites();
    if (document.getElementById('favDrawer').classList.contains('open')) {
        renderFavDrawer();
    }
};

/* ════════════════════════════════════════════
   PHOSPHOR BURN-IN ENGINE
   ════════════════════════════════════════════ */
var burnLayer, burnGhosts = [], BURN_MAX = 6;
var burnViewTimers = {}; // track how long each tab/content is viewed
var burnReady = false; // Don't burn until after boot+login

function initBurnIn() {
    burnLayer = document.getElementById('burnLayer');
}

function stampBurn(sourceEl, strong) {
    if (!burnLayer || !sourceEl || !burnReady) return;

    // Clone the visible content
    var ghost = document.createElement('div');
    ghost.className = 'burn-ghost' + (strong ? ' burn-strong' : '');

    // Clone just the active tab content area
    var clone = sourceEl.cloneNode(true);
    // Strip IDs to avoid conflicts
    clone.querySelectorAll('[id]').forEach(function(el) { el.removeAttribute('id'); });
    ghost.appendChild(clone);

    // Manage ghost count — remove oldest if at max
    if (burnGhosts.length >= BURN_MAX) {
        var oldest = burnGhosts.shift();
        if (oldest && oldest.parentNode) oldest.parentNode.removeChild(oldest);
    }

    burnLayer.appendChild(ghost);
    burnGhosts.push(ghost);

    // Auto-remove when animation ends
    ghost.addEventListener('animationend', function() {
        if (ghost.parentNode) ghost.parentNode.removeChild(ghost);
        var idx = burnGhosts.indexOf(ghost);
        if (idx > -1) burnGhosts.splice(idx, 1);
    });
}

function getActiveTabContent() {
    var active = document.querySelector('.tab-content.active');
    if (!active) return null;
    // Get the scroll area within the active tab
    var scroll = active.querySelector('.scroll-area');
    return scroll || active;
}

// Stamp burn on tab switch (captures outgoing tab content)
var _burnPrevTab = null;
function burnOnTabSwitch(newTab) {
    // Stamp the outgoing tab's content
    var outgoing = getActiveTabContent();
    if (outgoing && _burnPrevTab && _burnPrevTab !== newTab) {
        // Check if there's actually visible content
        var text = outgoing.textContent || '';
        if (text.trim().length > 20) {
            // Longer viewing = stronger burn
            var viewTime = burnViewTimers[_burnPrevTab] || 0;
            var strong = viewTime > 15000; // 15+ seconds = strong burn
            stampBurn(outgoing, strong);
        }
    }
    // Reset timer for new tab
    burnViewTimers[newTab] = 0;
    _burnPrevTab = newTab;
}

// Track viewing duration per tab
setInterval(function() {
    if (_burnPrevTab) {
        burnViewTimers[_burnPrevTab] = (burnViewTimers[_burnPrevTab] || 0) + 1000;
    }
}, 1000);

// Stamp burn on email navigation (captures outgoing email)
function burnOnEmailChange(scrollEl) {
    if (!scrollEl) return;
    var text = scrollEl.textContent || '';
    if (text.trim().length > 30) {
        stampBurn(scrollEl, false);
    }
}

// Stamp burn on FAQ answer display (light ghost of question list)
function burnOnFaqNav(scrollEl) {
    if (!scrollEl) return;
    var text = scrollEl.textContent || '';
    if (text.trim().length > 50) {
        stampBurn(scrollEl, false);
    }
}

/* ════════════════════════════════════════════
   FORUM POSTS DATA & RENDERER
   ════════════════════════════════════════════ */
var forumPosts = [
{date:'2009-02-11',src:'P2P Foundation',thread:'Bitcoin open source implementation of P2P currency',tag:'vision',
body:'I have developed a new open source P2P e-cash system called Bitcoin. It is completely decentralized, with no central server or trusted parties. Everything is based on crypto proof instead of trust. The root problem with conventional currency is all the trust that is required to make it work. The central bank must be trusted not to debase the currency, but the history of fiat currencies is full of breaches of that trust.'},
{date:'2009-02-18',src:'P2P Foundation',thread:'Bitcoin open source implementation of P2P currency',tag:'technical',
body:'You will not find a solution to political problems in cryptography. Yes, but we can win a major battle in the arms race and gain a new territory of freedom for several years. Governments are good at cutting off the heads of centrally controlled networks like Napster, but pure P2P networks like Gnutella and Tor seem to be holding their own.'},
{date:'2009-11-22',src:'BitcoinTalk',thread:'Welcome to the new Bitcoin forum!',tag:'vision',
body:'Welcome to the new Bitcoin forum! I have set up this forum so Bitcoin users can have a place to discuss.'},
{date:'2009-12-10',src:'BitcoinTalk',thread:'Re: Questions about Bitcoin',tag:'scaling',
body:'The existing Visa credit card network processes about 15 million Internet purchases per day worldwide. Bitcoin can already scale much larger than that with existing hardware for a fraction of the cost. It never really hits a scale ceiling.'},
{date:'2010-01-28',src:'BitcoinTalk',thread:'Re: A newb\'s test — buy a picture for $1?',tag:'technical',
body:'I very much wanted to find some way to include a short message, but the problem is, the whole world would be able to see the message. As much as you may keep reminding people that the message is completely non-private, it would be an accident waiting to happen.'},
{date:'2010-02-05',src:'BitcoinTalk',thread:'Proof-of-work difficulty increasing',tag:'mining',
body:'The proof-of-work difficulty is increasing. The last several blocks were generated in about 8 minutes each. Over the next few days the difficulty will adjust upward. This is good news — it means the Bitcoin network is growing.'},
{date:'2010-02-06',src:'BitcoinTalk',thread:'Re: How divisible are bitcoins',tag:'economics',
body:'Eventually at most only 21 million coins for 6.8 billion people in the world if it really gets big. But the value of individual coins would be proportionally larger. Each coin can be divided down to 8 decimal places.'},
{date:'2010-02-14',src:'BitcoinTalk',thread:'Re: What\'s with this odd generation?',tag:'economics',
body:'If you are sad about paying a fee, you could always turn the tables and run a node yourself and maybe someday rake in a 0.44 fee yourself. Transaction fees go to whoever successfully mines that block.'},
{date:'2010-02-21',src:'BitcoinTalk',thread:'Re: Current Bitcoin economic model is unsustainable',tag:'economics',
body:'Lost coins only make everyone else\'s coins worth slightly more. Think of it as a donation to everyone.'},
{date:'2010-04-28',src:'BitcoinTalk',thread:'Re: Bitcoin minting is thermodynamically perverse',tag:'mining',
body:'It is the same situation as gold and gold mining. The marginal cost of gold mining tends to stay near the price of gold. Gold mining is a waste, but that waste is far less than the utility of having gold available as a medium of exchange. The same case can be made for Bitcoin.'},
{date:'2010-05-18',src:'BitcoinTalk',thread:'Re: On IRC bootstrapping',tag:'technical',
body:'The nature of Bitcoin is such that once version 0.1 was released, the core design was set in stone for the rest of its lifetime. Because of that, I wanted to design it to support every possible transaction type I could think of.'},
{date:'2010-06-17',src:'BitcoinTalk',thread:'Re: Transactions and Scripts',tag:'technical',
body:'The design supports a tremendous variety of possible transaction types. Escrow transactions, bonded contracts, third party arbitration, multi-party signature — all without trusting anyone for anything. The script is actually a predicate. It is just an equation that evaluates to true or false.'},
{date:'2010-07-06',src:'BitcoinTalk',thread:'Bitcoin 0.3 released!',tag:'vision',
body:'Announcing version 0.3 of Bitcoin, the P2P cryptocurrency! Escape the arbitrary inflation risk of centrally managed currencies! Bitcoin\'s total circulation is limited to 21 million coins. Coins are gradually released to the nodes that contribute CPU power, with the amount halved every 4 years.'},
{date:'2010-07-09',src:'BitcoinTalk',thread:'Re: Scalability',tag:'scaling',
body:'The current system where every user is a network node is not the intended configuration for large scale. That would be like every Usenet user running their own NNTP server. The design supports letting users just be users. Those few nodes will be big server farms.'},
{date:'2010-07-10',src:'BitcoinTalk',thread:'Re: Bitcoin snack machine',tag:'scaling',
body:'I believe it will be possible for a payment processing company to provide as a service the rapid distribution of transactions with good-enough checking in something like 10 seconds or less. The network nodes only accept the first version of a transaction they receive.'},
{date:'2010-07-14',src:'BitcoinTalk',thread:'Re: Not a suggestion (SPV)',tag:'technical',
body:'It is possible to verify payments without running a full network node. A user only needs to keep a copy of the block headers of the longest proof-of-work chain. This is Simplified Payment Verification, as mentioned in the whitepaper.'},
{date:'2010-07-17',src:'BitcoinTalk',thread:'Re: Bitcoin 0.3.2 released',tag:'technical',
body:'SHA-256 is not going to be broken by Moore\'s law computational improvements in our lifetimes. If it is somehow found to be a problem, the system can transition to a stronger function.'},
{date:'2010-07-29',src:'BitcoinTalk',thread:'Re: Scalability and transaction rate',tag:'scaling',
body:'If you don\'t believe it or don\'t get it, I don\'t have the time to try to convince you, sorry.'},
{date:'2010-08-05',src:'BitcoinTalk',thread:'Re: Wiki page',tag:'vision',
body:'I do not claim to understand all of the ramifications of a system like this. There is so much that could be done if we could wrap our heads around it.'},
{date:'2010-08-07',src:'BitcoinTalk',thread:'Re: Flood attack 0.00000001 BC',tag:'technical',
body:'The design already has provisions for letting the fee float based on supply and demand. Bitcoin is designed to allow optional transaction fees that the sender may include.'},
{date:'2010-08-11',src:'BitcoinTalk',thread:'Re: Not a suggestion (privacy)',tag:'privacy',
body:'I am very intrigued by the possibility of applying zero-knowledge proofs, but it is an area that requires careful study. The system is designed so that transactions are public but the identities behind them can remain private.'},
{date:'2010-08-27',src:'BitcoinTalk',thread:'Re: Bitcoins are not money',tag:'economics',
body:'As a thought experiment, imagine there was a base metal as scarce as gold but with one special magical property: it can be transported over a communications channel. If somehow it acquired any value at all, then anyone wanting to transfer wealth over a long distance could buy some, transmit it, and have the recipient sell it.'},
{date:'2010-09-23',src:'BitcoinTalk',thread:'Re: Potential vulnerability: 51% attack',tag:'technical',
body:'The incentive may help encourage nodes to stay honest. If a greedy attacker is able to assemble more CPU power than all the honest nodes, he would have to choose between using it to defraud people or using it to generate new coins. He ought to find it more profitable to play by the rules.'},
{date:'2010-10-04',src:'BitcoinTalk',thread:'Re: Official Bitcoin web-page',tag:'vision',
body:'I would be surprised if 10 years from now we are not using electronic currency in some way, now that we know a way to do it that will not inevitably get dumbed down when the trusted third party gets cold feet.'},
{date:'2010-12-05',src:'BitcoinTalk',thread:'Re: Wikileaks and Bitcoin',tag:'farewell',
body:'It would have been nice to get this attention in any other context. WikiLeaks has kicked the hornet\'s nest, and the swarm is headed towards us.'},
{date:'2010-12-10',src:'BitcoinTalk',thread:'Re: Adding more detail to the alert system',tag:'technical',
body:'I keep a list of all unresolved bugs I have seen on the forum. In some cases, I am still thinking about the best design for the fix. This is not the kind of software where we can leave so many unresolved bugs that we need a tracker for them.'},
{date:'2010-12-11',src:'BitcoinTalk',thread:'[LAST POST] Re: Bitcoin 0.3.19',tag:'farewell',
body:'There is more work to do on DoS, but I am doing a quick build of what I have so far in case it is needed, before venturing into more complex ideas. Version 0.3.19 is now available.'},
];

var forumTags = [
{id:'all',label:'All'},
{id:'vision',label:'Vision'},
{id:'technical',label:'Technical'},
{id:'economics',label:'Economics'},
{id:'scaling',label:'Scaling'},
{id:'mining',label:'Mining'},
{id:'privacy',label:'Privacy'},
{id:'farewell',label:'Farewell'},
];

var activeForumTag = 'all';
function renderForum() {
    var fc = document.getElementById('forumFilters');
    var sc = document.getElementById('forumScroll');
    if (!fc || !sc) return;
    fc.innerHTML = '';
    forumTags.forEach(function(t) {
        var b = document.createElement('button');
        b.className = 'faq-topic-btn' + (activeForumTag === t.id ? ' active' : '');
        b.textContent = t.label;
        b.onclick = function() { activeForumTag = t.id; renderForum(); };
        fc.appendChild(b);
    });
    var filtered = activeForumTag === 'all' ? forumPosts : forumPosts.filter(function(p) { return p.tag === activeForumTag; });
    var html = '<div style="margin-bottom:12px;font-size:0.72rem;color:var(--phosphor-dim)">' + filtered.length + ' of ' + forumPosts.length + ' curated posts from Satoshi\'s 839+ forum messages (2009\u20132010)</div>';
    filtered.forEach(function(p) {
        html += '<div style="margin-bottom:16px;padding-bottom:14px;border-bottom:1px solid rgba(51,255,51,0.05)">';
        html += '<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px">';
        html += '<span style="font-size:0.75rem;color:var(--phosphor-bright)">' + p.thread + '</span>';
        html += '<span style="font-size:0.65rem;color:var(--phosphor-dim)">' + p.date + '</span></div>';
        html += '<div style="font-size:0.7rem;color:var(--phosphor-dim);margin-bottom:5px">' + p.src + ' \u00b7 #' + p.tag + '</div>';
        html += '<div style="font-size:0.82rem;color:var(--phosphor);line-height:1.45">' + p.body + '</div>';
        html += '</div>';
    });
    sc.innerHTML = html;
}

/* ════════════════════════════════════════════
   PRIVATE EMAILS DATA & INJECTOR
   ════════════════════════════════════════════ */
var privateEmails = [
{date:'2008-08-20',from:'Satoshi Nakamoto',to:'Adam Back',subject:'Hashcash citation',
body:'Satoshi reaches out to Adam Back, inventor of Hashcash, to confirm he has the citation correct. He mentions preparing a paper that expands proof-of-work into a complete electronic cash system and shares a pre-release draft. This is the earliest known outreach about what would become Bitcoin.'},
{date:'2008-08-21',from:'Adam Back',to:'Satoshi Nakamoto',subject:'Re: Hashcash citation',
body:'Back responds and suggests Satoshi look into Wei Dai\'s b-money proposal. He admits not reading the draft in detail. This referral proves consequential \u2014 Satoshi adds b-money as the first citation in the Bitcoin whitepaper.'},
{date:'2008-08-21',from:'Satoshi Nakamoto',to:'Adam Back',subject:'Re: Hashcash citation',
body:'Satoshi thanks Back for the b-money reference, admitting he was not previously aware of Wei Dai\'s work. "My ideas start from exactly that point," he writes, but notes his approach to achieving decentralized electronic cash differs significantly.'},
{date:'2008-08-22',from:'Adam Back',to:'Satoshi Nakamoto',subject:'Re: Hashcash citation',
body:'Back replies again, still not having read the draft, and suggests Ron Rivest\'s MicroMint paper from 1996. Back would not seriously examine Bitcoin until late 2012 \u2014 a fact he later reflected on with some regret.'},
{date:'2008-10-01',from:'Satoshi Nakamoto',to:'Adam Back',subject:'Bitcoin implementation',
body:'The final email to Back. Satoshi thanks him again and announces the first public implementation. He quotes an overview from Hal Finney from the Cryptography mailing list. Back does not reply and would not look at Bitcoin again for four years.'},
{date:'2008-11-19',from:'Hal Finney',to:'Satoshi Nakamoto',subject:'Re: Bitcoin P2P e-cash paper',
body:'After Satoshi announces on the Cryptography mailing list, Hal Finney responds with genuine interest. He speculates that if Bitcoin becomes the dominant payment system, each coin could eventually be worth ten million dollars. This is one of the earliest price projections ever made.'},
{date:'2009-01-10',from:'Satoshi Nakamoto',to:'Hal Finney',subject:'Bitcoin v0.1',
body:'Satoshi contacts Finney about the release of v0.1. Finney becomes the first person besides Satoshi to run Bitcoin. On January 12, Satoshi sends 10 BTC to Finney \u2014 the first ever Bitcoin transaction between two people.'},
{date:'2009-01-13',from:'Satoshi Nakamoto',to:'Dustin Trammell',subject:'Re: Bitcoin',
body:'Satoshi corresponds with early node operator Dustin Trammell, explaining the double-spending solution: the network timestamps transactions by hashing them into an ongoing chain of proof-of-work, forming a record that cannot be changed without redoing all the work.'},
{date:'2009-01-17',from:'Satoshi Nakamoto',to:'Dustin Trammell',subject:'Re: Bitcoin',
body:'Trammell asks about government interference. Satoshi explains that decentralization makes the network resistant to shutdown \u2014 there is no central server to target. Governments would have to target individual nodes.'},
{date:'2009-05-02',from:'Satoshi Nakamoto',to:'Martti Malmi',subject:'Re: Hello',
body:'Finnish CS student Martti Malmi offers to help after discovering Bitcoin. Satoshi welcomes him, noting candidly: "My writing is not that great, I\'m a much better coder." He asks Malmi to create the bitcoin.org website and offers to compile forum replies as FAQ material.'},
{date:'2009-05-24',from:'Satoshi Nakamoto',to:'Martti Malmi',subject:'Re: Website',
body:'Satoshi reviews Malmi\'s draft FAQ. He notes the password encryption feature will make the case that Bitcoin is more secure than banks: "We use strong encryption, while banks still let anyone who has your account info draw money from your account."'},
{date:'2009-12-14',from:'Satoshi Nakamoto',to:'Martti Malmi',subject:'Re: Development',
body:'Satoshi discusses sustainability and the need for more developers. He hints at wanting to step back eventually and let the community carry forward, but wants the codebase solid first.'},
{date:'2010-04-26',from:'Satoshi Nakamoto',to:'Martti Malmi',subject:'Re: First BTC sale!',
body:'Malmi reports selling 5,050 BTC for $5.02 via PayPal \u2014 roughly $0.001 per bitcoin. One of the first known fiat-to-Bitcoin transactions. Satoshi responds with measured encouragement about Bitcoin acquiring monetary value through market exchange.'},
{date:'2010-12-03',from:'Satoshi Nakamoto',to:'Martti Malmi',subject:'Re: Wikileaks',
body:'As WikiLeaks draws attention to Bitcoin, Satoshi expresses concern that premature government scrutiny could threaten the young project. He compares it to a seedling not yet strong enough to weather a storm.'},
{date:'2011-02-23',from:'Satoshi Nakamoto',to:'Martti Malmi',subject:'Re: Domains',
body:'One of Satoshi\'s final known communications. He discusses transferring the bitcoin.org domain and administrative matters. His messages are shorter, less frequent. He mentions having "moved on to other things."'},
{date:'2011-04-23',from:'Satoshi Nakamoto',to:'Mike Hearn',subject:'Re: Development plans',
body:'Possibly the last private communication. When asked about Bitcoin\'s future, Satoshi says he has moved on and the project is in good hands. He expresses confidence it has enough momentum to continue without him. He warns against any single person becoming a point of failure.'},
];

/* ════════════════════════════════════════════
   CYPHERPUNK LIBRARY DATA & RENDERER
   ════════════════════════════════════════════ */
var cypherpunkWorks = [
{id:'bmoney',year:1998,author:'Wei Dai',title:'b-money',
desc:'The theoretical framework for anonymous, distributed electronic cash',
sections:[
{h:'Overview',t:'Proposed in 1998 on the cypherpunks mailing list, b-money was a theoretical scheme for untraceable digital cash among pseudonymous participants. Wei Dai outlined two protocols: one requiring a synchronous broadcast channel, and a more practical version using servers to keep account balances.'},
{h:'Key Concepts',t:'Money creation through proof-of-work: participants create money by broadcasting the solution to a previously unsolved computational problem. The cost of computation determines the value created. Contracts and enforcement use escrow and reputation, with no central authority.'},
{h:'Influence on Bitcoin',t:'Satoshi cited b-money as the first reference in the whitepaper. In his email to Wei Dai, Satoshi noted his ideas "start from exactly that point." Bitcoin diverged in implementation \u2014 using a blockchain and proof-of-work consensus rather than Dai\'s proposed server model.'},
{h:'Historical Note',t:'Satoshi was not initially aware of b-money. Adam Back directed him to Dai\'s work in August 2008, after which Satoshi added the citation. Dai himself was not particularly interested when contacted, though he later expressed regret at not pursuing the concept further.'},
]},
{id:'hashcash',year:1997,author:'Adam Back',title:'Hashcash \u2014 A Denial of Service Counter-Measure',
desc:'The proof-of-work system that became Bitcoin\'s mining algorithm',
sections:[
{h:'Overview',t:'Invented by Adam Back in 1997 to combat email spam and denial-of-service attacks. The core idea: require the sender to perform computational work before sending. For legitimate senders this is trivial; for spammers sending millions of messages, the cost becomes prohibitive.'},
{h:'How It Works',t:'Find a value that, when hashed with the message header, produces a hash with a specified number of leading zero bits. Finding such a value requires brute-force trial-and-error, but verifying it requires only a single hash computation. This asymmetry \u2014 expensive to produce, cheap to verify \u2014 is the foundation of proof-of-work.'},
{h:'Influence on Bitcoin',t:'Bitcoin mining is essentially Hashcash applied to a distributed ledger. Miners find a nonce producing a block hash below a target. Difficulty adjusts every 2016 blocks. Satoshi\'s very first outreach was to Adam Back, asking to confirm his Hashcash citation.'},
{h:'Legacy',t:'While Hashcash never achieved widespread anti-spam adoption, its proof-of-work concept became the cornerstone of cryptocurrency mining. Adam Back went on to co-found Blockstream, one of the most prominent Bitcoin development companies.'},
]},
{id:'bitgold',year:2005,author:'Nick Szabo',title:'Bit Gold',
desc:'The closest conceptual predecessor to Bitcoin',
sections:[
{h:'Overview',t:'Proposed by computer scientist Nick Szabo in 2005 (concepts dating to 1998), Bit Gold is widely considered Bitcoin\'s most direct ancestor. Participants use computation to solve cryptographic puzzles, with solutions becoming digital property that can be transferred.'},
{h:'Key Innovation',t:'Physical gold derives value from costly mining labor. Bit Gold applies this digitally: computational work gives tokens unforgeable costliness. Unlike earlier e-cash, value is intrinsic to creation rather than backed by a trusted issuer.'},
{h:'Differences from Bitcoin',t:'Never implemented. Key unsolved problems: preventing double-spending without a central authority, and handling hardware improvements making puzzles easier. Bitcoin solved both with the blockchain and difficulty adjustment.'},
{h:'Mystery Connection',t:'Satoshi appears unaware of Bit Gold when designing Bitcoin \u2014 Wei Dai pointed him to Szabo\'s work. This is cited as evidence Satoshi is not Szabo, though some researchers dispute this. The conceptual similarities remain striking.'},
]},
{id:'digicash',year:1989,author:'David Chaum',title:'DigiCash / eCash',
desc:'The first attempt at anonymous digital currency',
sections:[
{h:'Overview',t:'David Chaum, sometimes called the godfather of digital currency, invented eCash in the late 1980s and founded DigiCash Inc. to commercialize it. eCash used blind signatures \u2014 a technique Chaum invented \u2014 to enable anonymous electronic payments.'},
{h:'How It Worked',t:'Users withdrew eCash tokens from their bank. The blind signature protocol let the bank verify a token was legitimate when spent, but could not link spending to the original withdrawal. This provided payer anonymity similar to physical cash while preventing counterfeiting.'},
{h:'Why It Failed',t:'DigiCash depended on banks to issue and redeem tokens \u2014 a trusted third party. When DigiCash filed for bankruptcy in 1998, the currency became worthless. Chaum\'s insistence on controlling the technology was cited as a factor, along with difficulty explaining privacy benefits to mainstream users.'},
{h:'Lesson for Bitcoin',t:'DigiCash demonstrated both demand for digital cash and the fatal flaw of centralization. Satoshi designed Bitcoin specifically to avoid this. The whitepaper opens by addressing the problem of trusted third parties, and decentralized consensus was a direct response to DigiCash\'s failure.'},
]},
{id:'rpow',year:2004,author:'Hal Finney',title:'RPOW \u2014 Reusable Proofs of Work',
desc:'Making proof-of-work tokens transferable',
sections:[
{h:'Overview',t:'Hal Finney, legendary cypherpunk and PGP developer, created RPOW in 2004. It built on Hashcash by making proof-of-work tokens reusable \u2014 exchangeable between users as digital tokens, not just one-time anti-spam stamps.'},
{h:'How It Worked',t:'Generate a Hashcash token and exchange it at the RPOW server for a signed token of equivalent value. This signed token could be transferred to others and redeemed for a new token. The server ran on IBM trusted hardware with publicly auditable code.'},
{h:'Limitations',t:'Still required a central server \u2014 the IBM hardware signing tokens. While the transparent design was innovative, it remained a single point of failure. Finney understood this limitation and saw RPOW as a stepping stone.'},
{h:'Connection to Bitcoin',t:'RPOW was a direct bridge between Hashcash and Bitcoin. When Satoshi announced Bitcoin, Finney immediately recognized its significance. He became the first to run the software, received the first transaction (10 BTC), and contributed substantially to early testing.'},
]},
{id:'micromint',year:1996,author:'Ron Rivest & Adi Shamir',title:'MicroMint',
desc:'Micropayments via hash collisions, from the creators of RSA',
sections:[
{h:'Overview',t:'Proposed in 1996 by Ron Rivest (the "R" in RSA) and Adi Shamir. Designed for micropayments \u2014 transactions where traditional fees would be prohibitive. The system used k-way hash collisions as digital coinage.'},
{h:'How It Worked',t:'A broker invests computation to find hash collisions \u2014 pairs of inputs producing the same output. These serve as coins: expensive to create, trivial to verify. Economics of scale favor a single large minter, intended to be a licensed broker.'},
{h:'Relevance to Bitcoin',t:'Adam Back recommended MicroMint to Satoshi in their August 2008 exchange. While Bitcoin uses partial pre-images rather than collisions, the principle of tokens computationally expensive to create but cheap to verify is shared.'},
]},
];

function renderCypherpunks() {
    var sc = document.getElementById('cypherpunkScroll');
    if (!sc) return;
    var html = '<div style="margin-bottom:16px"><div style="font-size:1rem;color:var(--phosphor-bright);margin-bottom:6px">\u25c8 The Cypherpunk Lineage</div>';
    html += '<div style="font-size:0.78rem;color:var(--phosphor-dim);line-height:1.4">Bitcoin did not emerge from a vacuum. These are the foundational works that Satoshi built upon \u2014 the intellectual genealogy of decentralized electronic cash.</div></div>';
    cypherpunkWorks.forEach(function(w) {
        html += '<div style="margin-bottom:20px;padding:12px;border:1px solid rgba(51,255,51,0.08);background:rgba(51,255,51,0.01)">';
        html += '<div style="display:flex;justify-content:space-between;align-items:baseline;margin-bottom:6px">';
        html += '<span style="font-size:0.95rem;color:var(--phosphor-bright)">' + w.title + '</span>';
        html += '<span style="font-size:0.7rem;color:var(--phosphor-dim)">' + w.year + '</span></div>';
        html += '<div style="font-size:0.75rem;color:var(--phosphor-dim);margin-bottom:8px">' + w.author + ' \u00b7 ' + w.desc + '</div>';
        w.sections.forEach(function(s) {
            html += '<div style="margin-bottom:8px"><div style="font-size:0.72rem;color:var(--phosphor-bright);margin-bottom:3px;letter-spacing:0.05em">\u2500 ' + s.h.toUpperCase() + '</div>';
            html += '<div style="font-size:0.8rem;color:var(--phosphor);line-height:1.45">' + s.t + '</div></div>';
        });
        html += '</div>';
    });
    sc.innerHTML = html;
}

function renderPrivateEmails() {
    var sc = document.getElementById('privateEmailScroll');
    if (!sc) return;
    var html = '<div style="margin-bottom:12px;font-size:0.72rem;color:var(--phosphor-dim)">' + privateEmails.length + ' private correspondences (2008\u20132011) \u2014 released during 2024 COPA trial and by early collaborators</div>';
    privateEmails.forEach(function(e) {
        var isSatoshi = e.from.indexOf('Satoshi') === 0;
        html += '<div style="margin-bottom:14px;padding-bottom:12px;border-bottom:1px solid rgba(51,255,51,0.05)">';
        html += '<div style="display:flex;justify-content:space-between;margin-bottom:3px">';
        html += '<span style="font-size:0.72rem;color:var(--phosphor-bright)">' + e.subject + '</span>';
        html += '<span style="font-size:0.65rem;color:var(--phosphor-dim)">' + e.date + '</span></div>';
        html += '<div style="font-size:0.68rem;color:var(--phosphor-dim);margin-bottom:5px">' + e.from + ' \u2192 ' + e.to + '</div>';
        html += '<div style="font-size:0.8rem;color:var(--phosphor);line-height:1.45;padding-left:8px;border-left:2px solid ' + (isSatoshi ? 'rgba(51,255,51,0.15)' : 'rgba(255,170,51,0.15)') + '">' + e.body + '</div>';
        html += '</div>';
    });
    sc.innerHTML = html;
}

/* ════════════════════════════════════════════
   LOGIN / ACCESS GATE
   ════════════════════════════════════════════ */
var loginHash = '';
var loginKey = '';  // Last 4 chars
var loginAttempts = 0;

async function generateSessionHash() {
    var seed = 'BC2-' + Date.now() + '-' + Math.random().toString(36).substring(2, 10) + '-SATOSHI';
    try {
        var encoder = new TextEncoder();
        var data = encoder.encode(seed);
        var hashBuffer = await crypto.subtle.digest('SHA-256', data);
        var hashArray = Array.from(new Uint8Array(hashBuffer));
        return hashArray.map(function(b) { return b.toString(16).padStart(2, '0'); }).join('');
    } catch(e) {
        // Fallback: simple hash-like hex string
        var h = 0x9e3779b9;
        for (var i = 0; i < seed.length; i++) { h = Math.imul(h ^ seed.charCodeAt(i), 0x5bd1e995); h ^= h >>> 15; }
        var hex = '';
        for (var j = 0; j < 64; j++) { h = Math.imul(h ^ (h >>> 16), 0x45d9f3b + j); hex += ((h >>> 0) % 16).toString(16); }
        return hex;
    }
}

async function initLogin(onSuccess) {
    var loginScreen = document.getElementById('loginScreen');
    var loginHashEl = document.getElementById('loginHash');
    var loginInput = document.getElementById('loginInput');
    var loginError = document.getElementById('loginError');

    // Check sessionStorage for existing valid session
    try {
        var session = sessionStorage.getItem('sat-archive-session');
        if (session) {
            var parsed = JSON.parse(session);
            // Valid for 24 hours
            if (parsed.ts && (Date.now() - parsed.ts) < 86400000) {
                loginScreen.style.display = 'none';
                onSuccess();
                return;
            }
        }
    } catch(e) {}

    // Generate hash
    loginHash = await generateSessionHash();
    loginKey = loginHash.slice(-4);

    // Display hash with last 4 highlighted
    var mainPart = loginHash.slice(0, -4);
    loginHashEl.innerHTML = mainPart + '<span class="login-hash-tail">' + loginKey + '</span>';

    loginScreen.style.display = 'flex';
    setTimeout(function() { loginInput.focus(); }, 100);

    loginInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
            var val = loginInput.value.toLowerCase().trim();
            loginAttempts++;

            if (val === loginKey) {
                // Success
                loginError.className = 'login-error login-success';
                loginError.textContent = '● ACCESS GRANTED';
                loginInput.disabled = true;

                // Save session
                try {
                    sessionStorage.setItem('sat-archive-session', JSON.stringify({ ts: Date.now(), h: loginHash.slice(0, 8) }));
                } catch(e) {}

                setTimeout(function() {
                    loginScreen.classList.add('fade-out');
                    setTimeout(function() {
                        loginScreen.style.display = 'none';
                        onSuccess();
                    }, 600);
                }, 800);

            } else {
                // Failed
                loginError.textContent = '● ACCESS DENIED — attempt ' + loginAttempts;
                loginError.classList.remove('shake');
                void loginError.offsetWidth; // reflow to retrigger
                loginError.classList.add('shake');
                loginInput.value = '';
                loginInput.focus();

                // After 5 fails, regenerate hash
                if (loginAttempts >= 5) {
                    loginAttempts = 0;
                    loginError.textContent = '● SESSION EXPIRED — new hash generated';
                    generateSessionHash().then(function(newHash) {
                        loginHash = newHash;
                        loginKey = loginHash.slice(-4);
                        var mp = loginHash.slice(0, -4);
                        loginHashEl.innerHTML = mp + '<span class="login-hash-tail">' + loginKey + '</span>';
                    });
                }
            }
        }
    });
}

/* ════════════════════════════════════════════
   CRT BOOT SEQUENCE
   ════════════════════════════════════════════ */
var BOOT_LINES = [
    { text: '', delay: 400 },
    { text: '<span class="boot-head">NakamotoBIOS (C) 2009 Satoshi Industries</span>', delay: 60 },
    { text: '<span class="boot-head">SHA-256 Proof-of-Work Terminal v2.0.09</span>', delay: 60 },
    { text: '', delay: 300 },
    { text: 'POST initializing...', delay: 80 },
    { text: 'CPU: 64-bit Hashcash Processing Unit @ variable difficulty', delay: 50 },
    { text: 'MEM: Testing extended memory... <span class="boot-val">21,000,000</span> coin slots <span class="boot-ok">[OK]</span>', delay: 70 },
    { text: 'CACHE: UTXO set validator................... <span class="boot-ok">[OK]</span>', delay: 50 },
    { text: 'EC-DSA: secp256k1 signature engine.......... <span class="boot-ok">[OK]</span>', delay: 50 },
    { text: 'MERKLE: Tree hash verification.............. <span class="boot-ok">[OK]</span>', delay: 50 },
    { text: 'RNG: /dev/urandom entropy pool.............. <span class="boot-ok">[OK]</span>', delay: 40 },
    { text: '', delay: 200 },
    { text: 'Scanning genesis block...', delay: 100 },
    { text: '<span class="boot-hash">000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f</span>', delay: 80 },
    { text: 'Coinbase: <span class="boot-val">"The Times 03/Jan/2009 Chancellor on brink of second bailout for banks"</span>', delay: 120 },
    { text: 'Block #0 timestamp: <span class="boot-val">2009-01-03 18:15:05 UTC</span>    <span class="boot-ok">[VERIFIED]</span>', delay: 80 },
    { text: '', delay: 200 },
    { text: 'Loading peer-to-peer network drivers...', delay: 80 },
    { text: 'P2P: Nakamoto consensus engine.............. <span class="boot-ok">[OK]</span>', delay: 50 },
    { text: 'NET: No trusted third party required........ <span class="boot-ok">[OK]</span>', delay: 50 },
    { text: 'DIFF: 2016-block retarget algorithm......... <span class="boot-ok">[OK]</span>', delay: 50 },
    { text: 'CHAIN: Longest proof-of-work rule........... <span class="boot-ok">[OK]</span>', delay: 40 },
    { text: '', delay: 200 },
    { text: 'Initializing BC2 sister chain module...', delay: 100 },
    { text: 'BC2 genesis: <span class="boot-val">Clean launch — difficulty 1 — no premine</span>', delay: 100 },
    { text: 'SHA-256: Bitcoin Core v29 hash engine....... <span class="boot-ok">[OK]</span>', delay: 50 },
    { text: 'POLICY: OP_RETURN standardness preserved..... <span class="boot-ok">[OK]</span>', delay: 50 },
    { text: 'SUPPLY: 21M cap inherited................... <span class="boot-ok">[OK]</span>', delay: 40 },
    { text: '', delay: 250 },
    { text: 'Mounting archives...', delay: 80 },
    { text: '  /sat/emails      — <span class="boot-val">40</span> messages  (Aug 2008 \u2014 Apr 2011)', delay: 45 },
    { text: '  /sat/faq         — <span class="boot-val">54</span> entries   (11 topics)', delay: 45 },
    { text: '  /sat/whitepaper  — <span class="boot-val">BTC</span>  9 pages (Oct 31, 2008)', delay: 45 },
    { text: '  /sat/bc2-wp      — <span class="boot-val">BC2</span> 10 sections', delay: 45 },
    { text: '', delay: 200 },
    { text: '<span class="boot-bar">████████████████████████████████████████████████</span>', delay: 30, fast: true },
    { text: '', delay: 150 },
    { text: 'All systems operational. Network integrity: <span class="boot-ok">VERIFIED</span>', delay: 80 },
    { text: '', delay: 100 },
    { text: '<span class="boot-dim">"It\'s in good hands."  — Satoshi, March 2011</span>', delay: 200 },
    { text: '', delay: 400 },
    { text: '<span class="boot-warn">Press any key or wait to continue...</span>', delay: 0, wait: true }
];

function runBootSequence(callback) {
    var bootScreen = document.getElementById('bootScreen');
    var bootText = document.getElementById('bootText');
    var bootCursor = document.getElementById('bootCursor');
    var lineIdx = 0;
    var aborted = false;

    function skipBoot() {
        if (aborted) return;
        aborted = true;
        document.removeEventListener('keydown', skipBoot);
        document.removeEventListener('click', skipBoot);
        finishBoot();
    }

    function finishBoot() {
        bootCursor.style.display = 'none';
        bootScreen.classList.add('fade-out');
        setTimeout(function() {
            bootScreen.style.display = 'none';
            callback();
        }, 800);
    }

    function renderLine() {
        if (aborted) return;
        if (lineIdx >= BOOT_LINES.length) { finishBoot(); return; }

        var line = BOOT_LINES[lineIdx];
        lineIdx++;

        if (line.wait) {
            bootText.innerHTML += line.text + '\n';
            // Auto-continue after 2.5s or on keypress
            var waitTimer = setTimeout(function() {
                if (!aborted) { aborted = true; finishBoot(); }
            }, 2500);
            var onKey = function() {
                clearTimeout(waitTimer);
                document.removeEventListener('keydown', onKey);
                document.removeEventListener('click', onKey);
                if (!aborted) { aborted = true; finishBoot(); }
            };
            document.addEventListener('keydown', onKey);
            document.addEventListener('click', onKey);
            return;
        }

        // Progress bar gets special fast character-by-character rendering
        if (line.fast) {
            var raw = line.text.replace(/<[^>]+>/g, '');
            var prefix = line.text.substring(0, line.text.indexOf(raw.charAt(0)));
            var suffix = line.text.substring(line.text.lastIndexOf('>') + 1) || '';
            var barSpan = document.createElement('span');
            barSpan.innerHTML = prefix;
            bootText.appendChild(barSpan);
            var ci = 0;
            var barTimer = setInterval(function() {
                if (aborted) { clearInterval(barTimer); return; }
                if (ci < raw.length) {
                    barSpan.innerHTML = prefix + raw.substring(0, ci + 1);
                    ci++;
                } else {
                    clearInterval(barTimer);
                    bootText.innerHTML += '\n';
                    setTimeout(renderLine, line.delay);
                }
            }, 18);
            return;
        }

        bootText.innerHTML += line.text + '\n';
        bootText.parentElement.scrollTop = bootText.parentElement.scrollHeight;

        setTimeout(renderLine, line.delay);
    }

    // Allow skip during boot with any keypress or click
    document.addEventListener('keydown', skipBoot);
    document.addEventListener('click', skipBoot);

    // Small initial black screen delay to simulate power-on
    setTimeout(renderLine, 600);
}

/* ════════════════════════════════════════════
   INIT
   ════════════════════════════════════════════ */
window.addEventListener('DOMContentLoaded', function() {
/* ════════════════════════════════════════════
   DESKTOP ENVIRONMENT
   ════════════════════════════════════════════ */
var desktopApps = [
    { id: 'mines',    name: 'Minesweeper',    glyph: '[*]' },
    { id: 'breakout', name: 'Breakout',       glyph: '|o|' },
    { id: 'tetris',   name: 'Tetris',         glyph: '[T]' },
    { id: 'invaders', name: 'Invaders',       glyph: '/V\\' },
    { id: 'asteroids',name: 'Asteroids',      glyph: '(o)' },
    { id: 'rogue',    name: 'Dungeon',        glyph: ' @ ' },
    { id: 'sopwith',  name: 'Sopwith',        glyph: '-=>' },
    { id: 'golf',     name: 'Mini Golf',      glyph: ' o.' },
    { id: 'td',       name: 'Tower Def',      glyph: '[T]' },
    { id: 'sokoban',  name: 'Sokoban',        glyph: '[]>' },
    { id: 'chess',    name: 'Chess',          glyph: '+K+' },
];
var openWindows = {};
var winZCounter = 61;
var dragState = null;
var _gameKeys = {};

// Single delegated keyboard handler for ALL games (prevents listener leaks)
document.addEventListener('keydown', function(e) {
    _gameKeys[e.key] = true;
    var focused = null;
    Object.keys(openWindows).forEach(function(id) {
        if (openWindows[id].classList.contains('focused')) focused = id;
    });
    if (focused && openWindows[focused]._onKey) openWindows[focused]._onKey(e);
});
document.addEventListener('keyup', function(e) {
    _gameKeys[e.key] = false;
});

function initDesktop() {
    var grid = document.getElementById('desktopGrid');
    if (!grid || grid.children.length > 0) return;
    desktopApps.forEach(function(app) {
        var icon = document.createElement('div');
        icon.className = 'desk-icon';
        icon.innerHTML = '<div class="desk-icon-glyph">' + app.glyph + '</div><div class="desk-icon-label">' + app.name + '</div>';
        icon.onclick = function() { openApp(app.id, app.name); };
        grid.appendChild(icon);
    });
    updateTaskbarClock();
    setInterval(updateTaskbarClock, 30000);
}

function updateTaskbarClock() {
    var el = document.getElementById('taskbarClock');
    if (!el) return;
    var d = new Date();
    el.textContent = String(d.getHours()).padStart(2,'0') + ':' + String(d.getMinutes()).padStart(2,'0');
}

function openApp(appId, title) {
    if (openWindows[appId]) { focusWindow(appId); return; }
    var container = document.getElementById('desktopWindows');
    var env = document.getElementById('desktopEnv');
    var ew = env.offsetWidth, eh = env.offsetHeight;
    var sizes = { mines:[280,360], breakout:[320,400], tetris:[260,420], invaders:[310,400], asteroids:[340,380], rogue:[360,380], sopwith:[350,320], golf:[340,380], td:[360,400], sokoban:[300,360], chess:[330,380] };
    var sz = sizes[appId] || [300,300];
    var w = Math.min(sz[0], ew - 20), h = Math.min(sz[1], eh - 40);
    var x = Math.max(10, Math.floor((ew - w) / 2) + (Object.keys(openWindows).length * 25) % 80);
    var y = Math.max(5, Math.floor((eh - h - 24) / 2) + (Object.keys(openWindows).length * 18) % 50);
    var win = document.createElement('div');
    win.className = 'app-window focused';
    win.id = 'win-' + appId;
    win.style.cssText = 'left:'+x+'px;top:'+y+'px;width:'+w+'px;height:'+h+'px;z-index:'+(++winZCounter);
    win.innerHTML = '<div class="win-titlebar"><span class="win-title">'+title+'</span><button class="win-close">x</button></div><div class="win-body" id="winbody-'+appId+'"></div>';
    win.querySelector('.win-close').addEventListener('click', function(e) { e.stopPropagation(); closeApp(appId); });
    win.onmousedown = function() { focusWindow(appId); };
    container.appendChild(win);
    openWindows[appId] = win;
    Object.keys(openWindows).forEach(function(k) { if (k !== appId) openWindows[k].classList.remove('focused'); });
    var tb = win.querySelector('.win-titlebar');
    tb.addEventListener('mousedown', function(e) {
        if (e.target.closest('.win-close')) return;
        e.preventDefault(); focusWindow(appId);
        var wr = win.getBoundingClientRect();
        dragState = { win: win, ox: e.clientX - wr.left, oy: e.clientY - wr.top };
    });
    var body = document.getElementById('winbody-' + appId);
    if (appId === 'mines') initMines(body);
    else if (appId === 'breakout') initBreakout(body, w, h - 28);
    else if (appId === 'tetris') initTetris(body, w, h - 28);
    else if (appId === 'invaders') initInvaders(body, w, h - 28);
    else if (appId === 'asteroids') initAsteroids(body, w, h - 28);
    else if (appId === 'rogue') initRogue(body, w, h - 28);
    else if (appId === 'sopwith') initSopwith(body, w, h - 28);
    else if (appId === 'golf') initGolf(body, w, h - 28);
    else if (appId === 'td') initTD(body, w, h - 28);
    else if (appId === 'sokoban') initSokoban(body, w, h - 28);
    else if (appId === 'chess') initChess(body, w, h - 28);
}

function closeApp(appId) {
    var win = openWindows[appId];
    if (!win) return;
    // Kill game loops immediately
    if (win._raf) cancelAnimationFrame(win._raf);
    if (win._interval) clearInterval(win._interval);
    if (win._interval2) clearInterval(win._interval2);
    win._onKey = null;
    delete openWindows[appId];

    // Create burn ghost from canvas content
    try {
        var canvas = win.querySelector('canvas');
        var container = document.getElementById('desktopWindows');
        if (canvas && container) {
            var ghost = document.createElement('div');
            ghost.className = 'win-burn-ghost';
            ghost.style.cssText = 'left:'+win.style.left+';top:'+win.style.top+';width:'+win.offsetWidth+'px;height:'+win.offsetHeight+'px;';
            var img = document.createElement('img');
            img.src = canvas.toDataURL();
            img.style.cssText = 'width:100%;height:100%;object-fit:contain;opacity:inherit;';
            ghost.appendChild(img);
            container.appendChild(ghost);
            ghost.addEventListener('animationend', function() { ghost.remove(); });
        }
    } catch(e) {}

    // Play close animation, then remove
    win.classList.add('win-closing');
    win.addEventListener('animationend', function() { win.remove(); });
    // Fallback removal
    setTimeout(function() { if (win.parentNode) win.remove(); }, 400);
}

function focusWindow(appId) {
    var win = openWindows[appId];
    if (!win) return;
    win.style.zIndex = ++winZCounter;
    Object.keys(openWindows).forEach(function(k) { openWindows[k].classList.toggle('focused', k === appId); });
}

document.addEventListener('mousemove', function(e) {
    if (!dragState) return;
    var pr = dragState.win.parentElement.getBoundingClientRect();
    dragState.win.style.left = (e.clientX - pr.left - dragState.ox) + 'px';
    dragState.win.style.top = (e.clientY - pr.top - dragState.oy) + 'px';
});
document.addEventListener('mouseup', function() { dragState = null; });

/* ════════════════════════════════════════════
   MINESWEEPER
   ════════════════════════════════════════════ */
function initMines(body) {
    var win=body.closest('.app-window');
    var ROWS=9,COLS=9,MC=10;
    var grid,rev,flag,mines,over,won,first,fc,st,ti;
    body.innerHTML='<div class="mines-wrap"><div class="mines-hud"><span id="mF">F:'+MC+'</span><span id="mT">0:00</span><span id="mS">Ready</span></div><div class="mines-grid" id="mG" style="grid-template-columns:repeat('+COLS+',22px)"></div><div class="mines-msg" id="mM">Left: reveal | Right: flag | R: new</div></div>';
    function ng(){grid=[];rev=[];flag=[];mines=[];over=false;won=false;first=true;fc=0;clearInterval(ti);st=0;
    for(var r=0;r<ROWS;r++){grid[r]=[];rev[r]=[];flag[r]=[];for(var c=0;c<COLS;c++){grid[r][c]=0;rev[r][c]=false;flag[r][c]=false;}}
    document.getElementById('mF').textContent='F:'+MC;document.getElementById('mT').textContent='0:00';document.getElementById('mS').textContent='Ready';document.getElementById('mM').textContent='Left: reveal | Right: flag | R: new';rn();}
    function stt(){st=Date.now();ti=setInterval(function(){if(over){clearInterval(ti);return;}var s=Math.floor((Date.now()-st)/1000);document.getElementById('mT').textContent=Math.floor(s/60)+':'+String(s%60).padStart(2,'0');},500);}
    function pm(sr,sc){var p=0;while(p<MC){var r=Math.floor(Math.random()*ROWS),c=Math.floor(Math.random()*COLS);if(grid[r][c]===-1||(Math.abs(r-sr)<=1&&Math.abs(c-sc)<=1))continue;grid[r][c]=-1;mines.push({r:r,c:c});p++;}
    for(var r=0;r<ROWS;r++)for(var c=0;c<COLS;c++){if(grid[r][c]===-1)continue;var n=0;for(var dr=-1;dr<=1;dr++)for(var dc=-1;dc<=1;dc++){var nr=r+dr,nc=c+dc;if(nr>=0&&nr<ROWS&&nc>=0&&nc<COLS&&grid[nr][nc]===-1)n++;}grid[r][c]=n;}}
    function rv(r,c){if(r<0||r>=ROWS||c<0||c>=COLS||rev[r][c]||flag[r][c])return;rev[r][c]=true;if(grid[r][c]===0)for(var dr=-1;dr<=1;dr++)for(var dc=-1;dc<=1;dc++)rv(r+dr,c+dc);}
    function cw(){var u=0;for(var r=0;r<ROWS;r++)for(var c=0;c<COLS;c++)if(!rev[r][c])u++;return u===MC;}
    function ch(r,c){if(!rev[r][c]||grid[r][c]<=0)return;var af=0;for(var dr=-1;dr<=1;dr++)for(var dc=-1;dc<=1;dc++){var nr=r+dr,nc=c+dc;if(nr>=0&&nr<ROWS&&nc>=0&&nc<COLS&&flag[nr][nc])af++;}
    if(af===grid[r][c]){for(var dr=-1;dr<=1;dr++)for(var dc=-1;dc<=1;dc++){var nr=r+dr,nc=c+dc;if(nr>=0&&nr<ROWS&&nc>=0&&nc<COLS&&!flag[nr][nc]&&!rev[nr][nc]){if(grid[nr][nc]===-1){dl(nr,nc);return;}rv(nr,nc);}}rn();if(cw())dw();}}
    function dl(r,c){over=true;rev[r][c]=true;mines.forEach(function(m){if(!flag[m.r][m.c])rev[m.r][m.c]=true;});rn();
    var cells=document.getElementById('mG').children;for(var rr=0;rr<ROWS;rr++)for(var cc=0;cc<COLS;cc++){if(flag[rr][cc]&&grid[rr][cc]!==-1){cells[rr*COLS+cc].textContent='X';cells[rr*COLS+cc].style.color='#ff4444';}}
    document.getElementById('mS').textContent='BOOM!';document.getElementById('mM').textContent='Game over \u2014 R to restart';}
    function dw(){over=true;won=true;var s=Math.floor((Date.now()-st)/1000);document.getElementById('mS').textContent='WIN!';document.getElementById('mM').textContent='Cleared in '+Math.floor(s/60)+':'+String(s%60).padStart(2,'0')+' \u2014 R to play';
    for(var r=0;r<ROWS;r++)for(var c=0;c<COLS;c++)if(!rev[r][c])flag[r][c]=true;rn();}
    function rn(){var el=document.getElementById('mG');el.innerHTML='';for(var r=0;r<ROWS;r++)for(var c=0;c<COLS;c++){var ce=document.createElement('div');ce.className='mines-cell';
    if(rev[r][c]){ce.classList.add('revealed');if(grid[r][c]===-1){ce.textContent='*';ce.classList.add('boom');}else if(grid[r][c]>0){ce.textContent=grid[r][c];ce.classList.add('n'+Math.min(grid[r][c],6));}}
    else if(flag[r][c]){ce.textContent='F';ce.classList.add('flagged');}else ce.textContent='\u00b7';
    (function(r2,c2){ce.addEventListener('click',function(){hc(r2,c2);});ce.addEventListener('contextmenu',function(e){e.preventDefault();hf(r2,c2);});ce.addEventListener('dblclick',function(e){e.preventDefault();ch(r2,c2);});})(r,c);el.appendChild(ce);}}
    function hc(r,c){if(over||flag[r][c])return;if(rev[r][c]){ch(r,c);return;}if(first){pm(r,c);first=false;stt();}if(grid[r][c]===-1){dl(r,c);return;}rv(r,c);rn();if(cw())dw();}
    function hf(r,c){if(over||rev[r][c])return;flag[r][c]=!flag[r][c];fc+=flag[r][c]?1:-1;document.getElementById('mF').textContent='F:'+(MC-fc);rn();}
    win._onKey=function(e){if(e.key==='r'||e.key==='R')ng();};
    ng();
}

/* ════════════════════════════════════════════
   BREAKOUT
   ════════════════════════════════════════════ */
function initBreakout(body, bw, bh) {
    var cw=Math.min(bw-16,300),ch=Math.min(bh-56,320);
    body.innerHTML='<div class="breakout-wrap"><div class="breakout-hud"><span id="brS">0</span><span id="brL">Lv 1</span><span id="brV">x3</span></div><canvas class="breakout-canvas" id="brC" width="'+cw+'" height="'+ch+'"></canvas><div class="breakout-msg" id="brM">Space / Click to launch</div></div>';
    var cv=document.getElementById('brC'),cx=cv.getContext('2d');
    var pw=50,ph=8,px,br=4,bx,by,bdx,bdy,bs,bkR,bkC=Math.floor((cw-16)/30),bkW=Math.floor((cw-16)/bkC),bkH=11,bkP=2,bkT=26,bkL=8;
    var bk,sc,lv,lf,lch,run,cmb,keys=_gameKeys,mx=null,win=body.closest('.app-window');
    var cols=[['#ff4444','#ff6633','#F7931A','#ffcc33','#66ff66','#33ccff','#cc66ff']];
    function rb(){bx=cw/2;by=ch-28;var a=(-0.4-Math.random()*0.4)*Math.PI;bdx=Math.cos(a)*bs;bdy=Math.sin(a)*bs;lch=false;cmb=0;}
    function mb(){bk=[];var tot=0;bkR=Math.min(3+lv,7);for(var r=0;r<bkR;r++){bk[r]=[];for(var c=0;c<bkC;c++){var hp=r<2&&lv>2?2:1;bk[r][c]={a:true,hp:hp,mhp:hp};tot++;}}return tot;}
    function ng(){sc=0;lv=1;lf=3;run=true;bs=2.8;pw=50;px=(cw-pw)/2;ub();document.getElementById('brM').textContent='Space / Click to launch';var t=mb();rb();dr();}
    function nl(){lv++;bs=Math.min(5,2.8+(lv-1)*0.3);pw=Math.max(30,50-(lv-1)*3);ub();document.getElementById('brM').textContent='Level '+lv;mb();rb();}
    function ub(){document.getElementById('brS').textContent=sc;document.getElementById('brL').textContent='Lv '+lv;document.getElementById('brV').textContent='x'+lf;}
    function dr(){cx.fillStyle='rgba(0,0,0,0.92)';cx.fillRect(0,0,cw,ch);
    for(var r=0;r<bkR;r++)for(var c=0;c<bkC;c++){var b=bk[r][c];if(!b.a)continue;var x=bkL+c*bkW,y=bkT+r*(bkH+bkP);
    cx.fillStyle=b.mhp>1&&b.hp>1?'#888':cols[0][r%7];cx.shadowColor=cx.fillStyle;cx.shadowBlur=3;cx.fillRect(x+1,y,bkW-bkP-2,bkH);cx.fillStyle='rgba(255,255,255,0.12)';cx.fillRect(x+1,y,bkW-bkP-2,1);cx.shadowBlur=0;}
    var pc=_pc;
    cx.fillStyle=pc;cx.shadowColor=pc;cx.shadowBlur=5;cx.fillRect(px,ch-14,pw,ph);cx.shadowBlur=0;
    cx.beginPath();cx.arc(bx,by,br,0,Math.PI*2);cx.fillStyle='#fff';cx.shadowColor='#fff';cx.shadowBlur=8;cx.fill();cx.shadowBlur=0;}
    function tk(){if(!run||!openWindows['breakout'])return;
    if(keys['ArrowLeft']||keys['a'])px=Math.max(0,px-5);if(keys['ArrowRight']||keys['d'])px=Math.min(cw-pw,px+5);
    if(mx!==null)px=Math.max(0,Math.min(cw-pw,mx-pw/2));
    if(!lch){bx=px+pw/2;by=ch-22;dr();win._raf=requestAnimationFrame(tk);return;}
    bx+=bdx;by+=bdy;if(bx-br<0){bx=br;bdx=Math.abs(bdx);}if(bx+br>cw){bx=cw-br;bdx=-Math.abs(bdx);}if(by-br<0){by=br;bdy=Math.abs(bdy);}
    if(bdy>0&&by+br>=ch-14&&by+br<=ch-4&&bx>=px-2&&bx<=px+pw+2){var h=(bx-px)/pw,a=(h-0.5)*Math.PI*0.7-Math.PI/2,sp=Math.sqrt(bdx*bdx+bdy*bdy);bdx=Math.cos(a)*sp;bdy=Math.sin(a)*sp;if(bdy>-1)bdy=-1;by=ch-14-br;cmb=0;}
    if(by-br>ch){lf--;ub();if(lf<=0){run=false;document.getElementById('brM').textContent='Game Over! Score:'+sc+' \u2014 R';dr();return;}rb();document.getElementById('brM').textContent='Launch! ('+lf+' left)';}
    var hit=false,rem=0;for(var r=0;r<bkR;r++)for(var c=0;c<bkC;c++){var b=bk[r][c];if(!b.a){continue;}rem++;var x=bkL+c*bkW,y=bkT+r*(bkH+bkP);
    if(!hit&&bx+br>x&&bx-br<x+bkW-bkP&&by+br>y&&by-br<y+bkH){b.hp--;if(b.hp<=0){b.a=false;cmb++;sc+=(10+cmb*2)*lv;rem--;}
    var ol=bx+br-x,or2=x+bkW-bkP-(bx-br),ot=by+br-y,ob=y+bkH-(by-br);var mn=Math.min(ol,or2,ot,ob);if(mn===ot||mn===ob)bdy=-bdy;else bdx=-bdx;ub();hit=true;}}
    if(rem<=0)nl();dr();win._raf=requestAnimationFrame(tk);}
    cv.addEventListener('mousemove',function(e){mx=e.clientX-cv.getBoundingClientRect().left;});
    cv.addEventListener('mouseleave',function(){mx=null;});
    cv.addEventListener('click',function(){if(!lch&&run){lch=true;document.getElementById('brM').textContent='';}});
    win._onKey=function(e){if(e.key===' '&&!lch&&run){lch=true;document.getElementById('brM').textContent='';e.preventDefault();}if(e.key==='r'||e.key==='R'){ng();win._raf=requestAnimationFrame(tk);}if(['ArrowLeft','ArrowRight',' '].indexOf(e.key)!==-1)e.preventDefault();};
    ng();win._raf=requestAnimationFrame(tk);
}

/* ════════════════════════════════════════════
   TETRIS
   ════════════════════════════════════════════ */
function initTetris(body, bw, bh) {
    var COLS=10,ROWS=20,CELL=Math.min(Math.floor((bw-80)/COLS),Math.floor((bh-70)/ROWS),16);
    var cw=COLS*CELL,ch=ROWS*CELL;
    body.innerHTML='<div style="display:flex;height:100%;padding:6px;gap:8px;font-family:VT323,monospace"><div style="display:flex;flex-direction:column;align-items:center"><canvas id="tetC" width="'+cw+'" height="'+ch+'" style="border:1px solid rgba(51,255,51,0.15);background:rgba(0,0,0,0.4)"></canvas><div id="tetM" style="font-size:0.78rem;color:var(--phosphor);margin-top:4px;text-align:center">Arrow keys to play</div></div><div style="display:flex;flex-direction:column;gap:6px;min-width:55px"><div style="font-size:0.65rem;color:var(--phosphor-dim)">NEXT</div><canvas id="tetN" width="64" height="64" style="border:1px solid rgba(51,255,51,0.08);background:rgba(0,0,0,0.3)"></canvas><div style="font-size:0.65rem;color:var(--phosphor-dim);margin-top:6px">SCORE</div><div id="tetS" style="font-size:0.9rem;color:var(--phosphor-bright)">0</div><div style="font-size:0.65rem;color:var(--phosphor-dim)">LEVEL</div><div id="tetLv" style="font-size:0.9rem;color:var(--phosphor-bright)">1</div><div style="font-size:0.65rem;color:var(--phosphor-dim)">LINES</div><div id="tetLn" style="font-size:0.9rem;color:var(--phosphor-bright)">0</div></div></div>';
    var cv=document.getElementById('tetC'),cx=cv.getContext('2d');
    var nv=document.getElementById('tetN'),nx=nv.getContext('2d');
    var win=body.closest('.app-window');
    var SHAPES=[
        [[1,1,1,1]],                          // I
        [[1,1],[1,1]],                         // O
        [[0,1,0],[1,1,1]],                     // T
        [[1,0,0],[1,1,1]],                     // J
        [[0,0,1],[1,1,1]],                     // L
        [[0,1,1],[1,1,0]],                     // S
        [[1,1,0],[0,1,1]]                      // Z
    ];
    var COLORS=['#33ccff','#ffcc33','#cc66ff','#3366ff','#ff9933','#66ff66','#ff4444'];
    var board,cur,curX,curY,curType,nxt,sc,lv,ln,over,dropTimer,dropInterval,lockDelay;

    function rot(shape){var r=shape.length,c=shape[0].length,n=[];for(var i=0;i<c;i++){n[i]=[];for(var j=0;j<r;j++)n[i][j]=shape[r-1-j][i];}return n;}
    function fits(shape,ox,oy){for(var r=0;r<shape.length;r++)for(var c=0;c<shape[r].length;c++){if(!shape[r][c])continue;var x=ox+c,y=oy+r;if(x<0||x>=COLS||y>=ROWS)return false;if(y>=0&&board[y][x])return false;}return true;}
    function place(){for(var r=0;r<cur.length;r++)for(var c=0;c<cur[r].length;c++){if(!cur[r][c])continue;var y=curY+r;if(y<0){over=true;return;}board[y][curX+c]=curType+1;}}
    function clearLines(){var cleared=0;for(var r=ROWS-1;r>=0;r--){if(board[r].every(function(c){return c>0;})){board.splice(r,1);board.unshift(new Array(COLS).fill(0));cleared++;r++;}}
    if(cleared){ln+=cleared;var pts=[0,100,300,500,800];sc+=pts[Math.min(cleared,4)]*lv;var nl=Math.floor(ln/10)+1;if(nl>lv){lv=nl;dropInterval=Math.max(80,500-lv*40);}
    document.getElementById('tetS').textContent=sc;document.getElementById('tetLv').textContent=lv;document.getElementById('tetLn').textContent=ln;}}
    function spawn(){curType=nxt;cur=SHAPES[curType].map(function(r){return r.slice();});curX=Math.floor((COLS-cur[0].length)/2);curY=-cur.length;nxt=Math.floor(Math.random()*7);drawNext();}
    function drawNext(){nx.fillStyle='rgba(0,0,0,0.8)';nx.fillRect(0,0,64,64);var s=SHAPES[nxt],sz=12,ox=(64-s[0].length*sz)/2,oy=(64-s.length*sz)/2;
    nx.fillStyle=COLORS[nxt];nx.shadowColor=COLORS[nxt];nx.shadowBlur=4;for(var r=0;r<s.length;r++)for(var c=0;c<s[r].length;c++){if(s[r][c])nx.fillRect(ox+c*sz+1,oy+r*sz+1,sz-2,sz-2);}nx.shadowBlur=0;}
    function draw(){cx.clearRect(0,0,cw,ch);cx.fillStyle='rgba(0,0,0,0.95)';cx.fillRect(0,0,cw,ch);
    // Grid
    cx.strokeStyle='rgba(51,255,51,0.03)';cx.lineWidth=0.5;for(var i=0;i<=COLS;i++){cx.beginPath();cx.moveTo(i*CELL,0);cx.lineTo(i*CELL,ch);cx.stroke();}for(var i=0;i<=ROWS;i++){cx.beginPath();cx.moveTo(0,i*CELL);cx.lineTo(cw,i*CELL);cx.stroke();}
    // Board
    for(var r=0;r<ROWS;r++)for(var c=0;c<COLS;c++){if(!board[r][c])continue;cx.fillStyle=COLORS[board[r][c]-1];cx.shadowColor=COLORS[board[r][c]-1];cx.shadowBlur=2;cx.fillRect(c*CELL+1,r*CELL+1,CELL-2,CELL-2);cx.shadowBlur=0;
    cx.fillStyle='rgba(255,255,255,0.1)';cx.fillRect(c*CELL+1,r*CELL+1,CELL-2,1);}
    // Ghost
    if(cur&&!over){var gy=curY;while(fits(cur,curX,gy+1))gy++;if(gy!==curY){cx.globalAlpha=0.15;for(var r=0;r<cur.length;r++)for(var c=0;c<cur[r].length;c++){if(!cur[r][c])continue;var y=gy+r;if(y>=0){cx.fillStyle=COLORS[curType];cx.fillRect((curX+c)*CELL+1,y*CELL+1,CELL-2,CELL-2);}}cx.globalAlpha=1;}
    // Current piece
    cx.fillStyle=COLORS[curType];cx.shadowColor=COLORS[curType];cx.shadowBlur=3;for(var r=0;r<cur.length;r++)for(var c=0;c<cur[r].length;c++){if(!cur[r][c])continue;var y=curY+r;if(y>=0)cx.fillRect((curX+c)*CELL+1,y*CELL+1,CELL-2,CELL-2);}cx.shadowBlur=0;}
    if(over){cx.fillStyle='rgba(0,0,0,0.5)';cx.fillRect(0,0,cw,ch);cx.fillStyle='#ff4444';cx.font='16px VT323';cx.textAlign='center';cx.fillText('GAME OVER',cw/2,ch/2);cx.fillStyle=COLORS[0];cx.font='12px VT323';cx.fillText('R to restart',cw/2,ch/2+20);}}

    function drop(){if(over)return;if(fits(cur,curX,curY+1)){curY++;}else{place();if(over){draw();document.getElementById('tetM').textContent='Game Over \u2014 R to restart';return;}clearLines();spawn();if(!fits(cur,curX,curY)){over=true;draw();document.getElementById('tetM').textContent='Game Over \u2014 R to restart';return;}}draw();}
    function hardDrop(){if(over)return;while(fits(cur,curX,curY+1))curY++;place();if(!over){clearLines();spawn();if(!fits(cur,curX,curY)){over=true;}}draw();if(over)document.getElementById('tetM').textContent='Game Over \u2014 R to restart';}
    function newGame(){board=[];for(var r=0;r<ROWS;r++)board[r]=new Array(COLS).fill(0);sc=0;lv=1;ln=0;over=false;dropInterval=500;nxt=Math.floor(Math.random()*7);spawn();
    document.getElementById('tetS').textContent='0';document.getElementById('tetLv').textContent='1';document.getElementById('tetLn').textContent='0';document.getElementById('tetM').textContent='';
    clearInterval(win._interval);win._interval=setInterval(drop,dropInterval);draw();}

    win._onKey=function(e){
        if(e.key==='r'||e.key==='R'){newGame();return;}
        if(over)return;
        if(e.key==='ArrowLeft'){if(fits(cur,curX-1,curY))curX--;draw();e.preventDefault();}
        else if(e.key==='ArrowRight'){if(fits(cur,curX+1,curY))curX++;draw();e.preventDefault();}
        else if(e.key==='ArrowDown'){drop();clearInterval(win._interval);win._interval=setInterval(drop,dropInterval);e.preventDefault();}
        else if(e.key==='ArrowUp'||e.key==='x'){var r2=rot(cur);if(fits(r2,curX,curY))cur=r2;else if(fits(r2,curX-1,curY)){cur=r2;curX--;}else if(fits(r2,curX+1,curY)){cur=r2;curX++;}draw();e.preventDefault();}
        else if(e.key===' '){hardDrop();clearInterval(win._interval);win._interval=setInterval(drop,dropInterval);e.preventDefault();}
        else if(e.key==='z'){var r3=rot(rot(rot(cur)));if(fits(r3,curX,curY))cur=r3;else if(fits(r3,curX-1,curY)){cur=r3;curX--;}else if(fits(r3,curX+1,curY)){cur=r3;curX++;}draw();e.preventDefault();}
    };
    newGame();
}

/* ════════════════════════════════════════════
   SPACE INVADERS
   ════════════════════════════════════════════ */
function initInvaders(body, bw, bh) {
    var cw=Math.min(bw-16,290),ch=Math.min(bh-50,330);
    body.innerHTML='<div style="display:flex;flex-direction:column;align-items:center;height:100%;padding:6px"><div style="display:flex;justify-content:space-between;width:100%;padding:2px 4px;font-size:0.78rem;color:var(--phosphor)"><span id="ivS">Score: 0</span><span id="ivW">Wave 1</span><span id="ivL">x3</span></div><canvas id="ivC" width="'+cw+'" height="'+ch+'" style="border:1px solid rgba(51,255,51,0.15);background:rgba(0,0,0,0.4)"></canvas><div id="ivM" style="font-size:0.78rem;color:var(--phosphor-bright);margin-top:4px;text-align:center">Arrow keys + Space to shoot</div></div>';
    var cv=document.getElementById('ivC'),cx=cv.getContext('2d');
    var win=body.closest('.app-window');
    var px,pw=24,bullets=[],eBullets=[],aliens=[],shields=[],sc,lives,wave,over,aDir,aSpeed,aTick,aDropNext,eShootTick;
    var keys=_gameKeys;

    function makeAliens(){aliens=[];var rows=5,cols=Math.floor((cw-40)/22);
    for(var r=0;r<rows;r++)for(var c=0;c<cols;c++){aliens.push({x:20+c*22,y:30+r*20,w:16,h:12,alive:true,type:r<1?2:r<3?1:0});}}
    function makeShields(){shields=[];var sw=30,sh=16,gap=Math.floor((cw-sw*4)/5);for(var i=0;i<4;i++){var sx=gap+(sw+gap)*i;
    for(var py=0;py<sh;py+=4)for(var ppx=0;ppx<sw;ppx+=4){shields.push({x:sx+ppx,y:ch-60+py,w:4,h:4,alive:true});}}}
    function newGame(){sc=0;lives=3;wave=1;over=false;px=cw/2-pw/2;bullets=[];eBullets=[];aDir=1;aSpeed=0.4;aTick=0;aDropNext=false;eShootTick=0;makeAliens();makeShields();ub();
    document.getElementById('ivM').textContent='';clearInterval(win._interval);win._interval=setInterval(tick,16);}
    function nextWave(){wave++;aSpeed=Math.min(1.5,0.4+wave*0.15);bullets=[];eBullets=[];aDir=1;aDropNext=false;aTick=0;eShootTick=0;makeAliens();ub();}
    function ub(){document.getElementById('ivS').textContent='Score: '+sc;document.getElementById('ivW').textContent='Wave '+wave;document.getElementById('ivL').textContent='x'+lives;}

    function tick(){if(over||!openWindows['invaders'])return;
    // Player input
    if(keys['ArrowLeft']||keys['a'])px=Math.max(0,px-3);
    if(keys['ArrowRight']||keys['d'])px=Math.min(cw-pw,px+3);
    // Player bullets
    bullets.forEach(function(b){b.y-=5;});
    bullets=bullets.filter(function(b){return b.y>-4;});
    // Enemy bullets
    eBullets.forEach(function(b){b.y+=3;});
    eBullets=eBullets.filter(function(b){return b.y<ch+4;});
    // Move aliens
    aTick++;
    if(aTick%2===0){
        var edgeHit=false;
        aliens.forEach(function(a){if(!a.alive)return;a.x+=aDir*aSpeed;if(a.x+a.w>cw-4||a.x<4)edgeHit=true;});
        if(edgeHit){aDropNext=true;aDir=-aDir;}
    }
    if(aDropNext){aliens.forEach(function(a){if(a.alive)a.y+=8;});aDropNext=false;}
    // Enemy shooting
    eShootTick++;
    if(eShootTick>50-wave*3){eShootTick=0;var alive=aliens.filter(function(a){return a.alive;});
    if(alive.length){var shooter=alive[Math.floor(Math.random()*alive.length)];eBullets.push({x:shooter.x+shooter.w/2,y:shooter.y+shooter.h});}}
    // Bullet-alien collision
    bullets.forEach(function(b){aliens.forEach(function(a){if(!a.alive)return;if(b.x>a.x&&b.x<a.x+a.w&&b.y>a.y&&b.y<a.y+a.h){a.alive=false;b.y=-99;sc+=(a.type+1)*10;ub();}});});
    // Bullet-shield collision
    bullets.forEach(function(b){shields.forEach(function(s){if(!s.alive)return;if(b.x>s.x&&b.x<s.x+s.w&&b.y>s.y&&b.y<s.y+s.h){s.alive=false;b.y=-99;}});});
    eBullets.forEach(function(b){shields.forEach(function(s){if(!s.alive)return;if(b.x>s.x&&b.x<s.x+s.w&&b.y>s.y&&b.y<s.y+s.h){s.alive=false;b.y=ch+99;}});});
    // Enemy bullet hits player
    eBullets.forEach(function(b){if(b.x>px&&b.x<px+pw&&b.y>ch-20&&b.y<ch-12){b.y=ch+99;lives--;ub();if(lives<=0){over=true;document.getElementById('ivM').textContent='GAME OVER \u2014 R to restart';}}});
    // Aliens reach bottom
    var bottom=false;aliens.forEach(function(a){if(a.alive&&a.y+a.h>ch-30)bottom=true;});
    if(bottom){over=true;document.getElementById('ivM').textContent='INVADED! \u2014 R to restart';}
    // Wave clear
    if(!aliens.some(function(a){return a.alive;}))nextWave();
    draw();}

    function draw(){cx.fillStyle='rgba(0,0,0,0.92)';cx.fillRect(0,0,cw,ch);
    var pc=_pc;
    // Player
    cx.fillStyle=pc;cx.shadowColor=pc;cx.shadowBlur=4;
    cx.fillRect(px,ch-18,pw,6);cx.fillRect(px+pw/2-2,ch-22,4,4);cx.shadowBlur=0;
    // Aliens
    aliens.forEach(function(a){if(!a.alive)return;
    var cols2=['#66ff66','#33ccff','#ff4444'];cx.fillStyle=cols2[a.type];cx.shadowColor=cols2[a.type];cx.shadowBlur=3;
    // Simple pixel alien shapes
    if(a.type===0){cx.fillRect(a.x+2,a.y,12,8);cx.fillRect(a.x,a.y+2,2,4);cx.fillRect(a.x+14,a.y+2,2,4);cx.fillRect(a.x+4,a.y+8,2,4);cx.fillRect(a.x+10,a.y+8,2,4);}
    else if(a.type===1){cx.fillRect(a.x+4,a.y,8,10);cx.fillRect(a.x,a.y+2,4,6);cx.fillRect(a.x+12,a.y+2,4,6);cx.fillRect(a.x+2,a.y+10,4,2);cx.fillRect(a.x+10,a.y+10,4,2);}
    else{cx.fillRect(a.x+2,a.y,12,6);cx.fillRect(a.x,a.y+3,16,4);cx.fillRect(a.x+4,a.y+7,8,4);cx.fillRect(a.x+2,a.y+9,2,3);cx.fillRect(a.x+12,a.y+9,2,3);}
    cx.shadowBlur=0;});
    // Shields
    cx.fillStyle=pc;shields.forEach(function(s){if(s.alive)cx.fillRect(s.x,s.y,s.w,s.h);});
    // Bullets
    cx.fillStyle='#ffffff';cx.shadowColor='#ffffff';cx.shadowBlur=4;
    bullets.forEach(function(b){cx.fillRect(b.x-1,b.y,2,6);});
    cx.fillStyle='#ff4444';cx.shadowColor='#ff4444';
    eBullets.forEach(function(b){cx.fillRect(b.x-1,b.y,2,6);});
    cx.shadowBlur=0;
    if(over){cx.fillStyle='rgba(0,0,0,0.4)';cx.fillRect(0,0,cw,ch);}}

    win._onKey=function(e){
    if(e.key===' '&&!over){if(bullets.length<3)bullets.push({x:px+pw/2,y:ch-24});e.preventDefault();}
    if(e.key==='r'||e.key==='R')newGame();
    if(['ArrowLeft','ArrowRight',' '].indexOf(e.key)!==-1)e.preventDefault();};
    newGame();
}

/* ════════════════════════════════════════════
   ASTEROIDS
   ════════════════════════════════════════════ */
function initAsteroids(body, bw, bh) {
    var cw=Math.min(bw-16,320),ch=Math.min(bh-50,330);
    body.innerHTML='<div style="display:flex;flex-direction:column;align-items:center;height:100%;padding:6px"><div style="display:flex;justify-content:space-between;width:100%;padding:2px 4px;font-size:0.78rem;color:var(--phosphor)"><span id="asS">0</span><span id="asW">Wave 1</span><span id="asL">x3</span></div><canvas id="asC" width="'+cw+'" height="'+ch+'" style="border:1px solid rgba(51,255,51,0.15);background:rgba(0,0,0,0.4)"></canvas><div id="asM" style="font-size:0.78rem;color:var(--phosphor-bright);margin-top:4px;text-align:center">Arrows: turn/thrust | Space: shoot</div></div>';
    var cv=document.getElementById('asC'),cx=cv.getContext('2d');
    var win=body.closest('.app-window');
    var ship,bullets,asteroids,particles,sc,lives,wave,over,invulnT;
    var keys=_gameKeys;

    function makeShip(){return{x:cw/2,y:ch/2,vx:0,vy:0,angle:0,thrust:false};}
    function makeAsteroid(x,y,sz){var a=Math.random()*Math.PI*2,sp=0.5+Math.random()*(0.5+wave*0.15);
    var pts=[];var n=7+Math.floor(Math.random()*5);for(var i=0;i<n;i++){var ang=i/n*Math.PI*2;var r2=sz*(0.7+Math.random()*0.3);pts.push({x:Math.cos(ang)*r2,y:Math.sin(ang)*r2});}
    return{x:x||Math.random()*cw,y:y||Math.random()*ch,vx:Math.cos(a)*sp,vy:Math.sin(a)*sp,sz:sz,pts:pts,rot:Math.random()*Math.PI*2,rv:(Math.random()-0.5)*0.02};}
    function spawnWave(){asteroids=[];var n=3+wave;for(var i=0;i<n;i++){var a=makeAsteroid(null,null,25);
    // Don't spawn on player
    while(Math.abs(a.x-cw/2)<80&&Math.abs(a.y-ch/2)<80){a.x=Math.random()*cw;a.y=Math.random()*ch;}
    asteroids.push(a);}}
    function newGame(){ship=makeShip();bullets=[];particles=[];sc=0;lives=3;wave=1;over=false;invulnT=120;spawnWave();ub();
    document.getElementById('asM').textContent='';clearInterval(win._interval);win._interval=setInterval(tick,16);}
    function ub(){document.getElementById('asS').textContent=sc;document.getElementById('asW').textContent='Wave '+wave;document.getElementById('asL').textContent='x'+lives;}
    function wrap(o){if(o.x<-20)o.x=cw+20;if(o.x>cw+20)o.x=-20;if(o.y<-20)o.y=ch+20;if(o.y>ch+20)o.y=-20;}

    function tick(){if(over||!openWindows['asteroids'])return;
    // Ship controls
    if(keys['ArrowLeft']||keys['a'])ship.angle-=0.06;
    if(keys['ArrowRight']||keys['d'])ship.angle+=0.06;
    if(keys['ArrowUp']||keys['w']){ship.vx+=Math.cos(ship.angle)*0.12;ship.vy+=Math.sin(ship.angle)*0.12;ship.thrust=true;
    if(Math.random()<0.4)particles.push({x:ship.x-Math.cos(ship.angle)*10,y:ship.y-Math.sin(ship.angle)*10,vx:-Math.cos(ship.angle)*2+Math.random()-0.5,vy:-Math.sin(ship.angle)*2+Math.random()-0.5,life:15+Math.random()*10});}
    else ship.thrust=false;
    // Friction
    ship.vx*=0.99;ship.vy*=0.99;var spd=Math.sqrt(ship.vx*ship.vx+ship.vy*ship.vy);if(spd>4){ship.vx*=4/spd;ship.vy*=4/spd;}
    ship.x+=ship.vx;ship.y+=ship.vy;wrap(ship);
    if(invulnT>0)invulnT--;
    // Bullets
    bullets.forEach(function(b){b.x+=b.vx;b.y+=b.vy;b.life--;wrap(b);});
    bullets=bullets.filter(function(b){return b.life>0;});
    // Asteroids
    asteroids.forEach(function(a){a.x+=a.vx;a.y+=a.vy;a.rot+=a.rv;wrap(a);});
    // Particles
    particles.forEach(function(p){p.x+=p.vx;p.y+=p.vy;p.life--;});
    particles=particles.filter(function(p){return p.life>0;});
    // Bullet-asteroid collision
    var newAst=[];
    bullets.forEach(function(b){asteroids.forEach(function(a){var dx=b.x-a.x,dy=b.y-a.y;
    if(Math.sqrt(dx*dx+dy*dy)<a.sz){b.life=0;a.sz=0;sc+=a.sz>20?20:a.sz>12?50:100;ub();
    // Explode particles
    for(var i=0;i<6;i++)particles.push({x:a.x,y:a.y,vx:(Math.random()-0.5)*3,vy:(Math.random()-0.5)*3,life:20+Math.random()*15});
    // Split
    if(a.pts&&a.pts.length>0){var origSz=25;if(a.vx!==undefined){var s2=origSz;if(Math.abs(a.vx)+Math.abs(a.vy)>0)s2=Math.sqrt(a.pts[0].x*a.pts[0].x+a.pts[0].y*a.pts[0].y);
    if(s2>10){newAst.push(makeAsteroid(a.x,a.y,s2*0.55));newAst.push(makeAsteroid(a.x,a.y,s2*0.55));}}}}});});
    asteroids=asteroids.filter(function(a){return a.sz>0;}).concat(newAst);
    // Ship-asteroid collision
    if(invulnT<=0){asteroids.forEach(function(a){var dx=ship.x-a.x,dy=ship.y-a.y;
    if(Math.sqrt(dx*dx+dy*dy)<a.sz+6){lives--;ub();for(var i=0;i<12;i++)particles.push({x:ship.x,y:ship.y,vx:(Math.random()-0.5)*4,vy:(Math.random()-0.5)*4,life:30});
    if(lives<=0){over=true;document.getElementById('asM').textContent='GAME OVER \u2014 R to restart';}else{ship=makeShip();invulnT=120;}}});}
    // Wave clear
    if(asteroids.length===0){wave++;spawnWave();ub();}
    draw();}

    function draw(){cx.fillStyle='rgba(0,0,0,0.2)';cx.fillRect(0,0,cw,ch);
    var pc=_pc;
    // Ship
    if(!over&&(invulnT<=0||Math.floor(invulnT/4)%2===0)){
    cx.save();cx.translate(ship.x,ship.y);cx.rotate(ship.angle);
    cx.strokeStyle=pc;cx.shadowColor=pc;cx.shadowBlur=4;cx.lineWidth=1.5;
    cx.beginPath();cx.moveTo(12,0);cx.lineTo(-8,-7);cx.lineTo(-4,0);cx.lineTo(-8,7);cx.closePath();cx.stroke();
    if(ship.thrust){cx.strokeStyle='#F7931A';cx.shadowColor='#F7931A';cx.beginPath();cx.moveTo(-4,-3);cx.lineTo(-12,0);cx.lineTo(-4,3);cx.stroke();}
    cx.shadowBlur=0;cx.restore();}
    // Asteroids
    cx.strokeStyle=pc;cx.shadowColor=pc;cx.shadowBlur=2;cx.lineWidth=1.2;
    asteroids.forEach(function(a){cx.save();cx.translate(a.x,a.y);cx.rotate(a.rot);cx.beginPath();
    for(var i=0;i<a.pts.length;i++){if(i===0)cx.moveTo(a.pts[i].x,a.pts[i].y);else cx.lineTo(a.pts[i].x,a.pts[i].y);}
    cx.closePath();cx.stroke();cx.restore();});
    cx.shadowBlur=0;
    // Bullets
    cx.fillStyle='#ffffff';cx.shadowColor='#ffffff';cx.shadowBlur=4;
    bullets.forEach(function(b){cx.beginPath();cx.arc(b.x,b.y,2,0,Math.PI*2);cx.fill();});
    // Particles
    particles.forEach(function(p){var a=p.life/30;cx.fillStyle='rgba(247,147,26,'+a+')';cx.fillRect(p.x,p.y,2,2);});
    cx.shadowBlur=0;}

    win._onKey=function(e){
    if(e.key===' '&&!over&&bullets.length<6){bullets.push({x:ship.x+Math.cos(ship.angle)*12,y:ship.y+Math.sin(ship.angle)*12,vx:Math.cos(ship.angle)*6+ship.vx*0.3,vy:Math.sin(ship.angle)*6+ship.vy*0.3,life:55});e.preventDefault();}
    if(e.key==='r'||e.key==='R')newGame();
    if(['ArrowLeft','ArrowRight','ArrowUp',' '].indexOf(e.key)!==-1)e.preventDefault();};
    newGame();
}

/* ════════════════════════════════════════════
   ROGUELIKE DUNGEON
   ════════════════════════════════════════════ */
function initRogue(body, bw, bh) {
    var win=body.closest('.app-window');
    var COLS=Math.floor((bw-16)/14),ROWS=Math.floor((bh-80)/16);
    if(COLS<18)COLS=18;if(ROWS<14)ROWS=14;
    body.innerHTML='<div style="display:flex;flex-direction:column;height:100%;font-family:VT323,monospace"><div style="display:flex;justify-content:space-between;padding:3px 8px;font-size:0.78rem;color:var(--phosphor);border-bottom:1px solid rgba(51,255,51,0.06)"><span id="rgHp">HP: 10/10</span><span id="rgLv">Fl: 1</span><span id="rgSc">Kills: 0</span></div><pre id="rgMap" style="flex:1;margin:0;padding:4px 6px;font-size:13px;line-height:15px;color:var(--phosphor);overflow:hidden;white-space:pre;letter-spacing:1px"></pre><div id="rgMsg" style="padding:3px 8px;font-size:0.72rem;color:var(--phosphor-dim);border-top:1px solid rgba(51,255,51,0.06);min-height:16px">Arrows/WASD to move. Bump enemies to attack.</div></div>';
    var map=[],px,py,enemies=[],items=[],floor,hp,maxHp,atk,kills,msgs=[];
    var TILE={WALL:'#',FLOOR:'.',DOOR:'+',STAIR:'>',PLAYER:'@',POTION:'!',GOLD:'$'};

    function rng(a,b){return Math.floor(Math.random()*(b-a+1))+a;}
    function genLevel(){
        map=[];for(var r=0;r<ROWS;r++){map[r]=[];for(var c=0;c<COLS;c++)map[r][c]=TILE.WALL;}
        enemies=[];items=[];
        // BSP-lite room generation
        var rooms=[];var tries=0;
        while(rooms.length<6&&tries<200){tries++;
        var rw=rng(4,8),rh=rng(3,6),rx=rng(1,COLS-rw-1),ry=rng(1,ROWS-rh-1);
        var overlap=false;for(var i=0;i<rooms.length;i++){var o=rooms[i];if(rx<=o.x+o.w+1&&rx+rw>=o.x-1&&ry<=o.y+o.h+1&&ry+rh>=o.y-1){overlap=true;break;}}
        if(!overlap){rooms.push({x:rx,y:ry,w:rw,h:rh});for(var r=ry;r<ry+rh;r++)for(var c=rx;c<rx+rw;c++)map[r][c]=TILE.FLOOR;}}
        // Connect rooms with corridors
        for(var i=1;i<rooms.length;i++){var a=rooms[i-1],b=rooms[i];
        var ax=Math.floor(a.x+a.w/2),ay=Math.floor(a.y+a.h/2);
        var bx=Math.floor(b.x+b.w/2),by=Math.floor(b.y+b.h/2);
        var cx2=ax,cy2=ay;
        while(cx2!==bx){map[cy2][cx2]=map[cy2][cx2]===TILE.WALL?TILE.FLOOR:map[cy2][cx2];cx2+=cx2<bx?1:-1;}
        while(cy2!==by){map[cy2][cx2]=map[cy2][cx2]===TILE.WALL?TILE.FLOOR:map[cy2][cx2];cy2+=cy2<by?1:-1;}}
        // Place player in first room
        px=Math.floor(rooms[0].x+rooms[0].w/2);py=Math.floor(rooms[0].y+rooms[0].h/2);
        // Place stairs in last room
        var lr=rooms[rooms.length-1];
        map[Math.floor(lr.y+lr.h/2)][Math.floor(lr.x+lr.w/2)]=TILE.STAIR;
        // Place enemies
        var enames=['g','s','o','R','D','W'];var ehps=[2,3,4,5,7,10];var eatks=[1,1,2,2,3,4];
        for(var i=1;i<rooms.length-1;i++){var rm=rooms[i];var ne=rng(1,2+Math.floor(floor/3));
        for(var j=0;j<ne;j++){var ex=rng(rm.x+1,rm.x+rm.w-2),ey=rng(rm.y+1,rm.y+rm.h-2);
        var ti=Math.min(Math.floor(floor/2)+rng(0,1),enames.length-1);
        enemies.push({x:ex,y:ey,hp:ehps[ti]+floor,maxHp:ehps[ti]+floor,atk:eatks[ti]+Math.floor(floor/3),ch:enames[ti],name:['goblin','snake','ogre','Rat King','Dragon','Wraith'][ti]});}}
        // Place items
        for(var i=1;i<rooms.length;i++){var rm=rooms[i];if(Math.random()<0.5){var ix=rng(rm.x+1,rm.x+rm.w-2),iy=rng(rm.y+1,rm.y+rm.h-2);
        items.push({x:ix,y:iy,type:Math.random()<0.6?'potion':'gold'});}}}

    function draw(){
        var display=[];
        for(var r=0;r<ROWS;r++){var row='';for(var c=0;c<COLS;c++){
        var ch=map[r][c];
        // Items
        var item=null;items.forEach(function(it){if(it.x===c&&it.y===r)item=it;});
        if(item)ch=item.type==='potion'?'<span style="color:#ff66aa">!</span>':'<span style="color:#ffcc33">$</span>';
        // Enemies
        var en=null;enemies.forEach(function(e){if(e.x===c&&e.y===r)en=e;});
        if(en)ch='<span style="color:#ff4444">'+en.ch+'</span>';
        // Player
        if(c===px&&r===py)ch='<span style="color:var(--phosphor-bright);text-shadow:0 0 6px var(--phosphor-glow)">@</span>';
        // Stairs
        if(map[r][c]===TILE.STAIR&&!(c===px&&r===py))ch='<span style="color:#33ccff">&gt;</span>';
        // Walls
        if(map[r][c]===TILE.WALL)ch='<span style="color:rgba(51,255,51,0.2)">#</span>';
        row+=ch;}display.push(row);}
        document.getElementById('rgMap').innerHTML=display.join('\n');
        document.getElementById('rgHp').textContent='HP: '+hp+'/'+maxHp+(atk>1?' Atk:'+atk:'');
        document.getElementById('rgLv').textContent='Fl: '+floor;
        document.getElementById('rgSc').textContent='Kills: '+kills;
        if(msgs.length)document.getElementById('rgMsg').textContent=msgs[msgs.length-1];
    }

    function tryMove(dx,dy){
        var nx=px+dx,ny=py+dy;
        if(nx<0||nx>=COLS||ny<0||ny>=ROWS)return;
        if(map[ny][nx]===TILE.WALL)return;
        // Check enemy
        var target=null;enemies.forEach(function(e){if(e.x===nx&&e.y===ny)target=e;});
        if(target){
            var dmg=Math.max(1,atk+rng(0,2));target.hp-=dmg;
            msgs.push('You hit '+target.name+' for '+dmg+'!');
            if(target.hp<=0){enemies=enemies.filter(function(e){return e!==target;});kills++;msgs.push(target.name+' defeated!');
            // Drop loot
            if(Math.random()<0.3)items.push({x:target.x,y:target.y,type:'potion'});}
        }else{
            px=nx;py=ny;
            // Pick up items
            var got=[];items.forEach(function(it){if(it.x===px&&it.y===py){got.push(it);
            if(it.type==='potion'){hp=Math.min(maxHp,hp+rng(3,6));msgs.push('Healed! HP:'+hp);}
            else{var g=rng(5,15);msgs.push('+'+g+' gold');}}});
            items=items.filter(function(it){return got.indexOf(it)===-1;});
            // Stairs
            if(map[py][px]===TILE.STAIR){floor++;maxHp+=2;hp=maxHp;atk+=1;msgs.push('Descending to floor '+floor+'...');genLevel();}
        }
        // Enemy turns
        enemies.forEach(function(e){var ddx=px-e.x,ddy=py-e.y;var dist=Math.abs(ddx)+Math.abs(ddy);
        if(dist<=1){var dmg2=Math.max(1,e.atk+rng(0,1));hp-=dmg2;msgs.push(e.name+' hits you for '+dmg2+'!');}
        else if(dist<8){var mx2=ddx>0?1:ddx<0?-1:0,my2=ddy>0?1:ddy<0?-1:0;
        if(Math.random()<0.5)mx2=0;else my2=0;var enx=e.x+mx2,eny=e.y+my2;
        if(map[eny][enx]!==TILE.WALL&&!enemies.some(function(o){return o!==e&&o.x===enx&&o.y===eny;})&&!(enx===px&&eny===py)){e.x=enx;e.y=eny;}}});
        if(hp<=0){msgs.push('You died on floor '+floor+' with '+kills+' kills.');
        document.getElementById('rgMsg').textContent=msgs[msgs.length-1]+' \u2014 R to restart';}
        else draw();
    }

    function newGame(){floor=1;hp=10;maxHp=10;atk=1;kills=0;msgs=['Welcome to the dungeon. Find the stairs (>) to descend.'];genLevel();draw();}

    win._onKey=function(e){
        if(e.key==='r'||e.key==='R'){newGame();return;}
        if(hp<=0)return;
        if(e.key==='ArrowUp'||e.key==='w'){tryMove(0,-1);draw();e.preventDefault();}
        else if(e.key==='ArrowDown'||e.key==='s'){tryMove(0,1);draw();e.preventDefault();}
        else if(e.key==='ArrowLeft'||e.key==='a'){tryMove(-1,0);draw();e.preventDefault();}
        else if(e.key==='ArrowRight'||e.key==='d'){tryMove(1,0);draw();e.preventDefault();}
    };
    newGame();
}


/* ════════════════════════════════════════════
   SOPWITH (biplane side-scroller)
   ════════════════════════════════════════════ */
function initSopwith(body, bw, bh) {
    var cw=Math.min(bw-16,330),ch=Math.min(bh-50,260);
    body.innerHTML='<div style="display:flex;flex-direction:column;align-items:center;height:100%;padding:6px"><div style="display:flex;justify-content:space-between;width:100%;padding:2px 4px;font-size:0.78rem;color:var(--phosphor)"><span id="swS">0</span><span id="swW">Fuel: 100</span><span id="swL">x3</span></div><canvas id="swC" width="'+cw+'" height="'+ch+'" style="border:1px solid rgba(51,255,51,0.15);background:rgba(0,0,0,0.4)"></canvas><div id="swM" style="font-size:0.72rem;color:var(--phosphor-bright);margin-top:3px;text-align:center">Up/Down: pitch | Space: shoot | B: bomb</div></div>';
    var cv=document.getElementById('swC'),cx=cv.getContext('2d');
    var win=body.closest('.app-window'),keys=_gameKeys;
    var plane,bullets,bombs,enemies,ground,scroll,sc,lives,fuel,over,eTick;
    var GH=40; // ground zone height

    function genGround(){ground=[];for(var i=0;i<200;i++){var h=GH+Math.sin(i*0.08)*15+Math.sin(i*0.03)*10+Math.random()*5;ground.push(h);}}
    function gndAt(wx){var i=Math.floor(wx/8)%ground.length;if(i<0)i+=ground.length;return ground[i];}

    function newGame(){plane={x:cw*0.25,y:ch*0.4,vy:0,angle:0,flip:false};bullets=[];bombs=[];enemies=[];scroll=0;sc=0;lives=3;fuel=100;over=false;eTick=0;
    genGround();spawnEnemies();ub();document.getElementById('swM').textContent='';
    clearInterval(win._interval);win._interval=setInterval(tick,20);}

    function spawnEnemies(){for(var i=0;i<6;i++){var ex=scroll+cw+200+i*180+Math.random()*100;
    enemies.push(Math.random()<0.5?{type:'plane',x:ex,y:30+Math.random()*(ch-GH-60),vy:Math.random()*0.5-0.25,alive:true}:{type:'turret',x:ex,y:0,alive:true});}}

    function ub(){document.getElementById('swS').textContent=sc;document.getElementById('swW').textContent='Fuel:'+Math.floor(fuel);document.getElementById('swL').textContent='x'+lives;}

    function tick(){if(over||!openWindows['sopwith'])return;
    // Scroll
    scroll+=2;
    // Pitch
    if(keys['ArrowUp']||keys['w'])plane.vy-=0.18;
    if(keys['ArrowDown']||keys['s'])plane.vy+=0.18;
    plane.vy+=0.04; // gravity
    plane.vy*=0.96;
    plane.y+=plane.vy;
    // Clamp
    if(plane.y<8)plane.y=8;
    var gnd=gndAt(scroll+plane.x);
    if(plane.y>ch-gnd-6){plane.y=ch-gnd-6;
    if(Math.abs(plane.vy)>2.5){die();return;}plane.vy=0;}
    // Fuel
    fuel-=0.02;if(fuel<=0){fuel=0;plane.vy+=0.08;}
    ub();
    // Bullets
    bullets.forEach(function(b){b.x+=6;b.life--;});
    bullets=bullets.filter(function(b){return b.life>0;});
    // Bombs
    bombs.forEach(function(b){b.x+=2;b.vy+=0.15;b.y+=b.vy;});
    bombs=bombs.filter(function(b){return b.y<ch-gndAt(scroll+b.x)+4;});
    // Enemies
    eTick++;
    enemies.forEach(function(e){if(!e.alive)return;
    if(e.type==='plane'){e.y+=e.vy;if(e.y<20||e.y>ch-GH-20)e.vy=-e.vy;}
    if(e.type==='turret')e.y=ch-gndAt(e.x)-8;});
    // Spawn more
    var furthest=scroll+cw+300;enemies.forEach(function(e){if(e.x>furthest)furthest=e.x;});
    if(enemies.filter(function(e){return e.alive;}).length<4){
    for(var i=0;i<3;i++){var ex=furthest+100+i*200+Math.random()*80;
    enemies.push(Math.random()<0.5?{type:'plane',x:ex,y:30+Math.random()*(ch-GH-60),vy:Math.random()*0.5-0.25,alive:true}:{type:'turret',x:ex,y:0,alive:true});}}
    // Collisions
    bullets.forEach(function(b){enemies.forEach(function(e){if(!e.alive)return;
    var ex=e.x-scroll,ey=e.type==='turret'?e.y:e.y;
    if(Math.abs(b.x-ex)<12&&Math.abs(b.y-ey)<10){e.alive=false;b.life=0;sc+=e.type==='turret'?50:30;ub();}});});
    bombs.forEach(function(b){enemies.forEach(function(e){if(!e.alive)return;
    var ex=e.x-scroll;if(Math.abs(b.x-ex)<14&&Math.abs(b.y-(e.type==='turret'?e.y:e.y))<12){e.alive=false;b.y=9999;sc+=e.type==='turret'?50:30;ub();}});});
    // Enemy hits player
    enemies.forEach(function(e){if(!e.alive)return;var ex=e.x-scroll;
    if(Math.abs(plane.x-ex)<14&&Math.abs(plane.y-e.y)<10){e.alive=false;die();}});
    draw();}

    function die(){lives--;ub();if(lives<=0){over=true;document.getElementById('swM').textContent='CRASHED! Score:'+sc+' \u2014 R to restart';}
    else{plane.y=ch*0.3;plane.vy=0;fuel=Math.min(fuel+30,100);}}

    function draw(){cx.fillStyle='rgba(0,0,0,0.85)';cx.fillRect(0,0,cw,ch);
    var pc=_pc;
    // Stars
    cx.fillStyle='rgba(51,255,51,0.08)';for(var i=0;i<20;i++){var sx=(i*47+scroll*0.2)%cw,sy=(i*31)%((ch-GH)*0.6);cx.fillRect(sx,sy,1,1);}
    // Ground
    cx.fillStyle='rgba(51,255,51,0.08)';cx.strokeStyle='rgba(51,255,51,0.2)';cx.lineWidth=1;
    cx.beginPath();cx.moveTo(0,ch);
    for(var x=0;x<=cw;x+=2){var h=gndAt(scroll+x);cx.lineTo(x,ch-h);}
    cx.lineTo(cw,ch);cx.closePath();cx.fill();cx.stroke();
    // Plane
    cx.save();cx.translate(plane.x,plane.y);cx.rotate(plane.vy*0.08);
    cx.strokeStyle=pc;cx.shadowColor=pc;cx.shadowBlur=4;cx.lineWidth=1.5;
    cx.beginPath();cx.moveTo(14,0);cx.lineTo(-10,-5);cx.lineTo(-6,0);cx.lineTo(-10,5);cx.closePath();cx.stroke();
    // Wings
    cx.beginPath();cx.moveTo(-2,-7);cx.lineTo(6,-7);cx.moveTo(-2,7);cx.lineTo(6,7);cx.stroke();
    cx.shadowBlur=0;cx.restore();
    // Bullets
    cx.fillStyle='#ffffff';cx.shadowColor='#fff';cx.shadowBlur=3;
    bullets.forEach(function(b){cx.fillRect(b.x,b.y-1,4,2);});
    // Bombs
    cx.fillStyle='#F7931A';cx.shadowColor='#F7931A';
    bombs.forEach(function(b){cx.beginPath();cx.arc(b.x,b.y,3,0,Math.PI*2);cx.fill();});
    cx.shadowBlur=0;
    // Enemies
    enemies.forEach(function(e){if(!e.alive)return;var ex=e.x-scroll;if(ex<-20||ex>cw+20)return;
    if(e.type==='plane'){cx.strokeStyle='#ff4444';cx.shadowColor='#ff4444';cx.shadowBlur=3;cx.lineWidth=1.2;
    cx.beginPath();cx.moveTo(ex-10,e.y);cx.lineTo(ex+10,e.y);cx.moveTo(ex+10,e.y);cx.lineTo(ex+4,e.y-4);cx.moveTo(ex+10,e.y);cx.lineTo(ex+4,e.y+4);cx.stroke();}
    else{cx.fillStyle='#ff4444';cx.shadowColor='#ff4444';cx.shadowBlur=3;
    cx.fillRect(ex-4,e.y-6,8,6);cx.fillRect(ex-1,e.y-10,2,4);}
    cx.shadowBlur=0;});}

    win._onKey=function(e){
    if(e.key===' '&&!over){if(bullets.length<4)bullets.push({x:plane.x+14,y:plane.y,life:40});e.preventDefault();}
    if((e.key==='b'||e.key==='B')&&!over)bombs.push({x:plane.x,y:plane.y+6,vy:0.5});
    if(e.key==='r'||e.key==='R')newGame();
    if(['ArrowUp','ArrowDown',' '].indexOf(e.key)!==-1)e.preventDefault();};
    newGame();
}

/* ════════════════════════════════════════════
   MINI GOLF
   ════════════════════════════════════════════ */
function initGolf(body, bw, bh) {
    var cw=Math.min(bw-16,320),ch=Math.min(bh-56,330);
    body.innerHTML='<div style="display:flex;flex-direction:column;align-items:center;height:100%;padding:6px"><div style="display:flex;justify-content:space-between;width:100%;padding:2px 4px;font-size:0.78rem;color:var(--phosphor)"><span id="gfH">Hole 1/9</span><span id="gfSt">Strokes: 0</span><span id="gfT">Total: 0</span></div><canvas id="gfC" width="'+cw+'" height="'+ch+'" style="border:1px solid rgba(51,255,51,0.15);background:rgba(0,0,0,0.5);cursor:crosshair"></canvas><div id="gfM" style="font-size:0.72rem;color:var(--phosphor-bright);margin-top:3px;text-align:center">Click & drag from ball to aim, release to shoot</div></div>';
    var cv=document.getElementById('gfC'),cx=cv.getContext('2d');
    var win=body.closest('.app-window');
    var ball,hole,walls,strokes,totalStrokes,holeNum,dragging,dragX,dragY,sunk;
    var HOLES=[
        {bx:60,by:ch-40,hx:cw-60,hy:50,walls:[[0,ch/2,cw,ch/2,cw,ch/2+8,0,ch/2+8]]},
        {bx:40,by:ch-40,hx:cw-40,hy:40,walls:[[cw/2-4,30,cw/2+4,30,cw/2+4,ch-60,cw/2-4,ch-60]]},
        {bx:40,by:ch/2,hx:cw-40,hy:ch/2,walls:[[cw*0.33-4,ch*0.25,cw*0.33+4,ch*0.25,cw*0.33+4,ch*0.75,cw*0.33-4,ch*0.75],[cw*0.66-4,ch*0.25,cw*0.66+4,ch*0.25,cw*0.66+4,ch*0.75,cw*0.66-4,ch*0.75]]},
        {bx:cw/2,by:ch-30,hx:cw/2,hy:30,walls:[[60,ch/3-4,cw-60,ch/3-4,cw-60,ch/3+4,60,ch/3+4],[60,ch*2/3-4,cw-60,ch*2/3-4,cw-60,ch*2/3+4,60,ch*2/3+4]]},
        {bx:30,by:ch-30,hx:cw-30,hy:30,walls:[[80,80,cw-80,80,cw-80,88,80,88],[80,ch-88,cw-80,ch-88,cw-80,ch-80,80,ch-80],[cw/2-4,88,cw/2+4,88,cw/2+4,ch-88,cw/2-4,ch-88]]},
    ];
    // Generate more holes procedurally
    while(HOLES.length<9){var h={bx:30+Math.random()*(cw-60),by:ch-30-Math.random()*40,hx:30+Math.random()*(cw-60),hy:30+Math.random()*40,walls:[]};
    var nw=1+Math.floor(Math.random()*3);for(var i=0;i<nw;i++){var wx=40+Math.random()*(cw-80),wy=40+Math.random()*(ch-80),ww=4,wh=40+Math.random()*60;
    if(Math.random()>0.5)h.walls.push([wx,wy,wx+wh,wy,wx+wh,wy+ww,wx,wy+ww]);
    else h.walls.push([wx,wy,wx+ww,wy,wx+ww,wy+wh,wx,wy+wh]);}HOLES.push(h);}

    function loadHole(){var h=HOLES[holeNum%HOLES.length];ball={x:h.bx,y:h.by,vx:0,vy:0,r:5};hole={x:h.hx,y:h.hy,r:8};walls=h.walls;strokes=0;sunk=false;dragging=false;ub();document.getElementById('gfM').textContent='';}
    function newGame(){holeNum=0;totalStrokes=0;loadHole();}
    function ub(){document.getElementById('gfH').textContent='Hole '+(holeNum+1)+'/9';document.getElementById('gfSt').textContent='Strokes:'+strokes;document.getElementById('gfT').textContent='Total:'+totalStrokes;}

    function ptInRect(px,py,rect){// rect is [x1,y1,x2,y2,x3,y3,x4,y4] - axis-aligned box
    var minX=Math.min(rect[0],rect[2],rect[4],rect[6]),maxX=Math.max(rect[0],rect[2],rect[4],rect[6]);
    var minY=Math.min(rect[1],rect[3],rect[5],rect[7]),maxY=Math.max(rect[1],rect[3],rect[5],rect[7]);
    return px>=minX&&px<=maxX&&py>=minY&&py<=maxY;}

    function wallBounce(){walls.forEach(function(w){
    var minX=Math.min(w[0],w[2],w[4],w[6]),maxX=Math.max(w[0],w[2],w[4],w[6]);
    var minY=Math.min(w[1],w[3],w[5],w[7]),maxY=Math.max(w[1],w[3],w[5],w[7]);
    if(ball.x+ball.r>minX&&ball.x-ball.r<maxX&&ball.y+ball.r>minY&&ball.y-ball.r<maxY){
    // Determine which side
    var overlapL=ball.x+ball.r-minX,overlapR=maxX-(ball.x-ball.r);
    var overlapT=ball.y+ball.r-minY,overlapB=maxY-(ball.y-ball.r);
    var min=Math.min(overlapL,overlapR,overlapT,overlapB);
    if(min===overlapL){ball.x=minX-ball.r;ball.vx=-Math.abs(ball.vx)*0.8;}
    else if(min===overlapR){ball.x=maxX+ball.r;ball.vx=Math.abs(ball.vx)*0.8;}
    else if(min===overlapT){ball.y=minY-ball.r;ball.vy=-Math.abs(ball.vy)*0.8;}
    else{ball.y=maxY+ball.r;ball.vy=Math.abs(ball.vy)*0.8;}}});}

    function tick(){if(sunk)return;
    if(Math.abs(ball.vx)<0.01&&Math.abs(ball.vy)<0.01){ball.vx=0;ball.vy=0;return;}
    ball.x+=ball.vx;ball.y+=ball.vy;ball.vx*=0.985;ball.vy*=0.985;
    // Wall bounds
    if(ball.x-ball.r<0){ball.x=ball.r;ball.vx=-ball.vx*0.8;}
    if(ball.x+ball.r>cw){ball.x=cw-ball.r;ball.vx=-ball.vx*0.8;}
    if(ball.y-ball.r<0){ball.y=ball.r;ball.vy=-ball.vy*0.8;}
    if(ball.y+ball.r>ch){ball.y=ch-ball.r;ball.vy=-ball.vy*0.8;}
    wallBounce();
    // Hole check
    var dx=ball.x-hole.x,dy=ball.y-hole.y;
    if(Math.sqrt(dx*dx+dy*dy)<hole.r&&Math.sqrt(ball.vx*ball.vx+ball.vy*ball.vy)<4){
    sunk=true;ball.x=hole.x;ball.y=hole.y;ball.vx=0;ball.vy=0;
    if(holeNum>=8){document.getElementById('gfM').textContent='Finished! Total:'+totalStrokes+' strokes \u2014 R to play again';}
    else{document.getElementById('gfM').textContent='Hole in '+strokes+'! Click for next hole';}}}

    function draw(){cx.fillStyle='rgba(0,0,0,0.92)';cx.fillRect(0,0,cw,ch);
    var pc=_pc;
    // Green felt texture dots
    cx.fillStyle='rgba(51,255,51,0.015)';for(var i=0;i<80;i++)cx.fillRect((i*37)%cw,(i*53)%ch,1,1);
    // Hole
    cx.beginPath();cx.arc(hole.x,hole.y,hole.r,0,Math.PI*2);cx.fillStyle='rgba(0,0,0,0.6)';cx.fill();
    cx.strokeStyle='rgba(51,255,51,0.2)';cx.lineWidth=1;cx.stroke();
    // Flag
    cx.strokeStyle=pc;cx.lineWidth=1;cx.beginPath();cx.moveTo(hole.x,hole.y-hole.r);cx.lineTo(hole.x,hole.y-hole.r-16);cx.stroke();
    cx.fillStyle='#ff4444';cx.beginPath();cx.moveTo(hole.x,hole.y-hole.r-16);cx.lineTo(hole.x+10,hole.y-hole.r-12);cx.lineTo(hole.x,hole.y-hole.r-8);cx.fill();
    // Walls
    cx.fillStyle='rgba(51,255,51,0.12)';cx.strokeStyle='rgba(51,255,51,0.25)';cx.lineWidth=1;
    walls.forEach(function(w){cx.beginPath();cx.moveTo(w[0],w[1]);cx.lineTo(w[2],w[3]);cx.lineTo(w[4],w[5]);cx.lineTo(w[6],w[7]);cx.closePath();cx.fill();cx.stroke();});
    // Ball
    cx.beginPath();cx.arc(ball.x,ball.y,ball.r,0,Math.PI*2);cx.fillStyle='#ffffff';cx.shadowColor='#ffffff';cx.shadowBlur=6;cx.fill();cx.shadowBlur=0;
    // Aim line
    if(dragging&&ball.vx===0&&ball.vy===0){var dx2=ball.x-dragX,dy2=ball.y-dragY;
    var pw=Math.min(Math.sqrt(dx2*dx2+dy2*dy2)*0.15,8);
    cx.strokeStyle='rgba(255,255,255,0.4)';cx.lineWidth=1;cx.setLineDash([4,4]);
    cx.beginPath();cx.moveTo(ball.x,ball.y);cx.lineTo(ball.x+dx2*0.5,ball.y+dy2*0.5);cx.stroke();cx.setLineDash([]);
    // Power bar
    cx.fillStyle=pw>5?'#ff4444':pw>3?'#F7931A':'#33ff33';cx.fillRect(10,ch-12,pw*20,4);}}

    // Animation loop
    function loop(){if(!openWindows['golf'])return;tick();draw();win._raf=requestAnimationFrame(loop);}

    cv.addEventListener('mousedown',function(e){if(sunk||ball.vx!==0||ball.vy!==0)return;
    var r=cv.getBoundingClientRect();dragX=e.clientX-r.left;dragY=e.clientY-r.top;dragging=true;});
    cv.addEventListener('mousemove',function(e){if(!dragging)return;var r=cv.getBoundingClientRect();dragX=e.clientX-r.left;dragY=e.clientY-r.top;});
    cv.addEventListener('mouseup',function(e){if(!dragging)return;dragging=false;
    if(sunk){if(holeNum<8){holeNum++;loadHole();}return;}
    var r=cv.getBoundingClientRect();var mx=e.clientX-r.left,my=e.clientY-r.top;
    var dx2=ball.x-mx,dy2=ball.y-my;var pw=Math.min(Math.sqrt(dx2*dx2+dy2*dy2)*0.15,8);
    if(pw<0.3)return;
    ball.vx=dx2*0.08*pw/3;ball.vy=dy2*0.08*pw/3;strokes++;totalStrokes++;ub();});
    cv.addEventListener('click',function(){if(sunk&&holeNum<8){holeNum++;loadHole();}});

    win._onKey=function(e){if(e.key==='r'||e.key==='R')newGame();};
    newGame();win._raf=requestAnimationFrame(loop);
}

/* ════════════════════════════════════════════
   TOWER DEFENSE
   ════════════════════════════════════════════ */
function initTD(body, bw, bh) {
    var GC=Math.min(Math.floor((bw-80)/20),14),GR=Math.min(Math.floor((bh-60)/20),14);
    if(GC<10)GC=10;if(GR<10)GR=10;
    var CS=Math.floor(Math.min((bw-80)/GC,(bh-60)/GR));
    var cw=GC*CS,ch=GR*CS;
    body.innerHTML='<div style="display:flex;height:100%;padding:4px;gap:6px;font-family:VT323,monospace"><div style="display:flex;flex-direction:column;align-items:center"><canvas id="tdC" width="'+cw+'" height="'+ch+'" style="border:1px solid rgba(51,255,51,0.15);background:rgba(0,0,0,0.4);cursor:crosshair"></canvas></div><div style="display:flex;flex-direction:column;gap:4px;min-width:55px;font-size:0.68rem;color:var(--phosphor)"><div>WAVE</div><div id="tdW" style="color:var(--phosphor-bright)">1</div><div>GOLD</div><div id="tdG" style="color:#ffcc33">100</div><div>LIVES</div><div id="tdL" style="color:#ff4444">10</div><div style="margin-top:6px;border-top:1px solid rgba(51,255,51,0.06);padding-top:4px">TOWERS</div><div id="tdB1" class="td-tbtn" style="cursor:pointer;padding:2px;border:1px solid rgba(51,255,51,0.1)">1: Gun $25</div><div id="tdB2" class="td-tbtn" style="cursor:pointer;padding:2px;border:1px solid rgba(51,255,51,0.1)">2: Slow $40</div><div id="tdB3" class="td-tbtn" style="cursor:pointer;padding:2px;border:1px solid rgba(51,255,51,0.1)">3: Snipe $60</div><div style="margin-top:4px;font-size:0.6rem;color:var(--phosphor-dim)">Click grid to place</div><div id="tdM" style="font-size:0.6rem;color:var(--phosphor-dim);margin-top:auto">Space: next wave</div></div></div>';
    var cv=document.getElementById('tdC'),cx=cv.getContext('2d');
    var win=body.closest('.app-window');
    var grid,path,enemies,towers,bullets,gold,lives,wave,spawning,spawnQ,spawnTick,selectedTower,over;

    function genPath(){path=[];var y=Math.floor(GR/2);var c=0;path.push({c:0,r:y});
    while(c<GC-1){c++;path.push({c:c,r:y});
    if(c<GC-1&&Math.random()<0.4){var dy=Math.random()<0.5?-1:1;var steps=1+Math.floor(Math.random()*2);
    for(var s=0;s<steps;s++){var ny=y+dy;if(ny>=1&&ny<GR-1){y=ny;path.push({c:c,r:y});}}}}
    grid=[];for(var r=0;r<GR;r++){grid[r]=[];for(var cc=0;cc<GC;cc++)grid[r][cc]=0;}
    path.forEach(function(p){grid[p.r][p.c]=1;});}

    function newGame(){genPath();enemies=[];towers=[];bullets=[];gold=100;lives=10;wave=0;spawning=false;spawnQ=[];spawnTick=0;selectedTower=1;over=false;
    tdPC=_pc;
    ub();draw();clearInterval(win._interval);win._interval=setInterval(tick,30);}
    var tdPC='#66ff66';var tdFrame=0;
    function ub(){document.getElementById('tdW').textContent=wave;document.getElementById('tdG').textContent=gold;document.getElementById('tdL').textContent=lives;}

    function startWave(){if(spawning)return;wave++;spawnQ=[];
    var n=5+wave*2;for(var i=0;i<n;i++){var hp=3+wave*2+(i%3===0?wave:0);var sp=0.8+Math.random()*0.3;
    spawnQ.push({hp:hp,maxHp:hp,spd:sp,pi:0,x:path[0].c*CS+CS/2,y:path[0].r*CS+CS/2,slow:0});}
    spawning=true;spawnTick=0;ub();}

    function tick(){if(over||!openWindows['td'])return;tdFrame++;
    var idle=enemies.length===0&&!spawning&&bullets.length===0;
    // Spawn enemies
    if(spawning&&spawnQ.length>0){spawnTick++;if(spawnTick%15===0){var e=spawnQ.shift();enemies.push(e);if(spawnQ.length===0)spawning=false;}}
    // Move enemies
    enemies.forEach(function(e){if(e.hp<=0)return;
    if(e.slow>0)e.slow--;
    var spd=e.slow>0?e.spd*0.4:e.spd;
    var target=path[Math.min(e.pi+1,path.length-1)];
    var tx=target.c*CS+CS/2,ty=target.r*CS+CS/2;
    var dx=tx-e.x,dy=ty-e.y,dist=Math.sqrt(dx*dx+dy*dy);
    if(dist<spd+1){e.x=tx;e.y=ty;e.pi++;if(e.pi>=path.length-1){e.hp=0;lives--;ub();if(lives<=0){over=true;document.getElementById('tdM').textContent='GAME OVER \u2014 R';}}}
    else{e.x+=dx/dist*spd;e.y+=dy/dist*spd;}});
    enemies=enemies.filter(function(e){return e.hp>0||e.pi<path.length-1;});
    // Tower shooting
    towers.forEach(function(t){t.cooldown--;if(t.cooldown>0)return;
    var range=t.type===3?CS*5:CS*3;var best=null,bestD=range;
    enemies.forEach(function(e){if(e.hp<=0)return;var dx=e.x-t.x,dy=e.y-t.y,d=Math.sqrt(dx*dx+dy*dy);if(d<bestD){bestD=d;best=e;}});
    if(best){t.cooldown=t.type===3?40:t.type===2?30:15;
    var dmg=t.type===3?8:t.type===2?1:3;
    bullets.push({x:t.x,y:t.y,tx:best.x,ty:best.y,target:best,dmg:dmg,type:t.type,life:8});}});
    // Move bullets
    bullets.forEach(function(b){var dx=b.tx-b.x,dy=b.ty-b.y,d=Math.sqrt(dx*dx+dy*dy);
    if(d<6){b.life=0;if(b.target.hp>0){b.target.hp-=b.dmg;if(b.type===2)b.target.slow=60;
    if(b.target.hp<=0){gold+=5+wave;ub();}}}
    else{b.x+=dx/d*6;b.y+=dy/d*6;}b.life--;});
    bullets=bullets.filter(function(b){return b.life>0;});
    // Wave complete
    if(enemies.length===0&&!spawning&&wave>0&&!over){document.getElementById('tdM').textContent='Wave '+wave+' clear! Space: next';}
    if(!idle||tdFrame%10===0)draw();}

    function draw(){cx.fillStyle='rgba(0,0,0,0.9)';cx.fillRect(0,0,cw,ch);
    var pc=tdPC;
    // Grid
    cx.strokeStyle='rgba(51,255,51,0.03)';cx.lineWidth=0.5;
    for(var c=0;c<=GC;c++){cx.beginPath();cx.moveTo(c*CS,0);cx.lineTo(c*CS,ch);cx.stroke();}
    for(var r=0;r<=GR;r++){cx.beginPath();cx.moveTo(0,r*CS);cx.lineTo(cw,r*CS);cx.stroke();}
    // Path
    cx.fillStyle='rgba(51,255,51,0.04)';path.forEach(function(p){cx.fillRect(p.c*CS,p.r*CS,CS,CS);});
    // Path line
    cx.strokeStyle='rgba(51,255,51,0.1)';cx.lineWidth=2;cx.beginPath();
    path.forEach(function(p,i){var x=p.c*CS+CS/2,y=p.r*CS+CS/2;if(i===0)cx.moveTo(x,y);else cx.lineTo(x,y);});cx.stroke();
    // Towers
    towers.forEach(function(t){var col=t.type===1?pc:t.type===2?'#33ccff':'#F7931A';
    cx.fillStyle=col;cx.shadowColor=col;cx.shadowBlur=3;
    cx.fillRect(t.x-CS/3,t.y-CS/3,CS*2/3,CS*2/3);cx.shadowBlur=0;
    cx.fillStyle='rgba(0,0,0,0.5)';cx.font=(CS*0.5)+'px VT323';cx.textAlign='center';cx.textBaseline='middle';
    cx.fillText(t.type===1?'G':t.type===2?'S':'X',t.x,t.y+1);});
    // Enemies
    enemies.forEach(function(e){if(e.hp<=0)return;
    cx.fillStyle=e.slow>0?'#33ccff':'#ff4444';cx.shadowColor=cx.fillStyle;cx.shadowBlur=2;
    cx.beginPath();cx.arc(e.x,e.y,CS/3,0,Math.PI*2);cx.fill();cx.shadowBlur=0;
    // HP bar
    var bw2=CS*0.6,bh2=2;cx.fillStyle='rgba(0,0,0,0.5)';cx.fillRect(e.x-bw2/2,e.y-CS/2.5,bw2,bh2);
    cx.fillStyle='#66ff66';cx.fillRect(e.x-bw2/2,e.y-CS/2.5,bw2*(e.hp/e.maxHp),bh2);});
    // Bullets
    bullets.forEach(function(b){cx.fillStyle=b.type===2?'#33ccff':b.type===3?'#F7931A':'#fff';
    cx.beginPath();cx.arc(b.x,b.y,2,0,Math.PI*2);cx.fill();});}

    // Place tower
    cv.addEventListener('click',function(e){if(over)return;
    var r2=cv.getBoundingClientRect();var mx=e.clientX-r2.left,my=e.clientY-r2.top;
    var gc=Math.floor(mx/CS),gr=Math.floor(my/CS);
    if(gc<0||gc>=GC||gr<0||gr>=GR||grid[gr][gc]===1)return;
    if(towers.some(function(t){return Math.floor(t.x/CS)===gc&&Math.floor(t.y/CS)===gr;}))return;
    var cost=selectedTower===1?25:selectedTower===2?40:60;
    if(gold<cost)return;gold-=cost;
    towers.push({x:gc*CS+CS/2,y:gr*CS+CS/2,type:selectedTower,cooldown:0});ub();draw();});
    document.getElementById('tdB1').addEventListener('click',function(){selectedTower=1;});
    document.getElementById('tdB2').addEventListener('click',function(){selectedTower=2;});
    document.getElementById('tdB3').addEventListener('click',function(){selectedTower=3;});

    win._onKey=function(e){
    if(e.key==='1')selectedTower=1;if(e.key==='2')selectedTower=2;if(e.key==='3')selectedTower=3;
    if(e.key===' '){startWave();e.preventDefault();}
    if(e.key==='r'||e.key==='R')newGame();};
    newGame();
}

/* ════════════════════════════════════════════
   SOKOBAN
   ════════════════════════════════════════════ */
function initSokoban(body, bw, bh) {
    var win=body.closest('.app-window');
    body.innerHTML='<div style="display:flex;flex-direction:column;height:100%;font-family:VT323,monospace"><div style="display:flex;justify-content:space-between;padding:3px 8px;font-size:0.78rem;color:var(--phosphor);border-bottom:1px solid rgba(51,255,51,0.06)"><span id="skLv">Level 1</span><span id="skMv">Moves: 0</span><span id="skPh">Push: 0</span></div><pre id="skMap" style="flex:1;margin:0;padding:6px 8px;font-size:14px;line-height:17px;color:var(--phosphor);overflow:hidden;white-space:pre;letter-spacing:2px;display:flex;align-items:center;justify-content:center"></pre><div id="skM" style="padding:3px 8px;font-size:0.72rem;color:var(--phosphor-dim);border-top:1px solid rgba(51,255,51,0.06)">Arrows: move | U: undo | R: restart | N: next</div></div>';
    var LEVELS=[
        ['########','#  . . #','#      #','# $$ @ #','#  . . #','#  $$  #','#      #','########'],
        ['  #####','###   #','# $ # ##','# #  . #','#    # #','## #.  #',' #   ###',' #####'],
        ['#######','#     #','# # # #','# $.$.#','##.@.##',' #$.$# ',' # # # ',' #   # ',' #####'],
        ['########','#      #','# .$$. #','# $..$ #','# $..$ #','# .$$. #','#  @   #','########'],
        ['  #####','  #   #','###$  #','#  $# #','# . . #','# @$  #','#######'],
        ['######','#    ##','# ## .#','#  $ .#','# $#  #','#@ $ .#','#  ####','####'],
        [' ######',' #    #','##$.# #','# $.  #','# #.$ #','#   @##','######'],
        ['#######','#  @  #','# $$$ #','#.....#','# $$$ #','#  $  #','#.   .#','#######'],
    ];
    var lv,px2,py2,boxes,targets,wallMap,moves,pushes,history;

    function loadLevel(n){lv=n%LEVELS.length;var L=LEVELS[lv];
    boxes=[];targets=[];wallMap={};moves=0;pushes=0;history=[];
    for(var r=0;r<L.length;r++)for(var c=0;c<L[r].length;c++){var ch=L[r][c];
    if(ch==='#')wallMap[r+','+c]=true;
    if(ch==='$'||ch==='*')boxes.push({r:r,c:c});
    if(ch==='.'||ch==='*'||ch==='+')targets.push({r:r,c:c});
    if(ch==='@'||ch==='+'){px2=c;py2=r;}}
    ub();draw();}

    function ub(){document.getElementById('skLv').textContent='Level '+(lv+1)+'/'+LEVELS.length;
    document.getElementById('skMv').textContent='Moves:'+moves;document.getElementById('skPh').textContent='Push:'+pushes;}

    function isWall(r,c){return wallMap[r+','+c];}
    function boxAt(r,c){for(var i=0;i<boxes.length;i++)if(boxes[i].r===r&&boxes[i].c===c)return i;return-1;}
    function isTarget(r,c){return targets.some(function(t){return t.r===r&&t.c===c;});}
    function won(){return boxes.every(function(b){return isTarget(b.r,b.c);});}

    function tryMove(dr,dc){
    var nr=py2+dr,nc=px2+dc;
    if(isWall(nr,nc))return;
    var bi=boxAt(nr,nc);
    if(bi>=0){var br=nr+dr,bc=nc+dc;if(isWall(br,bc)||boxAt(br,bc)>=0)return;
    history.push({px:px2,py:py2,bi:bi,bfr:boxes[bi].r,bfc:boxes[bi].c});
    boxes[bi].r=br;boxes[bi].c=bc;pushes++;}
    else{history.push({px:px2,py:py2,bi:-1,bfr:0,bfc:0});}
    px2=nc;py2=nr;moves++;ub();draw();
    if(won()){document.getElementById('skM').textContent='Level '+(lv+1)+' complete! Moves:'+moves+' Push:'+pushes+' \u2014 N: next';}}

    function undo(){if(history.length===0)return;var h=history.pop();
    px2=h.px;py2=h.py;if(h.bi>=0){boxes[h.bi].r=h.bfr;boxes[h.bi].c=h.bfc;pushes--;}moves--;ub();draw();}

    function draw(){var L=LEVELS[lv%LEVELS.length];var rows=L.length,cols=0;L.forEach(function(r){if(r.length>cols)cols=r.length;});
    var display=[];
    for(var r=0;r<rows;r++){var row='';for(var c=0;c<cols;c++){
    var isW=isWall(r,c),isT=isTarget(r,c),bi2=boxAt(r,c),isP=(c===px2&&r===py2);
    if(isP){row+='<span style="color:var(--phosphor-bright);text-shadow:0 0 6px var(--phosphor-glow)">@</span>';}
    else if(bi2>=0&&isT){row+='<span style="color:#ffcc33;text-shadow:0 0 4px rgba(255,204,51,0.4)">*</span>';}
    else if(bi2>=0){row+='<span style="color:#F7931A">$</span>';}
    else if(isT){row+='<span style="color:#33ccff">.</span>';}
    else if(isW){row+='<span style="color:rgba(51,255,51,0.2)">#</span>';}
    else{row+=' ';}}display.push(row);}
    document.getElementById('skMap').innerHTML=display.join('\n');}

    win._onKey=function(e){
    if(e.key==='r'||e.key==='R'){loadLevel(lv);return;}
    if(e.key==='n'||e.key==='N'){loadLevel(lv+1);return;}
    if(e.key==='u'||e.key==='U'){undo();return;}
    if(won())return;
    if(e.key==='ArrowUp'||e.key==='w'){tryMove(-1,0);e.preventDefault();}
    else if(e.key==='ArrowDown'||e.key==='s'){tryMove(1,0);e.preventDefault();}
    else if(e.key==='ArrowLeft'||e.key==='a'){tryMove(0,-1);e.preventDefault();}
    else if(e.key==='ArrowRight'||e.key==='d'){tryMove(0,1);e.preventDefault();}};
    loadLevel(0);
}

/* ════════════════════════════════════════════
   CHESS (vs simple AI)
   ════════════════════════════════════════════ */
function initChess(body, bw, bh) {
    var SZ=Math.min(Math.floor((bw-20)/8),Math.floor((bh-70)/8),34);
    var bsz=SZ*8;
    body.innerHTML='<div style="display:flex;flex-direction:column;align-items:center;height:100%;padding:6px;font-family:VT323,monospace"><div style="display:flex;justify-content:space-between;width:100%;padding:2px 6px;font-size:0.78rem;color:var(--phosphor)"><span id="chS">White to move</span><span id="chC">Captures: 0</span></div><canvas id="chC2" width="'+bsz+'" height="'+bsz+'" style="border:1px solid rgba(51,255,51,0.15);cursor:pointer"></canvas><div id="chM" style="font-size:0.72rem;color:var(--phosphor-dim);margin-top:3px;text-align:center">Click piece then target square | R: new game</div></div>';
    var cv=document.getElementById('chC2'),cx=cv.getContext('2d');
    var win=body.closest('.app-window');
    // Board: 0=empty, positive=white, negative=black
    // 1=P,2=N,3=B,4=R,5=Q,6=K
    var SYMS={1:'P',2:'N',3:'B',4:'R',5:'Q',6:'K','-1':'p','-2':'n','-3':'b','-4':'r','-5':'q','-6':'k'};
    var VALS={1:100,2:320,3:330,4:500,5:900,6:20000};
    var board,turn,sel,legal,caps,gameOver;

    function initBoard(){
    board=[[4,2,3,5,6,3,2,4],[1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[-1,-1,-1,-1,-1,-1,-1,-1],[-4,-2,-3,-5,-6,-3,-2,-4]];
    // board[row][col], row 0=rank 1 (white back), row 7=rank 8 (black back)
    turn=1;sel=null;legal=[];caps=0;gameOver=false;
    document.getElementById('chS').textContent='White to move';document.getElementById('chC').textContent='Captures:0';}

    function inB(r,c){return r>=0&&r<8&&c>=0&&c<8;}
    function sign(v){return v>0?1:v<0?-1:0;}
    function enemy(p,side){return p!==0&&sign(p)!==side;}
    function friend(p,side){return p!==0&&sign(p)===side;}

    function getMoves(b,r,c){var p=b[r][c],s=sign(p),t=Math.abs(p),mv=[];
    if(t===1){// Pawn
    var dir=s===1?1:-1,sr=s===1?1:6;
    if(inB(r+dir,c)&&b[r+dir][c]===0){mv.push([r+dir,c]);if(r===sr&&b[r+dir*2][c]===0)mv.push([r+dir*2,c]);}
    if(inB(r+dir,c-1)&&enemy(b[r+dir][c-1],s))mv.push([r+dir,c-1]);
    if(inB(r+dir,c+1)&&enemy(b[r+dir][c+1],s))mv.push([r+dir,c+1]);}
    if(t===2){// Knight
    [[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]].forEach(function(d){var nr=r+d[0],nc=c+d[1];if(inB(nr,nc)&&!friend(b[nr][nc],s))mv.push([nr,nc]);});}
    if(t===3||t===5){// Bishop/Queen diagonals
    [[-1,-1],[-1,1],[1,-1],[1,1]].forEach(function(d){for(var i=1;i<8;i++){var nr=r+d[0]*i,nc=c+d[1]*i;if(!inB(nr,nc))break;if(friend(b[nr][nc],s))break;mv.push([nr,nc]);if(enemy(b[nr][nc],s))break;}});}
    if(t===4||t===5){// Rook/Queen lines
    [[-1,0],[1,0],[0,-1],[0,1]].forEach(function(d){for(var i=1;i<8;i++){var nr=r+d[0]*i,nc=c+d[1]*i;if(!inB(nr,nc))break;if(friend(b[nr][nc],s))break;mv.push([nr,nc]);if(enemy(b[nr][nc],s))break;}});}
    if(t===6){// King
    for(var dr=-1;dr<=1;dr++)for(var dc=-1;dc<=1;dc++){if(dr===0&&dc===0)continue;var nr=r+dr,nc=c+dc;if(inB(nr,nc)&&!friend(b[nr][nc],s))mv.push([nr,nc]);}}
    return mv;}

    function allMoves(b,side){var mv=[];for(var r=0;r<8;r++)for(var c=0;c<8;c++){if(sign(b[r][c])===side){var m=getMoves(b,r,c);m.forEach(function(to){mv.push({fr:r,fc:c,tr:to[0],tc:to[1]});});}}return mv;}

    function doMove(b,m){var nb=b.map(function(r){return r.slice();});var cap=nb[m.tr][m.tc];
    nb[m.tr][m.tc]=nb[m.fr][m.fc];nb[m.fr][m.fc]=0;
    // Pawn promote
    var p=nb[m.tr][m.tc];if(Math.abs(p)===1&&(m.tr===0||m.tr===7))nb[m.tr][m.tc]=sign(p)*5;
    return{b:nb,cap:cap};}

    function inCheck(b,side){// Is 'side' in check?
    var kr=-1,kc=-1;for(var r=0;r<8;r++)for(var c=0;c<8;c++)if(b[r][c]===side*6){kr=r;kc=c;}
    if(kr===-1)return true;
    var opp=allMoves(b,-side);return opp.some(function(m){return m.tr===kr&&m.tc===kc;});}

    function legalMoves(b,side){return allMoves(b,side).filter(function(m){var r=doMove(b,m);return!inCheck(r.b,side);});}

    function evaluate(b){var v=0;for(var r=0;r<8;r++)for(var c=0;c<8;c++){var p=b[r][c];if(p!==0){v+=sign(p)*VALS[Math.abs(p)];
    // Position bonus: center control
    var cb=Math.abs(3.5-r)*0.5+Math.abs(3.5-c)*0.5;v+=sign(p)*(4-cb)*2;}}return v;}

    function aiMove(){var mvs=legalMoves(board,-1);if(mvs.length===0)return null;
    var best=null,bestV=Infinity;
    mvs.forEach(function(m){var r1=doMove(board,m);var opMvs=legalMoves(r1.b,1);var worstForBlack=-Infinity;
    if(opMvs.length===0){worstForBlack=inCheck(r1.b,1)?-99999:0;}
    else{opMvs.forEach(function(om){var r2=doMove(r1.b,om);var val=evaluate(r2.b);if(val>worstForBlack)worstForBlack=val;});}
    if(worstForBlack<bestV){bestV=worstForBlack;best=m;}});
    return best;}

    function draw(){cx.fillStyle='rgba(0,0,0,0.9)';cx.fillRect(0,0,bsz,bsz);
    var pc=_pc;
    for(var r=0;r<8;r++)for(var c=0;c<8;c++){
    var isLight=(r+c)%2===0;
    cx.fillStyle=isLight?'rgba(51,255,51,0.06)':'rgba(0,0,0,0.2)';
    cx.fillRect(c*SZ,bsz-(r+1)*SZ,SZ,SZ);
    // Highlight
    if(sel&&sel.r===r&&sel.c===c){cx.fillStyle='rgba(51,255,51,0.15)';cx.fillRect(c*SZ,bsz-(r+1)*SZ,SZ,SZ);}
    if(legal.some(function(m){return m.tr===r&&m.tc===c;})){cx.fillStyle='rgba(51,255,51,0.08)';cx.fillRect(c*SZ,bsz-(r+1)*SZ,SZ,SZ);
    cx.beginPath();cx.arc(c*SZ+SZ/2,bsz-(r+1)*SZ+SZ/2,3,0,Math.PI*2);cx.fillStyle='rgba(51,255,51,0.2)';cx.fill();}
    // Piece
    var p=board[r][c];if(p!==0){var sym=SYMS[String(p)];
    cx.fillStyle=p>0?pc:'#ff4444';cx.shadowColor=cx.fillStyle;cx.shadowBlur=3;
    cx.font='bold '+(SZ*0.6)+'px VT323';cx.textAlign='center';cx.textBaseline='middle';
    cx.fillText(sym,c*SZ+SZ/2,bsz-(r+1)*SZ+SZ/2);cx.shadowBlur=0;}}
    // Rank/file labels
    cx.fillStyle='rgba(51,255,51,0.15)';cx.font=(SZ*0.3)+'px VT323';cx.textAlign='left';
    for(var i=0;i<8;i++){cx.fillText(i+1,2,bsz-(i)*SZ-SZ+SZ*0.3);cx.fillText('abcdefgh'[i],i*SZ+SZ*0.7,bsz-2);}}

    cv.addEventListener('click',function(e){if(gameOver||turn!=1)return;
    var rect=cv.getBoundingClientRect();var mx=e.clientX-rect.left,my=e.clientY-rect.top;
    var c=Math.floor(mx/SZ),r=7-Math.floor(my/SZ);if(!inB(r,c))return;
    if(sel){// Try to move
    var mv=legal.find(function(m){return m.tr===r&&m.tc===c;});
    if(mv){var res=doMove(board,mv);board=res.b;if(res.cap!==0)caps++;
    sel=null;legal=[];
    document.getElementById('chC').textContent='Captures:'+caps;
    // Check for checkmate/stalemate
    var bm=legalMoves(board,-1);
    if(bm.length===0){gameOver=true;document.getElementById('chS').textContent=inCheck(board,-1)?'Checkmate! You win!':'Stalemate!';draw();return;}
    document.getElementById('chS').textContent='Black thinking...';draw();
    turn=-1;
    setTimeout(function(){var am=aiMove();if(am){var ar=doMove(board,am);board=ar.b;if(ar.cap!==0)caps++;document.getElementById('chC').textContent='Captures:'+caps;}
    var wm=legalMoves(board,1);if(wm.length===0){gameOver=true;document.getElementById('chS').textContent=inCheck(board,1)?'Checkmate! You lose':'Stalemate!';draw();return;}
    turn=1;document.getElementById('chS').textContent=inCheck(board,1)?'Check! Your move':'White to move';draw();},150);
    }else{// Select different piece
    if(sign(board[r][c])===1){sel={r:r,c:c};legal=legalMoves(board,1).filter(function(m){return m.fr===r&&m.fc===c;});}
    else{sel=null;legal=[];}}}
    else{// Select piece
    if(sign(board[r][c])===1){sel={r:r,c:c};legal=legalMoves(board,1).filter(function(m){return m.fr===r&&m.fc===c;});}
    }draw();});

    win._onKey=function(e){if(e.key==='r'||e.key==='R'){initBoard();draw();}};
    initBoard();draw();
}


    loadTheme();
    _updatePC();
    loadFavorites();
    initNoise();
    initBurnIn();
    renderWhitepaper(BTC_WP, 'btcWpScroll', 'amber');
    renderWhitepaper(BC2_WP, 'bc2WpScroll', 'cyan');
    renderForum();
    renderCypherpunks();

    function revealMainUI() {
        burnReady = true;
        document.getElementById('tabBar').style.display = '';
        document.querySelectorAll('.tab-content').forEach(function(c) { c.style.visibility = 'visible'; });
        initFaq();
        _burnPrevTab = 'faq';

        // Defer email/desktop load until tab is clicked
        var emailInited = false;
        var desktopInited = false;
        var origSwitch = switchTab;
        switchTab = function(tabId) {
            origSwitch(tabId);
            if (tabId === 'emails' && !emailInited) {
                emailInited = true;
                if (EMAILS.length) showEmail(0);
            }
            if (tabId === 'desktop' && !desktopInited) {
                desktopInited = true;
                initDesktop();
            }
        };
    }

    // Boot → Login → Main UI
    runBootSequence(function() {
        initLogin(revealMainUI);
    });
});
</script>
</body>
</html>
